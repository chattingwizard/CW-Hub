import{u as Q,r as c,q as A,s as C,S as H,j as e,T as P,a as x,t as V,v as Y,g as $,e as ee,w as te}from"./index-BP5YFlyp.js";import{C as se}from"./copy-BikENrkr.js";import{C as ae}from"./chevron-right-CosHkskW.js";import{S as re}from"./save-DxJ8lXpM.js";import{P as le}from"./plus-DMkEW-A8.js";import{X as q}from"./x-g7em6QJH.js";import{S as ne}from"./search-QQZqewHu.js";function de({chatter:r,onRemove:u,isDragging:v}){var f,o,b;const i=r!=null&&r.team_name?te(r.team_name):"",m=(f=r==null?void 0:r.team_name)!=null&&f.includes("Huckle")?"bg-orange-400":(o=r==null?void 0:r.team_name)!=null&&o.includes("Danilyn")?"bg-blue-400":(b=r==null?void 0:r.team_name)!=null&&b.includes("Ezekiel")?"bg-purple-400":"bg-zinc-500";return e.jsxs("div",{className:x("group flex items-center gap-1.5 px-2 py-1.5 rounded-lg text-xs font-semibold transition-all border",v?"opacity-50 scale-95":"",i||"bg-surface-2 text-text-secondary border-border"),children:[e.jsx("div",{className:x("w-2 h-2 rounded-full shrink-0",m)}),e.jsx("span",{className:"truncate flex-1",children:(r==null?void 0:r.full_name)??"?"}),u&&e.jsx("button",{onClick:w=>{w.stopPropagation(),u()},className:"opacity-0 group-hover:opacity-100 shrink-0 hover:text-danger transition-opacity",children:e.jsx(q,{size:12})})]})}function ie({schedules:r,dayIdx:u,shift:v,onAdd:i,onRemove:m,isToday:f}){return e.jsxs("div",{className:x("min-h-[120px] rounded-xl border p-2 flex flex-col gap-1 transition-colors",f?"bg-cw/[0.03] border-cw/20":"bg-surface-1 border-border hover:border-border-light"),children:[r.map(o=>e.jsx(de,{chatter:o.chatter,onRemove:()=>m(o.id)},o.id)),e.jsx("button",{onClick:i,className:"mt-auto flex items-center justify-center py-1 rounded-lg text-text-muted hover:text-cw hover:bg-cw/5 transition-colors",children:e.jsx(le,{size:14})})]})}function ce({chatters:r,existingIds:u,onSelect:v,onClose:i}){const[m,f]=c.useState(""),[o,b]=c.useState("all"),w=c.useMemo(()=>[...new Set(r.map(n=>n.team_name).filter(Boolean))],[r]),_=r.filter(n=>!(u.has(n.id)||m&&!n.full_name.toLowerCase().includes(m.toLowerCase())||o!=="all"&&n.team_name!==o));return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:i}),e.jsxs("div",{className:"relative bg-surface-1 border border-border rounded-2xl w-full max-w-sm shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-bold text-text-primary",children:"Add Chatter"}),e.jsx("button",{onClick:i,className:"p-1 rounded-lg hover:bg-surface-2 text-text-muted hover:text-text-primary",children:e.jsx(q,{size:16})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),e.jsx("input",{type:"text",placeholder:"Search chatters...",value:m,onChange:n=>f(n.target.value),className:"w-full pl-8 pr-3 py-2 bg-surface-2 border border-border rounded-lg text-sm text-text-primary placeholder:text-text-muted focus:outline-none focus:border-cw/50",autoFocus:!0})]}),e.jsxs("div",{className:"flex gap-1.5 mt-3 flex-wrap",children:[e.jsx("button",{onClick:()=>b("all"),className:x("px-2.5 py-1 rounded-md text-[11px] font-semibold transition-colors",o==="all"?"bg-cw/15 text-cw":"bg-surface-2 text-text-muted hover:text-text-secondary"),children:"All"}),w.map(n=>e.jsx("button",{onClick:()=>b(n),className:x("px-2.5 py-1 rounded-md text-[11px] font-semibold transition-colors",o===n?"bg-cw/15 text-cw":"bg-surface-2 text-text-muted hover:text-text-secondary"),children:n.replace("Team ","")},n))]})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto p-2",children:_.length===0?e.jsx("p",{className:"text-center text-text-muted text-sm py-6",children:"No chatters available"}):_.map(n=>{var h,y,p,g;const D=(h=n.team_name)!=null&&h.includes("Huckle")?"bg-orange-400":(y=n.team_name)!=null&&y.includes("Danilyn")?"bg-blue-400":(p=n.team_name)!=null&&p.includes("Ezekiel")?"bg-purple-400":"bg-zinc-500";return e.jsxs("button",{onClick:()=>{v(n.id),i()},className:"w-full flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-surface-2 transition-colors text-left",children:[e.jsx("div",{className:x("w-2.5 h-2.5 rounded-full",D)}),e.jsx("span",{className:"text-sm text-text-primary font-medium flex-1",children:n.full_name}),e.jsx("span",{className:"text-[10px] text-text-muted",children:(g=n.team_name)==null?void 0:g.replace("Team ","")})]},n.id)})})]})]})}function be(){const{profile:r}=Q(),[u,v]=c.useState([]),[i,m]=c.useState([]),[f,o]=c.useState(0),[b,w]=c.useState(!0),[_,n]=c.useState(!1),[D,h]=c.useState(!1),[y,p]=c.useState(""),[g,E]=c.useState(null),I=t=>{const s=new Date,a=s.getUTCDay(),l=s.getUTCDate()-a+(a===0?-6:1)+t*7;return s.setUTCDate(l),s.toISOString().split("T")[0]},j=I(f),S=c.useMemo(()=>Array.from({length:7},(t,s)=>{const a=new Date(j+"T00:00:00Z");return a.setUTCDate(a.getUTCDate()+s),a}),[j]),M=c.useMemo(()=>{const t=S[0],s=S[6];return`${A(t,"short")} – ${A(s,"short")}`},[S]),z=c.useCallback(async()=>{w(!0);const[t,s]=await Promise.all([C.from("chatters").select("*").eq("status","Active").eq("airtable_role","Chatter").order("full_name"),C.from("schedules").select("*, chatter:chatters!schedules_chatter_id_fkey(*)").eq("week_start",j)]);v(t.data??[]),m(s.data??[]),w(!1),h(!1)},[j]);c.useEffect(()=>{z()},[z]);const U=(t,s)=>i.filter(a=>a.day_of_week===t&&a.shift===s),W=(t,s,a)=>{i.some(l=>l.chatter_id===a&&l.day_of_week===t&&l.shift===s)||(m(l=>[...l,{id:crypto.randomUUID(),chatter_id:a,week_start:j,day_of_week:t,shift:s,created_by:(r==null?void 0:r.id)??null,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),chatter:u.find(d=>d.id===a)}]),h(!0))},R=t=>{m(s=>s.filter(a=>a.id!==t)),h(!0)},B=async()=>{const t=I(f-1),{data:s}=await C.from("schedules").select("*, chatter:chatters!schedules_chatter_id_fkey(*)").eq("week_start",t);if(!s||s.length===0){p("No schedules in previous week"),setTimeout(()=>p(""),2e3);return}const a=new Set(i.map(d=>`${d.chatter_id}-${d.day_of_week}-${d.shift}`)),l=s.filter(d=>!a.has(`${d.chatter_id}-${d.day_of_week}-${d.shift}`)).map(d=>({...d,id:crypto.randomUUID(),week_start:j,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}));m(d=>[...d,...l]),h(!0),p(`Copied ${l.length} entries`),setTimeout(()=>p(""),2e3)},X=async()=>{n(!0);try{await C.from("schedules").delete().eq("week_start",j);const t=i.map(s=>({chatter_id:s.chatter_id,week_start:s.week_start,day_of_week:s.day_of_week,shift:s.shift,created_by:r==null?void 0:r.id}));if(t.length>0){const{error:s}=await C.from("schedules").insert(t);if(s)throw s}p("Saved!"),h(!1),setTimeout(()=>p(""),2e3),z()}catch(t){p(`Error: ${t.message}`)}finally{n(!1)}},O=i.length,Z=new Set(i.map(t=>t.chatter_id)).size,G=new Set(i.map(t=>t.chatter_id)),k=u.filter(t=>!G.has(t.id)),F=H.map(t=>{const s=i.filter(a=>a.shift===t).length;return{shift:t,count:s,avg:(s/7).toFixed(1)}}),L=new Date().toISOString().split("T")[0];return b?e.jsx("div",{className:"p-6 flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"flex items-center gap-2 text-text-secondary",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-cw/30 border-t-cw rounded-full animate-spin"}),"Loading schedules..."]})}):e.jsxs("div",{className:"p-4 lg:p-6 max-w-full",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-5 gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-extrabold text-text-primary",children:"Weekly Schedule"}),e.jsxs("p",{className:"text-sm text-text-secondary mt-0.5",children:[Z," chatters · ",O," shifts assigned",k.length>0&&e.jsxs("span",{className:"text-warning ml-2",children:[e.jsx(P,{size:12,className:"inline -mt-0.5 mr-0.5"}),k.length," unassigned"]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[y&&e.jsx("span",{className:x("text-sm font-medium px-3 py-1 rounded-lg",y.startsWith("Error")?"bg-danger-muted text-danger":"bg-success-muted text-success"),children:y}),e.jsxs("button",{onClick:B,className:"flex items-center gap-1.5 px-3 py-2 border border-border text-text-secondary rounded-lg hover:bg-surface-2 hover:text-text-primary text-sm font-medium",children:[e.jsx(se,{size:14}),e.jsx("span",{className:"hidden sm:inline",children:"Copy Prev Week"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-surface-1 border border-border rounded-lg px-2 py-1.5",children:[e.jsx("button",{onClick:()=>o(t=>t-1),className:"p-1 hover:text-cw text-text-muted rounded-md hover:bg-surface-2",children:e.jsx(V,{size:16})}),e.jsx("span",{className:"text-sm text-text-primary font-semibold min-w-[170px] text-center",children:M}),e.jsx("button",{onClick:()=>o(t=>t+1),className:"p-1 hover:text-cw text-text-muted rounded-md hover:bg-surface-2",children:e.jsx(ae,{size:16})})]}),e.jsxs("button",{onClick:X,disabled:!D||_,className:"flex items-center gap-1.5 px-4 py-2 bg-cw hover:bg-cw-dark text-white rounded-lg text-sm font-bold disabled:opacity-40 disabled:cursor-not-allowed transition-colors",children:[e.jsx(re,{size:15}),_?"Saving...":"Save"]})]})]}),e.jsxs("div",{className:"flex flex-col xl:flex-row gap-5",children:[e.jsx("div",{className:"flex-1 overflow-x-auto",children:e.jsxs("div",{className:"min-w-[900px]",children:[e.jsxs("div",{className:"grid grid-cols-[100px_repeat(7,1fr)] gap-1.5 mb-1.5",children:[e.jsx("div",{})," ",S.map((t,s)=>{const l=t.toISOString().split("T")[0]===L;return e.jsxs("div",{className:x("text-center py-2 rounded-lg",l?"bg-cw/10":""),children:[e.jsx("div",{className:x("text-[11px] font-bold uppercase tracking-wider",l?"text-cw":"text-text-muted"),children:Y(s)}),e.jsx("div",{className:x("text-lg font-extrabold",l?"text-cw":"text-text-secondary"),children:t.getUTCDate()})]},s)})]}),H.map(t=>{var l,d;const s=$(t),a=F.find(N=>N.shift===t);return e.jsxs("div",{className:"grid grid-cols-[100px_repeat(7,1fr)] gap-1.5 mb-1.5",children:[e.jsxs("div",{className:"flex flex-col justify-center px-2 py-3",children:[e.jsx("div",{className:"text-[11px] font-bold text-text-muted uppercase tracking-wider",children:(d=(l=ee[t])==null?void 0:l.split("·")[0])==null?void 0:d.trim()}),e.jsx("div",{className:"text-[10px] text-text-muted mt-0.5",children:t}),s&&e.jsx("div",{className:x("text-[10px] font-bold mt-1",s.colorClass.split(" ")[0]),children:s.tl}),e.jsxs("div",{className:"text-[9px] text-text-muted mt-0.5",children:["avg ",a==null?void 0:a.avg,"/day"]})]}),S.map((N,T)=>{const J=N.toISOString().split("T")[0]===L,K=U(T,t);return e.jsx(ie,{schedules:K,dayIdx:T,shift:t,isToday:J,onAdd:()=>E({dayIdx:T,shift:t}),onRemove:R},`${T}-${t}`)})]},t)})]})}),e.jsxs("div",{className:"xl:w-64 shrink-0 space-y-4",children:[e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl p-4",children:[e.jsx("h3",{className:"text-xs font-bold text-text-muted uppercase tracking-wider mb-3",children:"Shift Balance"}),e.jsx("div",{className:"space-y-3",children:F.map(({shift:t,count:s,avg:a})=>{const l=$(t),d=Math.min(s/Math.max(O,1)*300,100);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] font-semibold text-text-secondary",children:(l==null?void 0:l.tl)||t}),e.jsx("span",{className:"text-xs font-bold text-text-primary",children:s})]}),e.jsx("div",{className:"w-full h-1.5 bg-surface-3 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${d}%`,backgroundColor:(l==null?void 0:l.color)||"#1a90c8"}})})]},t)})})]}),k.length>0&&e.jsxs("div",{className:"bg-surface-1 border border-warning/30 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(P,{size:14,className:"text-warning"}),e.jsxs("h3",{className:"text-xs font-bold text-warning uppercase tracking-wider",children:["Unassigned (",k.length,")"]})]}),e.jsx("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:k.map(t=>{var a,l,d,N;const s=(a=t.team_name)!=null&&a.includes("Huckle")?"bg-orange-400":(l=t.team_name)!=null&&l.includes("Danilyn")?"bg-blue-400":(d=t.team_name)!=null&&d.includes("Ezekiel")?"bg-purple-400":"bg-zinc-500";return e.jsxs("div",{className:"flex items-center gap-2 px-2.5 py-1.5 rounded-lg bg-surface-2 text-xs",children:[e.jsx("div",{className:x("w-2 h-2 rounded-full",s)}),e.jsx("span",{className:"text-text-primary font-medium flex-1 truncate",children:t.full_name}),e.jsx("span",{className:"text-[9px] text-text-muted",children:(N=t.team_name)==null?void 0:N.replace("Team ","")})]},t.id)})})]}),e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl p-4",children:[e.jsx("h3",{className:"text-xs font-bold text-text-muted uppercase tracking-wider mb-2",children:"Teams"}),["Team Huckle","Team Danilyn","Team Ezekiel"].map(t=>{$(t.includes("Huckle")?"00:00-08:00":t.includes("Danilyn")?"08:00-16:00":"16:00-00:00");const s=t.includes("Huckle")?"bg-orange-400":t.includes("Danilyn")?"bg-blue-400":"bg-purple-400",a=u.filter(l=>l.team_name===t).length;return e.jsxs("div",{className:"flex items-center gap-2 py-1",children:[e.jsx("div",{className:x("w-2.5 h-2.5 rounded-full",s)}),e.jsx("span",{className:"text-xs text-text-secondary flex-1",children:t}),e.jsx("span",{className:"text-[10px] text-text-muted",children:a})]},t)})]})]})]}),g&&e.jsx(ce,{chatters:u,existingIds:new Set(U(g.dayIdx,g.shift).map(t=>t.chatter_id)),onSelect:t=>W(g.dayIdx,g.shift,t),onClose:()=>E(null)})]})}export{be as default};
