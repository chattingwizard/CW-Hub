import{c as pe,u as G,r as a,s as S,j as e,y as ue,t as he,T as be,H as fe}from"./index-BP5YFlyp.js";import{g as de,i as ge,w as je,e as oe,d as ye,f as ce,h as Q,b as Ne,c as ve,a as _e,j as we}from"./scoreUtils-B_48C5u_.js";import{P as Y}from"./plus-DMkEW-A8.js";import{C as ie}from"./clock-CVz5ENYo.js";import{T as Z}from"./trash-2-DXlVcyGl.js";import{C as ke}from"./check-tJ1M7qo2.js";import{P as Se}from"./pen-line-Cc9w1otT.js";import{X as xe}from"./x-g7em6QJH.js";import{S as Ce}from"./save-DxJ8lXpM.js";import{T as Te}from"./trending-up-DoO1nyp9.js";import{T as $e}from"./trending-down-CsWcbWPH.js";import{M as Ee}from"./minus-L-lMFzMI.js";import{C as ze}from"./chevron-right-CosHkskW.js";import{T as Pe}from"./trophy-DPNwtgSU.js";import{D as Ae}from"./dollar-sign-7w4C7po7.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=pe("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);function Be({weekKey:n,eventTypes:m,chatters:p}){const{profile:b}=G(),[f,u]=a.useState(""),[C,l]=a.useState(new Date().toISOString().slice(0,10)),[o,g]=a.useState(null),[y,N]=a.useState(0),[d,h]=a.useState(""),[R,A]=a.useState(!1),[B,_]=a.useState([]),[q,T]=a.useState(!0),O=m.filter(s=>s.category==="positive"&&s.is_active),L=m.filter(s=>s.category==="negative"&&s.is_active),D=m.find(s=>s.category==="custom"&&s.is_active),$=o?o.category==="custom"?y:o.points:0;a.useEffect(()=>{w()},[n]);async function w(){T(!0);const{data:s}=await S.from("score_events").select("*, chatter:chatters(*), event_type:score_event_types(*)").eq("week",n).order("created_at",{ascending:!1}).limit(20);_(s||[]),T(!1)}async function W(){if(!(!f||!o||!b)){A(!0);try{const s=o.category==="custom"?y:o.points,v=de(new Date(C)),{error:z}=await S.from("score_events").insert({chatter_id:f,submitted_by:b.id,date:C,event_type_id:o.id,points:s,custom_points:o.category==="custom"?y:null,notes:d||null,week:v});if(z)throw z;u(""),g(null),N(0),h(""),w()}catch(s){console.error("Error logging event:",s)}finally{A(!1)}}}async function I(s){const{error:v}=await S.from("score_events").delete().eq("id",s);v||w()}return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-surface-1 rounded-xl border border-border p-5",children:[e.jsx("h3",{className:"text-sm font-semibold text-text-primary mb-4",children:"Log Score Event"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block",children:"Chatter"}),e.jsxs("select",{value:f,onChange:s=>u(s.target.value),className:"w-full bg-surface-2 border border-border rounded-lg px-3 py-2 text-sm text-text-primary",children:[e.jsx("option",{value:"",children:"Select chatter..."}),p.map(s=>e.jsxs("option",{value:s.id,children:[s.full_name," ",s.team_name?`(${s.team_name})`:""]},s.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block",children:"Date"}),e.jsx("input",{type:"date",value:C,onChange:s=>l(s.target.value),className:"w-full bg-surface-2 border border-border rounded-lg px-3 py-2 text-sm text-text-primary"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block",children:"Event Type"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-emerald-400/70 mb-1.5",children:"Positive"}),e.jsx("div",{className:"space-y-1",children:O.map(s=>e.jsxs("button",{onClick:()=>g(s),className:`w-full text-left px-3 py-2 rounded-lg text-xs font-medium transition-all border ${(o==null?void 0:o.id)===s.id?"bg-emerald-500/15 text-emerald-400 border-emerald-500/30":"bg-surface-2 text-text-secondary border-border hover:border-emerald-500/20"}`,children:[e.jsx("span",{children:s.name}),e.jsxs("span",{className:"float-right text-emerald-400",children:["+",s.points]})]},s.id))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-red-400/70 mb-1.5",children:"Negative"}),e.jsx("div",{className:"space-y-1",children:L.map(s=>e.jsxs("button",{onClick:()=>g(s),className:`w-full text-left px-3 py-2 rounded-lg text-xs font-medium transition-all border ${(o==null?void 0:o.id)===s.id?"bg-red-500/15 text-red-400 border-red-500/30":"bg-surface-2 text-text-secondary border-border hover:border-red-500/20"}`,children:[e.jsx("span",{children:s.name}),e.jsx("span",{className:"float-right text-red-400",children:s.points})]},s.id))})]})]}),D&&e.jsx("button",{onClick:()=>g(D),className:`w-full mt-2 text-left px-3 py-2 rounded-lg text-xs font-medium transition-all border ${(o==null?void 0:o.id)===D.id?"bg-cw/15 text-cw border-cw/30":"bg-surface-2 text-text-secondary border-border hover:border-cw/20"}`,children:"Others (Custom Points)"})]}),(o==null?void 0:o.category)==="custom"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block",children:"Custom Points"}),e.jsx("input",{type:"number",value:y,onChange:s=>N(parseInt(s.target.value)||0),className:"w-full bg-surface-2 border border-border rounded-lg px-3 py-2 text-sm text-text-primary",placeholder:"Enter points (negative or positive)"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block",children:"Notes (optional)"}),e.jsx("textarea",{value:d,onChange:s=>h(s.target.value),rows:2,className:"w-full bg-surface-2 border border-border rounded-lg px-3 py-2 text-sm text-text-primary resize-none",placeholder:"Add context..."})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-text-muted",children:"Points: "}),e.jsxs("span",{className:`font-bold ${$>0?"text-emerald-400":$<0?"text-red-400":"text-text-secondary"}`,children:[$>0?"+":"",$]})]}),e.jsxs("button",{onClick:W,disabled:!f||!o||R,className:"flex items-center gap-1.5 px-4 py-2 rounded-lg bg-cw text-white text-sm font-medium hover:bg-cw/90 disabled:opacity-40 disabled:cursor-not-allowed transition-all",children:[e.jsx(Y,{size:14}),R?"Logging...":"Log Event"]})]})]}),e.jsxs("div",{className:"bg-surface-1 rounded-xl border border-border p-5",children:[e.jsxs("h3",{className:"text-sm font-semibold text-text-primary mb-4 flex items-center gap-2",children:[e.jsx(ie,{size:14,className:"text-text-muted"}),"Recent Events This Week"]}),q?e.jsx("div",{className:"text-sm text-text-muted text-center py-8",children:"Loading..."}):B.length===0?e.jsx("div",{className:"text-sm text-text-muted text-center py-8",children:"No events logged this week"}):e.jsx("div",{className:"space-y-2 max-h-[500px] overflow-y-auto",children:B.map(s=>{var v,z;return e.jsxs("div",{className:"flex items-center gap-3 px-3 py-2.5 rounded-lg bg-surface-2 border border-border",children:[e.jsxs("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center text-xs font-bold shrink-0 ${s.points>0?"bg-emerald-500/15 text-emerald-400":s.points<0?"bg-red-500/15 text-red-400":"bg-zinc-500/15 text-zinc-400"}`,children:[s.points>0?"+":"",s.points]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-text-primary truncate",children:((v=s.chatter)==null?void 0:v.full_name)??"Unknown"}),e.jsxs("p",{className:"text-[10px] text-text-muted truncate",children:[((z=s.event_type)==null?void 0:z.name)??"Event"," Â· ",s.date,s.notes?` Â· ${s.notes}`:""]})]}),e.jsx("button",{onClick:()=>I(s.id),className:"p-1 rounded hover:bg-red-500/10 text-text-muted hover:text-red-400 transition-colors shrink-0",title:"Delete",children:e.jsx(Z,{size:13})})]},s.id)})})]})]})}const Le=["Team Huckle","Team Danilyn","Team Ezekiel"],De={"Team Huckle":"border-orange-500/30","Team Danilyn":"border-blue-500/30","Team Ezekiel":"border-purple-500/30"},Ie=["00:00-00:59","01:00-01:29","01:30-01:59","02:00-02:59","03:00-03:29","03:30-03:59","04:00+"];function Re({weekKey:n,chatters:m,config:p,onDataChange:b}){const{profile:f}=G(),[u,C]=a.useState([]),[l,o]=a.useState(!0),[g,y]=a.useState(!1),[N,d]=a.useState(null),[h,R]=a.useState(null),[A,B]=a.useState(""),[_,q]=a.useState(!1),[T,O]=a.useState(!1),[L,D]=a.useState(""),[$,w]=a.useState(!1);a.useEffect(()=>{W()},[n]);async function W(){o(!0);const{data:c}=await S.from("score_weekly_reports").select("*").eq("week",n);C(c||[]),o(!1)}function I(c,i){d(c),R(i||null),B((i==null?void 0:i.reply_time_bucket)||""),q((i==null?void 0:i.no_shift_incidence)||!1),O((i==null?void 0:i.all_reports_sent)||!1),D((i==null?void 0:i.notes)||""),y(!0)}function s(){y(!1),d(null),R(null)}const v=ge({reply_time_bucket:A,no_shift_incidence:_,all_reports_sent:T},p);async function z(){if(!(!N||!f)){w(!0);try{const i=je(n).toISOString().slice(0,10),P={chatter_id:N.id,submitted_by:f.id,week_start:i,week:n,reply_time_bucket:A||null,no_shift_incidence:_,all_reports_sent:T,weekly_points:v,notes:L||null};h?await S.from("score_weekly_reports").update(P).eq("id",h.id):await S.from("score_weekly_reports").insert(P),s(),W(),b()}catch(c){console.error("Error submitting weekly report:",c)}finally{w(!1)}}}return l?e.jsx("div",{className:"text-sm text-text-muted text-center py-12",children:"Loading weekly reports..."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Le.map(c=>{const i=m.filter(M=>M.team_name===c),P=De[c]||"border-border";return e.jsxs("div",{className:`bg-surface-1 rounded-xl border-2 ${P} p-4`,children:[e.jsxs("h3",{className:"text-sm font-semibold text-text-primary mb-3",children:[c,e.jsxs("span",{className:"text-text-muted font-normal ml-1.5 text-xs",children:["(",i.length,")"]})]}),i.length===0?e.jsx("p",{className:"text-xs text-text-muted py-4 text-center",children:"No chatters"}):e.jsx("div",{className:"space-y-1.5",children:i.map(M=>{const r=u.find(t=>t.chatter_id===M.id),j=!!r;return e.jsxs("div",{className:"flex items-center gap-2.5 px-3 py-2 rounded-lg bg-surface-2 border border-border",children:[e.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center shrink-0 ${j?"bg-emerald-500/20":"bg-zinc-500/20"}`,children:j?e.jsx(ke,{size:11,className:"text-emerald-400"}):e.jsx(ie,{size:11,className:"text-zinc-500"})}),e.jsx("span",{className:"text-xs text-text-primary flex-1 truncate",children:M.full_name}),j&&e.jsxs("span",{className:"text-[10px] font-bold text-emerald-400",children:["+",r.weekly_points]}),e.jsx("button",{onClick:()=>I(M,r),className:`text-[10px] px-2 py-1 rounded-md font-medium transition-all ${j?"bg-surface-3 text-text-muted hover:text-cw":"bg-cw/10 text-cw hover:bg-cw/20"}`,children:j?e.jsx(Se,{size:11}):"Submit"})]},M.id)})})]},c)})}),g&&N&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:s}),e.jsxs("div",{className:"relative bg-surface-1 border border-border rounded-xl w-full max-w-md mx-4 p-5 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-text-primary",children:[h?"Edit":"Submit"," Weekly Report"]}),e.jsx("p",{className:"text-xs text-text-muted",children:N.full_name})]}),e.jsx("button",{onClick:s,className:"p-1.5 rounded-lg hover:bg-surface-2 text-text-muted",children:e.jsx(xe,{size:16})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs text-text-muted mb-2 block",children:"Average Reply Time"}),e.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:Ie.map(c=>{var P;const i=((P=p.reply_time_points)==null?void 0:P[c])??0;return e.jsxs("button",{onClick:()=>B(c),className:`px-3 py-2 rounded-lg text-xs font-medium border transition-all ${A===c?i>=0?"bg-emerald-500/15 text-emerald-400 border-emerald-500/30":"bg-red-500/15 text-red-400 border-red-500/30":"bg-surface-2 text-text-secondary border-border hover:border-text-muted/30"}`,children:[e.jsx("span",{children:c}),e.jsxs("span",{className:`ml-1.5 ${i>=0?"text-emerald-400":"text-red-400"}`,children:[i>0?"+":"",i]})]},c)})})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("label",{className:"flex items-center gap-2.5 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:_,onChange:c=>q(c.target.checked),className:"w-4 h-4 rounded border-border bg-surface-2 text-cw accent-cw"}),e.jsx("span",{className:"text-xs text-text-primary",children:"No shift incidence"}),e.jsxs("span",{className:"text-xs text-emerald-400 ml-auto",children:["+",p.no_shift_incidence_pts]})]}),e.jsxs("label",{className:"flex items-center gap-2.5 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:T,onChange:c=>O(c.target.checked),className:"w-4 h-4 rounded border-border bg-surface-2 text-cw accent-cw"}),e.jsx("span",{className:"text-xs text-text-primary",children:"All reports sent on time"}),e.jsxs("span",{className:"text-xs text-emerald-400 ml-auto",children:["+",p.all_reports_sent_pts]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block",children:"Notes (optional)"}),e.jsx("textarea",{value:L,onChange:c=>D(c.target.value),rows:2,className:"w-full bg-surface-2 border border-border rounded-lg px-3 py-2 text-sm text-text-primary resize-none"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-border",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-text-muted",children:"Weekly Bonus: "}),e.jsxs("span",{className:`font-bold ${v>0?"text-emerald-400":"text-text-secondary"}`,children:["+",v," pts"]})]}),e.jsx("button",{onClick:z,disabled:$,className:"px-4 py-2 rounded-lg bg-cw text-white text-sm font-medium hover:bg-cw/90 disabled:opacity-40 transition-all",children:$?"Saving...":h?"Update":"Submit"})]})]})]})]})}const We=[{key:"00:00-00:59",label:"< 1 min"},{key:"01:00-01:29",label:"1:00 â€“ 1:29"},{key:"01:30-01:59",label:"1:30 â€“ 1:59"},{key:"02:00-02:59",label:"2:00 â€“ 2:59"},{key:"03:00-03:29",label:"3:00 â€“ 3:29"},{key:"03:30-03:59",label:"3:30 â€“ 3:59"},{key:"04:00+",label:"4:00+"}];function Me({config:n,eventTypes:m,onSave:p}){const{profile:b}=G(),[f,u]=a.useState(!1),[C,l]=a.useState([]),[o,g]=a.useState({}),[y,N]=a.useState(n.no_shift_incidence_pts),[d,h]=a.useState(n.all_reports_sent_pts),[R,A]=a.useState(n.base_score),[B,_]=a.useState(n.tier_20_threshold),[q,T]=a.useState(n.tier_10_threshold),[O,L]=a.useState(n.tier_5_threshold),[D,$]=a.useState(n.warning_threshold),[w,W]=a.useState(n.tier_20_amount),[I,s]=a.useState(n.tier_10_amount),[v,z]=a.useState(n.tier_5_amount);a.useEffect(()=>{l(m.map(t=>({...t}))),g({...n.reply_time_points||{}}),N(n.no_shift_incidence_pts),h(n.all_reports_sent_pts),A(n.base_score),_(n.tier_20_threshold),T(n.tier_10_threshold),L(n.tier_5_threshold),$(n.warning_threshold),W(n.tier_20_amount),s(n.tier_10_amount),z(n.tier_5_amount)},[n,m]);function c(t,x,k){l(E=>E.map(H=>H.id===t?{...H,[x]:k}:H))}function i(t){l(x=>x.map(k=>k.id===t?{...k,_deleted:!k._deleted,is_active:!!k._deleted}:k))}function P(t){l(x=>[...x,{id:`new-${Date.now()}`,name:"",points:t==="positive"?5:-5,category:t,is_active:!0,sort_order:x.length,created_at:new Date().toISOString(),_new:!0}])}async function M(){if(b){u(!0);try{await S.from("score_config").update({base_score:R,reply_time_points:o,no_shift_incidence_pts:y,all_reports_sent_pts:d,tier_20_threshold:B,tier_10_threshold:q,tier_5_threshold:O,warning_threshold:D,tier_20_amount:w,tier_10_amount:I,tier_5_amount:v,updated_by:b.id,updated_at:new Date().toISOString()}).eq("id",1);for(const t of C)t._new&&t.name?await S.from("score_event_types").insert({name:t.name,points:t.points,category:t.category,is_active:t.is_active,sort_order:t.sort_order}):t._new||await S.from("score_event_types").update({name:t.name,points:t.points,is_active:t.is_active,sort_order:t.sort_order}).eq("id",t.id);p()}catch(t){console.error("Error saving config:",t)}finally{u(!1)}}}const r=C.filter(t=>t.category==="positive"),j=C.filter(t=>t.category==="negative");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-surface-1 rounded-xl border border-border p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-xs font-bold uppercase tracking-wider text-emerald-400",children:"Positive Events"}),e.jsxs("button",{onClick:()=>P("positive"),className:"text-[10px] px-2 py-1 rounded-md bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500/20 transition-colors",children:[e.jsx(Y,{size:10,className:"inline mr-0.5"})," Add"]})]}),e.jsx("div",{className:"space-y-1.5",children:r.map(t=>e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg border border-border ${t._deleted?"opacity-40 bg-surface-2 line-through":"bg-surface-2"}`,children:[e.jsx("input",{value:t.name,onChange:x=>c(t.id,"name",x.target.value),className:"flex-1 bg-transparent text-xs text-text-primary outline-none",placeholder:"Event name..."}),e.jsx("input",{type:"number",value:t.points,onChange:x=>c(t.id,"points",parseInt(x.target.value)||0),className:"w-14 bg-surface-3 border border-border rounded px-2 py-1 text-xs text-emerald-400 text-center"}),e.jsx("button",{onClick:()=>i(t.id),className:"p-1 hover:bg-red-500/10 rounded text-text-muted hover:text-red-400 transition-colors",children:t._deleted?e.jsx(le,{size:12}):e.jsx(Z,{size:12})})]},t.id))})]}),e.jsxs("div",{className:"bg-surface-1 rounded-xl border border-border p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-xs font-bold uppercase tracking-wider text-red-400",children:"Negative Events"}),e.jsxs("button",{onClick:()=>P("negative"),className:"text-[10px] px-2 py-1 rounded-md bg-red-500/10 text-red-400 hover:bg-red-500/20 transition-colors",children:[e.jsx(Y,{size:10,className:"inline mr-0.5"})," Add"]})]}),e.jsx("div",{className:"space-y-1.5",children:j.map(t=>e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg border border-border ${t._deleted?"opacity-40 bg-surface-2 line-through":"bg-surface-2"}`,children:[e.jsx("input",{value:t.name,onChange:x=>c(t.id,"name",x.target.value),className:"flex-1 bg-transparent text-xs text-text-primary outline-none",placeholder:"Event name..."}),e.jsx("input",{type:"number",value:t.points,onChange:x=>c(t.id,"points",parseInt(x.target.value)||0),className:"w-14 bg-surface-3 border border-border rounded px-2 py-1 text-xs text-red-400 text-center"}),e.jsx("button",{onClick:()=>i(t.id),className:"p-1 hover:bg-red-500/10 rounded text-text-muted hover:text-red-400 transition-colors",children:t._deleted?e.jsx(le,{size:12}):e.jsx(Z,{size:12})})]},t.id))})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-surface-1 rounded-xl border border-border p-4",children:[e.jsx("h4",{className:"text-xs font-bold uppercase tracking-wider text-text-muted mb-3",children:"Base Score"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"number",value:R,onChange:t=>A(parseInt(t.target.value)||100),className:"w-24 bg-surface-2 border border-border rounded-lg px-3 py-2 text-sm text-text-primary text-center"}),e.jsx("span",{className:"text-xs text-text-muted",children:"points per week (resets Monday)"})]})]}),e.jsxs("div",{className:"bg-surface-1 rounded-xl border border-border p-4",children:[e.jsx("h4",{className:"text-xs font-bold uppercase tracking-wider text-text-muted mb-3",children:"Reply Time Points"}),e.jsx("div",{className:"space-y-1.5",children:We.map(({key:t,label:x})=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-surface-2",children:[e.jsx("span",{className:"text-xs text-text-secondary flex-1",children:x}),e.jsx("input",{type:"number",value:o[t]??0,onChange:k=>g(E=>({...E,[t]:parseInt(k.target.value)||0})),className:"w-16 bg-surface-3 border border-border rounded px-2 py-1 text-xs text-center text-text-primary"})]},t))})]}),e.jsxs("div",{className:"bg-surface-1 rounded-xl border border-border p-4",children:[e.jsx("h4",{className:"text-xs font-bold uppercase tracking-wider text-text-muted mb-3",children:"Weekly Checkbox Bonuses"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-text-secondary flex-1",children:"No shift incidence"}),e.jsx("input",{type:"number",value:y,onChange:t=>N(parseInt(t.target.value)||0),className:"w-16 bg-surface-2 border border-border rounded px-2 py-1 text-xs text-center text-text-primary"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-text-secondary flex-1",children:"All reports sent"}),e.jsx("input",{type:"number",value:d,onChange:t=>h(parseInt(t.target.value)||0),className:"w-16 bg-surface-2 border border-border rounded px-2 py-1 text-xs text-center text-text-primary"})]})]})]}),e.jsxs("div",{className:"bg-surface-1 rounded-xl border border-border p-4",children:[e.jsx("h4",{className:"text-xs font-bold uppercase tracking-wider text-text-muted mb-3",children:"Bonus Tiers"}),e.jsxs("div",{className:"space-y-2",children:[[{label:"$20 Bonus",threshold:B,setThreshold:_,amount:w,setAmount:W,color:"text-emerald-400"},{label:"$10 Bonus",threshold:q,setThreshold:T,amount:I,setAmount:s,color:"text-blue-400"},{label:"$5 Bonus",threshold:O,setThreshold:L,amount:v,setAmount:z,color:"text-cyan-400"}].map(t=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-surface-2",children:[e.jsx("span",{className:`text-xs font-medium w-20 ${t.color}`,children:t.label}),e.jsx("span",{className:"text-[10px] text-text-muted",children:"â‰¥"}),e.jsx("input",{type:"number",value:t.threshold,onChange:x=>t.setThreshold(parseInt(x.target.value)||0),className:"w-16 bg-surface-3 border border-border rounded px-2 py-1 text-xs text-center text-text-primary"}),e.jsx("span",{className:"text-[10px] text-text-muted",children:"pts"}),e.jsx("span",{className:"text-[10px] text-text-muted ml-auto",children:"$"}),e.jsx("input",{type:"number",value:t.amount,onChange:x=>t.setAmount(parseFloat(x.target.value)||0),className:"w-14 bg-surface-3 border border-border rounded px-2 py-1 text-xs text-center text-text-primary"})]},t.label)),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-surface-2",children:[e.jsx("span",{className:"text-xs font-medium w-20 text-red-400",children:"Warning"}),e.jsx("span",{className:"text-[10px] text-text-muted",children:"<"}),e.jsx("input",{type:"number",value:D,onChange:t=>$(parseInt(t.target.value)||0),className:"w-16 bg-surface-3 border border-border rounded px-2 py-1 text-xs text-center text-text-primary"}),e.jsx("span",{className:"text-[10px] text-text-muted",children:"pts"})]})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:M,disabled:f,className:"flex items-center gap-2 px-5 py-2.5 rounded-lg bg-cw text-white text-sm font-medium hover:bg-cw/90 disabled:opacity-40 transition-all",children:[e.jsx(Ce,{size:14}),f?"Saving...":"Save Configuration"]})})]})}function qe({chatterId:n,weekKey:m,config:p,scores:b,events:f,onClose:u,onLogEvent:C}){const l=b.find(d=>d.chatter_id===n);if(!l)return null;const o=oe(l.status),g=ye(l.total,p),y=f.filter(d=>d.chatter_id===n).sort((d,h)=>new Date(h.created_at).getTime()-new Date(d.created_at).getTime()),N=[{label:"$5",threshold:p.tier_5_threshold,color:"bg-cyan-400"},{label:"$10",threshold:p.tier_10_threshold,color:"bg-blue-400"},{label:"$20",threshold:p.tier_20_threshold,color:"bg-emerald-400"}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50",onClick:u}),e.jsxs("div",{className:"fixed top-0 right-0 h-full w-full max-w-[420px] bg-surface-1 border-l border-border z-50 flex flex-col animate-slide-in-right shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-cw/15 flex items-center justify-center ring-1 ring-cw/20",children:e.jsx("span",{className:"text-cw text-sm font-bold",children:l.chatter_name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-text-primary",children:l.chatter_name}),e.jsxs("p",{className:"text-[10px] text-text-muted",children:[l.team_name??"No team"," Â· ",ce(m)]})]})]}),e.jsx("button",{onClick:u,className:"p-1.5 rounded-lg hover:bg-surface-2 text-text-muted",children:e.jsx(xe,{size:16})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-5",children:[e.jsxs("div",{className:"text-center py-3",children:[e.jsx("div",{className:`text-5xl font-extrabold ${Q(l.total,p)}`,children:l.total}),e.jsx("div",{className:"mt-1.5",children:e.jsx("span",{className:`text-[10px] px-2.5 py-1 rounded-full font-bold border ${o.colorClass}`,children:o.label})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative h-3 bg-surface-3 rounded-full overflow-hidden",children:[e.jsx("div",{className:`absolute left-0 top-0 h-full rounded-full transition-all ${l.status==="warning"?"bg-red-500":l.status==="no_bonus"?"bg-zinc-500":l.status==="bonus_5"?"bg-cyan-400":l.status==="bonus_10"?"bg-blue-400":"bg-emerald-400"}`,style:{width:`${g}%`}}),N.map(d=>{const h=d.threshold/(p.tier_20_threshold+10)*100;return e.jsx("div",{className:"absolute top-0 h-full w-px bg-white/20",style:{left:`${h}%`}},d.label)})]}),e.jsxs("div",{className:"flex justify-between text-[9px] text-text-muted",children:[e.jsx("span",{children:"0"}),N.map(d=>e.jsxs("span",{children:[d.threshold," (",d.label,")"]},d.label))]})]}),e.jsxs("div",{className:"bg-surface-2 rounded-xl border border-border p-3 space-y-2",children:[e.jsx("h4",{className:"text-[10px] font-bold uppercase tracking-wider text-text-muted",children:"Breakdown"}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-text-secondary",children:"Base Score"}),e.jsx("span",{className:"font-medium text-text-primary",children:l.base_score})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-text-secondary",children:"Event Points"}),e.jsxs("span",{className:`font-medium ${l.event_points>0?"text-emerald-400":l.event_points<0?"text-red-400":"text-text-muted"}`,children:[l.event_points>0?"+":"",l.event_points]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-text-secondary",children:"Weekly Report"}),e.jsxs("span",{className:`font-medium ${l.weekly_report_points>0?"text-emerald-400":"text-text-muted"}`,children:[l.weekly_report_points>0?"+":"",l.weekly_report_points]})]}),e.jsxs("div",{className:"border-t border-border pt-2 flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-semibold text-text-primary",children:"Total"}),e.jsx("span",{className:`font-bold ${Q(l.total,p)}`,children:l.total})]})]}),l.weekly_report&&e.jsxs("div",{className:"bg-surface-2 rounded-xl border border-border p-3",children:[e.jsx("h4",{className:"text-[10px] font-bold uppercase tracking-wider text-text-muted mb-2",children:"Weekly Report"}),e.jsxs("div",{className:"space-y-1.5 text-xs",children:[l.weekly_report.reply_time_bucket&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-secondary",children:"Reply Time"}),e.jsx("span",{className:"text-text-primary font-medium",children:l.weekly_report.reply_time_bucket})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-secondary",children:"No Shift Incidence"}),e.jsx("span",{className:l.weekly_report.no_shift_incidence?"text-emerald-400":"text-text-muted",children:l.weekly_report.no_shift_incidence?"Yes":"No"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-secondary",children:"All Reports Sent"}),e.jsx("span",{className:l.weekly_report.all_reports_sent?"text-emerald-400":"text-text-muted",children:l.weekly_report.all_reports_sent?"Yes":"No"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-[10px] font-bold uppercase tracking-wider text-text-muted mb-2",children:"Event History"}),y.length===0?e.jsx("p",{className:"text-xs text-text-muted py-3 text-center",children:"No events this week"}):e.jsx("div",{className:"space-y-1.5",children:y.map(d=>{var h;return e.jsxs("div",{className:"flex items-center gap-2.5 px-3 py-2 rounded-lg bg-surface-2 border border-border",children:[e.jsx("div",{className:`w-6 h-6 rounded flex items-center justify-center shrink-0 ${d.points>0?"bg-emerald-500/15":d.points<0?"bg-red-500/15":"bg-zinc-500/15"}`,children:d.points>0?e.jsx(Te,{size:11,className:"text-emerald-400"}):d.points<0?e.jsx($e,{size:11,className:"text-red-400"}):e.jsx(Ee,{size:11,className:"text-zinc-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[11px] font-medium text-text-primary truncate",children:((h=d.event_type)==null?void 0:h.name)??"Event"}),e.jsxs("p",{className:"text-[9px] text-text-muted",children:[d.date,d.notes?` Â· ${d.notes}`:""]})]}),e.jsxs("span",{className:`text-xs font-bold shrink-0 ${d.points>0?"text-emerald-400":d.points<0?"text-red-400":"text-text-muted"}`,children:[d.points>0?"+":"",d.points]})]},d.id)})})]})]}),e.jsx("div",{className:"border-t border-border p-4 shrink-0 flex gap-2",children:e.jsxs("button",{onClick:C,className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-2.5 rounded-lg bg-cw text-white text-xs font-medium hover:bg-cw/90 transition-all",children:[e.jsx(Y,{size:13}),"Add Event"]})})]})]})}function rt(){const{profile:n}=G(),[m,p]=a.useState(()=>de(new Date)),[b,f]=a.useState("leaderboard"),[u,C]=a.useState(null),[l,o]=a.useState([]),[g,y]=a.useState([]),[N,d]=a.useState([]),[h,R]=a.useState([]),[A,B]=a.useState(!0),[_,q]=a.useState([]),[T,O]=a.useState("all"),[L,D]=a.useState("all"),[$,w]=a.useState(null),W=(n==null?void 0:n.role)==="owner"||(n==null?void 0:n.role)==="admin",I=a.useCallback(async()=>{B(!0);try{const[r,j,t,x,k]=await Promise.all([S.from("score_config").select("*").eq("id",1).single(),S.from("score_event_types").select("*").order("sort_order"),S.from("chatters").select("*").eq("status","Active").eq("airtable_role","Chatter").order("full_name"),S.from("score_events").select("*, event_type:score_event_types(*)").eq("week",m),S.from("score_weekly_reports").select("*").eq("week",m)]),E=r.data,H=j.data||[],ee=t.data||[],te=x.data||[],se=k.data||[];if(C(E),o(H),y(ee),d(te),R(se),E){const re=ee.map(F=>{const K=te.filter(U=>U.chatter_id===F.id),ae=K.reduce((U,me)=>U+me.points,0),V=se.find(U=>U.chatter_id===F.id)||null,ne=(V==null?void 0:V.weekly_points)??0,J=E.base_score+ae+ne;return{chatter_id:F.id,chatter_name:F.full_name,team_name:F.team_name,base_score:E.base_score,event_points:ae,weekly_report_points:ne,total:J,status:ve(J,E),bonus_amount:Ne(J,E),events:K,weekly_report:V}});re.sort((F,K)=>K.total-F.total),q(re)}}catch(r){console.error("ChatterScore load failed:",r)}finally{B(!1)}},[m]);a.useEffect(()=>{I()},[I]);const s=_.filter(r=>!(T!=="all"&&r.team_name!==T||L!=="all"&&r.status!==L)),v=_.filter(r=>r.bonus_amount>0).length,z=_.filter(r=>r.status==="warning").length,c=g.length-h.length,i=_.reduce((r,j)=>r+j.bonus_amount,0),P=[...new Set(g.map(r=>r.team_name).filter(Boolean))],M=[{id:"leaderboard",label:"Leaderboard"},{id:"log-event",label:"Log Event"},{id:"weekly-reports",label:"Weekly Reports"},{id:"config",label:"Score Config",adminOnly:!0}];return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-xl bg-amber-500/15 flex items-center justify-center",children:e.jsx(ue,{size:18,className:"text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-text-primary",children:"Chatter Score"}),e.jsx("p",{className:"text-xs text-text-muted",children:"Track performance points & weekly bonuses"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-surface-1 border border-border rounded-lg px-1 py-1",children:[e.jsx("button",{onClick:()=>p(_e(m)),className:"p-1.5 rounded-md hover:bg-surface-2 text-text-muted hover:text-text-primary transition-colors",children:e.jsx(he,{size:14})}),e.jsx("span",{className:"text-xs font-medium text-text-primary px-2 min-w-[200px] text-center",children:ce(m)}),e.jsx("button",{onClick:()=>p(we(m)),className:"p-1.5 rounded-md hover:bg-surface-2 text-text-muted hover:text-text-primary transition-colors",children:e.jsx(ze,{size:14})})]}),e.jsxs("button",{onClick:()=>{f("log-event")},className:"flex items-center gap-1.5 px-3 py-2 rounded-lg bg-cw text-white text-xs font-medium hover:bg-cw/90 transition-all",children:[e.jsx(Y,{size:13}),"Log Event"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx(X,{icon:e.jsx(Pe,{size:15}),label:"Bonus Earners",value:v,color:"text-emerald-400",bg:"bg-emerald-500/10"}),e.jsx(X,{icon:e.jsx(be,{size:15}),label:"Warnings",value:z,color:"text-red-400",bg:"bg-red-500/10"}),e.jsx(X,{icon:e.jsx(fe,{size:15}),label:"Pending Reports",value:c,color:"text-amber-400",bg:"bg-amber-500/10"}),e.jsx(X,{icon:e.jsx(Ae,{size:15}),label:"Total Bonuses",value:`$${i}`,color:"text-cw",bg:"bg-cw/10"})]}),e.jsx("div",{className:"flex gap-0.5 bg-surface-1 border border-border rounded-xl p-1 w-fit mb-1",children:M.filter(r=>!r.adminOnly||W).map(r=>e.jsx("button",{onClick:()=>f(r.id),className:`px-4 py-2 rounded-lg text-xs font-medium transition-all ${b===r.id?"bg-surface-3 text-text-primary shadow-sm":"text-text-muted hover:text-text-primary"}`,children:r.label},r.id))}),A?e.jsx("div",{className:"text-sm text-text-muted text-center py-16",children:"Loading score data..."}):e.jsxs(e.Fragment,{children:[b==="leaderboard"&&u&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("select",{value:T,onChange:r=>O(r.target.value),className:"bg-surface-1 border border-border rounded-lg px-3 py-1.5 text-xs text-text-primary",children:[e.jsx("option",{value:"all",children:"All Teams"}),P.map(r=>e.jsx("option",{value:r,children:r},r))]}),e.jsxs("select",{value:L,onChange:r=>D(r.target.value),className:"bg-surface-1 border border-border rounded-lg px-3 py-1.5 text-xs text-text-primary",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"bonus_20",children:"$20 Bonus"}),e.jsx("option",{value:"bonus_10",children:"$10 Bonus"}),e.jsx("option",{value:"bonus_5",children:"$5 Bonus"}),e.jsx("option",{value:"no_bonus",children:"No Bonus"}),e.jsx("option",{value:"warning",children:"Warning"})]})]}),e.jsx("div",{className:"bg-surface-1 rounded-xl border border-border overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("th",{className:"text-left text-[10px] font-bold uppercase tracking-wider text-text-muted px-4 py-3 w-10",children:"#"}),e.jsx("th",{className:"text-left text-[10px] font-bold uppercase tracking-wider text-text-muted px-4 py-3",children:"Name"}),e.jsx("th",{className:"text-left text-[10px] font-bold uppercase tracking-wider text-text-muted px-4 py-3",children:"Team"}),e.jsx("th",{className:"text-right text-[10px] font-bold uppercase tracking-wider text-text-muted px-4 py-3",children:"Events"}),e.jsx("th",{className:"text-right text-[10px] font-bold uppercase tracking-wider text-text-muted px-4 py-3",children:"Weekly"}),e.jsx("th",{className:"text-right text-[10px] font-bold uppercase tracking-wider text-text-muted px-4 py-3",children:"Total"}),e.jsx("th",{className:"text-center text-[10px] font-bold uppercase tracking-wider text-text-muted px-4 py-3",children:"Status"}),e.jsx("th",{className:"text-right text-[10px] font-bold uppercase tracking-wider text-text-muted px-4 py-3",children:"Bonus"}),e.jsx("th",{className:"px-4 py-3 w-16"})]})}),e.jsxs("tbody",{children:[s.map((r,j)=>{var x,k,E;const t=oe(r.status);return e.jsxs("tr",{className:"border-b border-border/50 hover:bg-surface-2/50 transition-colors cursor-pointer",onClick:()=>w(r.chatter_id),children:[e.jsx("td",{className:"px-4 py-2.5 text-xs text-text-muted font-medium",children:j===0?"ðŸ¥‡":j===1?"ðŸ¥ˆ":j===2?"ðŸ¥‰":j+1}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-[7px] h-[7px] rounded-full shrink-0 ${(x=r.team_name)!=null&&x.includes("Huckle")?"bg-team-huckle":(k=r.team_name)!=null&&k.includes("Danilyn")?"bg-team-danilyn":(E=r.team_name)!=null&&E.includes("Ezekiel")?"bg-team-ezekiel":"bg-text-muted"}`}),e.jsx("span",{className:"text-xs font-medium text-text-primary",children:r.chatter_name})]})}),e.jsx("td",{className:"px-4 py-2.5",children:r.team_name&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-surface-3 text-text-muted font-medium",children:r.team_name.replace("Team ","")})}),e.jsxs("td",{className:`px-4 py-2.5 text-xs text-right font-medium ${r.event_points>0?"text-emerald-400":r.event_points<0?"text-red-400":"text-text-muted"}`,children:[r.event_points>0?"+":"",r.event_points]}),e.jsxs("td",{className:`px-4 py-2.5 text-xs text-right font-medium ${r.weekly_report_points>0?"text-emerald-400":"text-text-muted"}`,children:[r.weekly_report_points>0?"+":"",r.weekly_report_points]}),e.jsx("td",{className:`px-4 py-2.5 text-sm text-right font-bold ${Q(r.total,u)}`,children:r.total}),e.jsx("td",{className:"px-4 py-2.5 text-center",children:e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-bold border ${t.colorClass}`,children:t.label})}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-right font-bold text-text-primary",children:r.bonus_amount>0?`$${r.bonus_amount}`:"â€”"}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("button",{onClick:()=>w(r.chatter_id),className:"text-[10px] px-2.5 py-1 rounded-md bg-surface-3 text-text-muted hover:text-cw hover:bg-cw/10 font-medium transition-all",children:"View"})})]},r.chatter_id)}),s.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-4 py-8 text-center text-sm text-text-muted",children:"No chatters match the selected filters"})})]})]})})})]}),b==="log-event"&&e.jsx(Be,{weekKey:m,eventTypes:l,chatters:g}),b==="weekly-reports"&&u&&e.jsx(Re,{weekKey:m,chatters:g,config:u,onDataChange:I}),b==="config"&&W&&u&&e.jsx(Me,{config:u,eventTypes:l,onSave:I})]}),$&&u&&e.jsx(qe,{chatterId:$,weekKey:m,config:u,scores:_,events:N,onClose:()=>w(null),onLogEvent:()=>{w(null),f("log-event")}})]})}function X({icon:n,label:m,value:p,color:b,bg:f}){return e.jsxs("div",{className:"bg-surface-1 rounded-xl border border-border p-4 flex items-center gap-3",children:[e.jsx("div",{className:`w-9 h-9 rounded-lg ${f} flex items-center justify-center ${b}`,children:n}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wider font-bold",children:m}),e.jsx("p",{className:`text-xl font-bold ${b}`,children:p})]})]})}export{rt as default};
