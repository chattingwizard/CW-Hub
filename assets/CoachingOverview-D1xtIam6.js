import{c as v,r as h,j as e,s as y,U as w,T as C,x as k}from"./index-BP5YFlyp.js";import{R as S}from"./refresh-cw-C55LD8pV.js";import{L as D}from"./loader-circle-BC4jqH9m.js";import{C as T,a as R}from"./chevron-up-RJvm1lta.js";import{C as $}from"./circle-check-BtOlKDys.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=v("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),b=[{key:"huckle",name:"Huckle",shift:"00:00–08:00",color:"bg-orange-500"},{key:"danilyn",name:"Danilyn",shift:"08:00–16:00",color:"bg-blue-500"},{key:"ezekiel",name:"Ezekiel",shift:"16:00–00:00",color:"bg-purple-500"}];function o(c,a){if(c==null)return a;if(typeof c=="string")try{return JSON.parse(c)}catch{return a}return c}function M({rate:c,size:a=56}){const x=(a-6)/2,m=2*Math.PI*x,u=m*(1-c/100),p=c>=80?"#22c55e":c>=50?"#eab308":"#ef4444";return e.jsxs("svg",{width:a,height:a,className:"shrink-0",children:[e.jsx("circle",{cx:a/2,cy:a/2,r:x,fill:"none",stroke:"#252525",strokeWidth:4}),e.jsx("circle",{cx:a/2,cy:a/2,r:x,fill:"none",stroke:p,strokeWidth:4,strokeLinecap:"round",strokeDasharray:m,strokeDashoffset:u,transform:`rotate(-90 ${a/2} ${a/2})`,className:"transition-all duration-700"}),e.jsxs("text",{x:"50%",y:"50%",textAnchor:"middle",dy:".35em",fill:p,fontSize:a*.28,fontWeight:"bold",children:[c,"%"]})]})}function z({tl:c,tasks:a,logs:x,expanded:m,onToggle:u}){const p=a.filter(s=>s.status==="pending"),j=a.filter(s=>s.status==="completed"),g=a.filter(s=>s.status==="skipped"),i=a.length-g.length,N=i>0?Math.round(j.length/i*100):100,f=a.reduce((s,t)=>{const r=o(t.red_flags,[]);return s+r.length},0),l=(()=>{const s=a.map(t=>t.perf_score).filter(t=>t!==null&&t>0);return s.length===0?null:Math.round(s.reduce((t,r)=>t+r,0)/s.length)})();return e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-4 px-5 py-4 cursor-pointer hover:bg-surface-2/50",onClick:u,children:[e.jsx("div",{className:`w-1 h-10 rounded-full ${c.color}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-white",children:c.name}),e.jsxs("span",{className:"text-xs text-text-muted",children:[c.shift," UTC"]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5 text-xs text-text-secondary",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(w,{size:11}),i," chatters"]}),f>0&&e.jsxs("span",{className:"flex items-center gap-1 text-danger",children:[e.jsx(C,{size:11}),f," flags"]}),l!==null&&e.jsxs("span",{className:`flex items-center gap-1 ${l>=60?"text-success":l>=40?"text-warning":"text-danger"}`,children:[e.jsx(k,{size:11}),"Avg: ",l]})]})]}),e.jsx(M,{rate:N}),e.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[e.jsxs("span",{className:"text-xs text-success",children:[j.length," done"]}),e.jsxs("span",{className:"text-xs text-warning",children:[p.length," pending"]}),g.length>0&&e.jsxs("span",{className:"text-xs text-text-muted",children:[g.length," skipped"]})]}),m?e.jsx(T,{size:14,className:"text-text-muted ml-1"}):e.jsx(R,{size:14,className:"text-text-muted ml-1"})]}),m&&e.jsx("div",{className:"border-t border-border",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-text-muted text-left",children:[e.jsx("th",{className:"px-5 py-2 font-medium",children:"Status"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Chatter"}),e.jsx("th",{className:"px-3 py-2 font-medium text-center",children:"Score"}),e.jsx("th",{className:"px-3 py-2 font-medium text-center",children:"Days"}),e.jsx("th",{className:"px-3 py-2 font-medium text-center",children:"Flags"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Completed"})]})}),e.jsx("tbody",{children:a.filter(s=>s.status!=="skipped").sort((s,t)=>t.priority-s.priority).map(s=>{const t=o(s.red_flags,[]),r=x.find(d=>d.task_id===s.id);return e.jsxs("tr",{className:"border-t border-border/50 hover:bg-surface-2/30",children:[e.jsx("td",{className:"px-5 py-2.5",children:s.status==="completed"?e.jsx($,{size:16,className:"text-success"}):e.jsx(L,{size:16,className:"text-text-muted"})}),e.jsx("td",{className:"px-3 py-2.5 text-white font-medium",children:s.chatter_name}),e.jsx("td",{className:"px-3 py-2.5 text-center",children:e.jsx("span",{className:`font-bold ${s.perf_score===null?"text-text-muted":s.perf_score>=70?"text-success":s.perf_score>=40?"text-warning":"text-danger"}`,children:s.perf_score??"—"})}),e.jsx("td",{className:"px-3 py-2.5 text-center",children:e.jsx("span",{className:s.days_since_coaching>=999?"text-danger font-bold":s.days_since_coaching>=4?"text-danger":s.days_since_coaching>=2?"text-warning":"text-text-secondary",children:s.days_since_coaching>=999?"Never":`${s.days_since_coaching}d`})}),e.jsx("td",{className:"px-3 py-2.5 text-center",children:t.length>0?e.jsx("span",{className:"text-danger",title:t.map(d=>d.kpi).join(", "),children:t.length}):e.jsx("span",{className:"text-text-muted",children:"0"})}),e.jsx("td",{className:"px-3 py-2.5 text-text-secondary",children:r?e.jsxs("span",{className:"text-success",children:[r.focus_kpi||"General",r.notes?` — ${r.notes.slice(0,40)}`:""]}):s.status==="completed"?e.jsx("span",{className:"text-success",children:"Done"}):e.jsx("span",{className:"text-text-muted",children:"—"})})]},s.id)})})]})})]})}function A(){const[c,a]=h.useState([]),[x,m]=h.useState([]),[u,p]=h.useState(!0),[j,g]=h.useState(b.map(t=>t.key)),[i,N]=h.useState(new Date().toISOString().split("T")[0]),f=async()=>{p(!0);const[t,r]=await Promise.all([y.from("coaching_tasks").select("*").eq("date",i).order("priority",{ascending:!1}),y.from("coaching_logs").select("*").eq("date",i)]);t.data&&a(t.data.map(d=>{const n=d;return{...n,red_flags:o(n.red_flags,[]),talking_points:o(n.talking_points,[]),kpis:o(n.kpis,{}),active_goal:o(n.active_goal,null),goal_progress:o(n.goal_progress,null),recent_reports:o(n.recent_reports,[])}})),r.data&&m(r.data),p(!1)};h.useEffect(()=>{f()},[i]);const l=h.useMemo(()=>{const t=c.filter(n=>n.status!=="skipped"),r=t.filter(n=>n.status==="completed"),d=c.reduce((n,_)=>n+o(_.red_flags,[]).length,0);return{total:t.length,completed:r.length,rate:t.length>0?Math.round(r.length/t.length*100):100,flags:d}},[c]),s=t=>{g(r=>r.includes(t)?r.filter(d=>d!==t):[...r,t])};return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-extrabold text-text-primary",children:"Coaching Overview"}),e.jsx("p",{className:"text-text-secondary text-sm mt-1",children:"Monitor coaching compliance across all teams."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"date",value:i,onChange:t=>N(t.target.value),className:"bg-surface-2 border border-border rounded-lg px-3 py-2 text-sm text-white focus:border-cw outline-none"}),e.jsx("button",{onClick:f,className:"p-2 rounded-lg hover:bg-surface-2 text-text-secondary hover:text-white",children:e.jsx(S,{size:16})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl px-4 py-3",children:[e.jsx("p",{className:"text-xs text-text-muted",children:"Completion Rate"}),e.jsxs("p",{className:`text-2xl font-bold ${l.rate>=80?"text-success":l.rate>=50?"text-warning":"text-danger"}`,children:[l.rate,"%"]})]}),e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl px-4 py-3",children:[e.jsx("p",{className:"text-xs text-text-muted",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-success",children:l.completed})]}),e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl px-4 py-3",children:[e.jsx("p",{className:"text-xs text-text-muted",children:"Total Required"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:l.total})]}),e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl px-4 py-3",children:[e.jsx("p",{className:"text-xs text-text-muted",children:"Red Flags"}),e.jsx("p",{className:`text-2xl font-bold ${l.flags>0?"text-danger":"text-text-muted"}`,children:l.flags})]})]}),u?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx(D,{className:"animate-spin text-cw",size:24})}):e.jsx("div",{className:"space-y-3",children:b.map(t=>e.jsx(z,{tl:t,tasks:c.filter(r=>r.team_tl===t.key),logs:x.filter(r=>r.team_tl===t.key),expanded:j.includes(t.key),onToggle:()=>s(t.key)},t.key))})]})}export{A as default};
