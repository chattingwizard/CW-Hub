import{c as L,u as F,N as U,r as a,s as T,j as e,H as Y,T as V,O as X,t as Z}from"./index-BP5YFlyp.js";import{g as J}from"./scoreUtils-B_48C5u_.js";import{C as Q}from"./clipboard-list-C1J_Ovlt.js";import{S as W}from"./send-CVZ1o3y8.js";import{L as R}from"./loader-circle-BC4jqH9m.js";import{C as E}from"./check-tJ1M7qo2.js";import{X as G}from"./x-g7em6QJH.js";import{C as ee,a as K}from"./chevron-up-RJvm1lta.js";import{T as H}from"./trash-2-DXlVcyGl.js";import{C as te}from"./chevron-right-CosHkskW.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=L("ArrowLeftRight",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=L("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=L("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=L("SignalHigh",[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}],["path",{d:"M12 20v-8",key:"i3yub9"}],["path",{d:"M17 20V8",key:"1tkaf5"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=L("SignalLow",[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=L("SignalMedium",[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}],["path",{d:"M12 20v-8",key:"i3yub9"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=L("StickyNote",[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]]),P=["Team Danilyn","Team Huckle","Team Ezekiel"],le=[1,2,3,4,5,6,7,8],ce=["low","moderate","high"],B={low:{label:"Low",icon:ne,color:"text-blue-400 bg-blue-500/15 border-blue-500/30"},moderate:{label:"Moderate",icon:de,color:"text-yellow-400 bg-yellow-500/15 border-yellow-500/30"},high:{label:"High",icon:re,color:"text-red-400 bg-red-500/15 border-red-500/30"}};function _e(){const{profile:x}=F(),r=x?U(x.role):!1,[n,f]=a.useState("submit"),[N,S]=a.useState([]),[_,g]=a.useState(!0);a.useEffect(()=>{m()},[]);async function m(){const{data:p}=await T.from("chatters").select("*").eq("status","Active").eq("airtable_role","Chatter").order("full_name");S(p||[]),g(!1)}const j=[{id:"submit",label:"Submit Report",icon:W},{id:"reports",label:"Reports",icon:Y},...r?[{id:"alerts",label:"Alerts",icon:V}]:[]];return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold text-text-primary flex items-center gap-2",children:[e.jsx(Q,{size:22,className:"text-cw"}),"Shift Reports"]}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Submit your end-of-shift report"})]}),e.jsx("div",{className:"flex gap-1 bg-surface-1 rounded-xl p-1 border border-border w-fit",children:j.map(p=>e.jsxs("button",{onClick:()=>f(p.id),className:`flex items-center gap-1.5 px-4 py-2 rounded-lg text-sm font-medium transition-all ${n===p.id?"bg-cw text-white shadow-sm":"text-text-muted hover:text-text-primary hover:bg-surface-2"}`,children:[e.jsx(p.icon,{size:14}),p.label]},p.id))}),_?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(R,{size:20,className:"animate-spin text-cw"})}):e.jsxs(e.Fragment,{children:[n==="submit"&&e.jsx(oe,{chatters:N}),n==="reports"&&e.jsx(xe,{chatters:N}),n==="alerts"&&r&&e.jsx(me,{chatters:N})]})]})}function oe({chatters:x}){const{profile:r}=F(),n=a.useMemo(()=>(r==null?void 0:r.role)==="chatter"?x.find(s=>s.profile_id===r.id):null,[x,r]),[f,N]=a.useState((n==null?void 0:n.id)||""),[S,_]=a.useState(new Date().toISOString().slice(0,10)),[g,m]=a.useState((n==null?void 0:n.team_name)||""),[j,p]=a.useState(1),[M,i]=a.useState("moderate"),[o,h]=a.useState(!1),[u,y]=a.useState(""),[b,w]=a.useState(!1),[z,t]=a.useState(""),[v,d]=a.useState(""),[c,k]=a.useState(!1),[D,l]=a.useState(null);a.useEffect(()=>{n&&(N(n.id),n.team_name&&m(n.team_name))},[n]);async function C(){if(!(!f||!g||!r)){k(!0),l(null);try{const{error:s}=await T.from("shift_reports").insert({chatter_id:f,date:S,team:g,model_team:j,traffic_level:M,has_incident:o,incident_notes:o&&u||null,has_cover:b,cover_notes:b&&z||null,notes:v||null,submitted_by:r.id});if(s)if(s.code==="23505")l({ok:!1,msg:"A shift report already exists for this chatter on this date."});else throw s;else l({ok:!0,msg:"Shift report submitted successfully!"}),h(!1),y(""),w(!1),t(""),d("")}catch(s){const $=s instanceof Error?s.message:"Failed to submit report";l({ok:!1,msg:$})}finally{k(!1)}}}const I=(r==null?void 0:r.role)==="chatter";return e.jsxs("div",{className:"bg-surface-1 rounded-xl border border-border p-6 max-w-2xl",children:[e.jsx("h3",{className:"text-sm font-semibold text-text-primary mb-5",children:"New Shift Report"}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block",children:"Chatter Name"}),e.jsxs("select",{value:f,onChange:s=>N(s.target.value),disabled:I&&!!n,className:"w-full bg-surface-2 border border-border rounded-lg px-3 py-2.5 text-sm text-text-primary disabled:opacity-60",children:[e.jsx("option",{value:"",children:"Select chatter..."}),x.map(s=>e.jsxs("option",{value:s.id,children:[s.full_name," ",s.team_name?`(${s.team_name})`:""]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block",children:"Date"}),e.jsx(ue,{value:S,onChange:_})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block",children:"Team"}),e.jsxs("select",{value:g,onChange:s=>m(s.target.value),className:"w-full bg-surface-2 border border-border rounded-lg px-3 py-2.5 text-sm text-text-primary",children:[e.jsx("option",{value:"",children:"Select team..."}),P.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block",children:"Model Team"}),e.jsx("select",{value:j,onChange:s=>p(parseInt(s.target.value)),className:"w-full bg-surface-2 border border-border rounded-lg px-3 py-2.5 text-sm text-text-primary",children:le.map(s=>e.jsxs("option",{value:s,children:["Team ",s]},s))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block",children:"Traffic Level"}),e.jsx("div",{className:"flex gap-2",children:ce.map(s=>{const $=B[s],A=M===s;return e.jsxs("button",{onClick:()=>i(s),className:`flex-1 flex items-center justify-center gap-2 px-3 py-2.5 rounded-lg text-sm font-medium transition-all border ${A?$.color:"bg-surface-2 text-text-secondary border-border hover:border-zinc-600"}`,children:[e.jsx($.icon,{size:16}),$.label]},s)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block",children:"Incidents"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>h(!1),className:`flex-1 flex items-center justify-center gap-2 px-3 py-2.5 rounded-lg text-sm font-medium transition-all border ${o?"bg-surface-2 text-text-secondary border-border hover:border-zinc-600":"text-emerald-400 bg-emerald-500/15 border-emerald-500/30"}`,children:[e.jsx(E,{size:16}),"No Incidents"]}),e.jsxs("button",{onClick:()=>h(!0),className:`flex-1 flex items-center justify-center gap-2 px-3 py-2.5 rounded-lg text-sm font-medium transition-all border ${o?"text-red-400 bg-red-500/15 border-red-500/30":"bg-surface-2 text-text-secondary border-border hover:border-zinc-600"}`,children:[e.jsx(G,{size:16}),"Had Incidents"]})]}),o&&e.jsx("textarea",{value:u,onChange:s=>y(s.target.value),rows:3,className:"w-full mt-2 bg-surface-2 border border-red-500/20 rounded-lg px-3 py-2.5 text-sm text-text-primary resize-none focus:border-red-500/40 focus:outline-none",placeholder:"Describe the incident(s)..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block",children:"Covers"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>w(!1),className:`flex-1 flex items-center justify-center gap-2 px-3 py-2.5 rounded-lg text-sm font-medium transition-all border ${b?"bg-surface-2 text-text-secondary border-border hover:border-zinc-600":"text-emerald-400 bg-emerald-500/15 border-emerald-500/30"}`,children:[e.jsx(E,{size:16}),"No Cover"]}),e.jsxs("button",{onClick:()=>w(!0),className:`flex-1 flex items-center justify-center gap-2 px-3 py-2.5 rounded-lg text-sm font-medium transition-all border ${b?"text-amber-400 bg-amber-500/15 border-amber-500/30":"bg-surface-2 text-text-secondary border-border hover:border-zinc-600"}`,children:[e.jsx(O,{size:16}),"Covered Shift"]})]}),b&&e.jsx("textarea",{value:z,onChange:s=>t(s.target.value),rows:3,className:"w-full mt-2 bg-surface-2 border border-amber-500/20 rounded-lg px-3 py-2.5 text-sm text-text-primary resize-none focus:border-amber-500/40 focus:outline-none",placeholder:"Explain the cover (e.g., 'Covered for Ana on Ezekiel shift')..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block",children:"Notes"}),e.jsx("textarea",{value:v,onChange:s=>d(s.target.value),rows:3,className:"w-full bg-surface-2 border border-border rounded-lg px-3 py-2.5 text-sm text-text-primary resize-none focus:border-cw/40 focus:outline-none",placeholder:"Anything relevant about this shift..."})]}),D&&e.jsx("div",{className:`px-4 py-3 rounded-lg text-sm font-medium ${D.ok?"bg-emerald-500/10 text-emerald-400 border border-emerald-500/20":"bg-red-500/10 text-red-400 border border-red-500/20"}`,children:D.msg}),e.jsxs("button",{onClick:C,disabled:!f||!g||c,className:"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-lg bg-cw text-white text-sm font-semibold hover:bg-cw/90 disabled:opacity-40 disabled:cursor-not-allowed transition-all",children:[c?e.jsx(R,{size:16,className:"animate-spin"}):e.jsx(W,{size:16}),c?"Submitting...":"Submit Shift Report"]})]})]})}function xe({chatters:x}){const{profile:r}=F(),n=(r==null?void 0:r.role)==="chatter",f=r?U(r.role):!1,[N,S]=a.useState([]),[_,g]=a.useState(!0),[m,j]=a.useState("all"),[p,M]=a.useState(null),[i,o]=a.useState(null),[h,u]=a.useState(!1);a.useEffect(()=>{y()},[]);async function y(){g(!0);let t=T.from("shift_reports").select("*, chatter:chatters(*)").order("date",{ascending:!1}).order("created_at",{ascending:!1}).limit(100);if(n&&r){const d=x.find(c=>c.profile_id===r.id);d&&(t=t.eq("chatter_id",d.id))}const{data:v}=await t;S(v||[]),g(!1)}async function b(t){u(!0);const{error:v}=await T.from("shift_reports").delete().eq("id",t);v||(S(d=>d.filter(c=>c.id!==t)),M(null)),o(null),u(!1)}const w=m==="all"?N:N.filter(t=>t.team===m),z=a.useMemo(()=>{const t={};return x.forEach(v=>{t[v.id]=v}),t},[x]);return _?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(R,{size:20,className:"animate-spin text-cw"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("select",{value:m,onChange:t=>j(t.target.value),className:"bg-surface-1 border border-border rounded-lg px-3 py-1.5 text-xs text-text-primary",children:[e.jsx("option",{value:"all",children:"All Teams"}),P.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("span",{className:"text-xs text-text-muted",children:[w.length," report",w.length!==1?"s":""]})]}),w.length===0?e.jsxs("div",{className:"bg-surface-1 rounded-xl border border-border p-8 text-center",children:[e.jsx(Y,{size:32,className:"text-text-muted mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-text-muted",children:"No shift reports found"})]}):e.jsx("div",{className:"space-y-2",children:w.map(t=>{const v=t.chatter||z[t.chatter_id],d=p===t.id,c=B[t.traffic_level],k=new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});return e.jsxs("div",{className:"bg-surface-1 rounded-xl border border-border overflow-hidden",children:[e.jsxs("button",{onClick:()=>M(d?null:t.id),className:"w-full flex items-center gap-3 px-4 py-3 text-left hover:bg-surface-2/50 transition-colors",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-text-primary truncate",children:(v==null?void 0:v.full_name)??"Unknown"}),e.jsx("span",{className:"text-[10px] text-text-muted",children:k})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx("span",{className:"text-[10px] text-text-muted",children:t.team}),e.jsxs("span",{className:"text-[10px] text-text-muted",children:["Model Team ",t.model_team]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:`text-[10px] font-medium px-2 py-0.5 rounded-full border ${c.color}`,children:c.label}),t.has_incident&&e.jsx("span",{className:"text-[10px] font-medium px-2 py-0.5 rounded-full border text-red-400 bg-red-500/15 border-red-500/30",children:"Incident"}),t.has_cover&&e.jsx("span",{className:"text-[10px] font-medium px-2 py-0.5 rounded-full border text-amber-400 bg-amber-500/15 border-amber-500/30",children:"Cover"}),d?e.jsx(ee,{size:14,className:"text-text-muted"}):e.jsx(K,{size:14,className:"text-text-muted"})]})]}),d&&e.jsxs("div",{className:"px-4 pb-4 pt-3 space-y-4 border-t border-border",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-surface-2 rounded-lg px-3 py-2",children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-text-muted/60 mb-0.5",children:"Date"}),e.jsx("p",{className:"text-sm font-medium text-text-primary",children:k})]}),e.jsxs("div",{className:"bg-surface-2 rounded-lg px-3 py-2",children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-text-muted/60 mb-0.5",children:"Team"}),e.jsx("p",{className:"text-sm font-medium text-text-primary",children:t.team})]}),e.jsxs("div",{className:"bg-surface-2 rounded-lg px-3 py-2",children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-text-muted/60 mb-0.5",children:"Model Team"}),e.jsxs("p",{className:"text-sm font-medium text-text-primary",children:["Team ",t.model_team]})]}),e.jsxs("div",{className:"bg-surface-2 rounded-lg px-3 py-2",children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-text-muted/60 mb-0.5",children:"Traffic"}),e.jsxs("span",{className:`inline-flex items-center gap-1 text-sm font-medium ${c.color.split(" ")[0]}`,children:[e.jsx(c.icon,{size:14}),c.label]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:`rounded-lg px-3 py-2 border ${t.has_incident?"bg-red-500/5 border-red-500/20":"bg-emerald-500/5 border-emerald-500/20"}`,children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[t.has_incident?e.jsx(G,{size:13,className:"text-red-400"}):e.jsx(E,{size:13,className:"text-emerald-400"}),e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-text-muted/60",children:"Incidents"})]}),e.jsx("p",{className:`text-sm font-medium mt-0.5 ${t.has_incident?"text-red-400":"text-emerald-400"}`,children:t.has_incident?"Yes":"None"})]}),e.jsxs("div",{className:`rounded-lg px-3 py-2 border ${t.has_cover?"bg-amber-500/5 border-amber-500/20":"bg-emerald-500/5 border-emerald-500/20"}`,children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[t.has_cover?e.jsx(O,{size:13,className:"text-amber-400"}):e.jsx(E,{size:13,className:"text-emerald-400"}),e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-text-muted/60",children:"Cover"})]}),e.jsx("p",{className:`text-sm font-medium mt-0.5 ${t.has_cover?"text-amber-400":"text-emerald-400"}`,children:t.has_cover?"Yes":"None"})]})]}),t.has_incident&&t.incident_notes&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ae,{size:14,className:"text-red-400 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-red-400/70 mb-0.5",children:"Incident Details"}),e.jsx("p",{className:"text-sm text-text-secondary",children:t.incident_notes})]})]}),t.has_cover&&t.cover_notes&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{size:14,className:"text-amber-400 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-amber-400/70 mb-0.5",children:"Cover Details"}),e.jsx("p",{className:"text-sm text-text-secondary",children:t.cover_notes})]})]}),t.notes&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ie,{size:14,className:"text-text-muted shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-text-muted/70 mb-0.5",children:"Notes"}),e.jsx("p",{className:"text-sm text-text-secondary",children:t.notes})]})]}),f&&e.jsx("div",{className:"pt-2 border-t border-border",children:i===t.id?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-red-400 font-medium",children:"Delete this report permanently?"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>o(null),disabled:h,className:"px-3 py-1.5 rounded-lg text-xs font-medium bg-surface-2 border border-border text-text-secondary hover:text-text-primary transition-all",children:"Cancel"}),e.jsxs("button",{onClick:()=>b(t.id),disabled:h,className:"px-3 py-1.5 rounded-lg text-xs font-medium bg-red-500/15 border border-red-500/30 text-red-400 hover:bg-red-500/25 disabled:opacity-40 transition-all flex items-center gap-1",children:[h?e.jsx(R,{size:12,className:"animate-spin"}):e.jsx(H,{size:12}),"Confirm Delete"]})]})]}):e.jsxs("button",{onClick:()=>o(t.id),className:"flex items-center gap-1.5 text-xs text-text-muted hover:text-red-400 transition-colors",children:[e.jsx(H,{size:12}),"Delete Report"]})})]})]},t.id)})})]})}function me({chatters:x}){const{profile:r}=F(),[n,f]=a.useState([]),[N,S]=a.useState(!0),[_,g]=a.useState(null),[m,j]=a.useState(null);a.useEffect(()=>{p()},[x]);async function p(){S(!0);const i=new Date,o=new Date(i);o.setDate(i.getDate()-7);const h=o.toISOString().slice(0,10),u=i.toISOString().slice(0,10),[y,b,w]=await Promise.all([T.from("schedules").select("chatter_id, day_of_week, shift, week_start").gte("week_start",q(o)).lte("week_start",q(i)),T.from("shift_reports").select("chatter_id, date").gte("date",h).lte("date",u),T.from("shift_report_alerts").select("chatter_id, date").gte("date",h).lte("date",u)]),z=y.data||[],t=b.data||[],v=w.data||[],d=new Set(t.map(l=>`${l.chatter_id}|${l.date}`)),c=new Set(v.map(l=>`${l.chatter_id}|${l.date}`)),k={};x.forEach(l=>{k[l.id]=l});const D=[];for(const l of z){const C=fe(l.week_start,l.day_of_week);if(!C||C>u||C>=u)continue;const I=`${l.chatter_id}|${C}`;if(d.has(I)||c.has(I))continue;const s=k[l.chatter_id];if(!s)continue;const $=X.find(A=>A.chatterShift===l.shift);D.some(A=>A.chatter_id===l.chatter_id&&A.date===C)||D.push({chatter_id:l.chatter_id,chatter_name:s.full_name,date:C,shift:l.shift,team:($==null?void 0:$.teamName)||s.team_name||"Unknown"})}D.sort((l,C)=>C.date.localeCompare(l.date)||l.chatter_name.localeCompare(C.chatter_name)),f(D),S(!1)}async function M(i,o){if(!r)return;const h=`${i.chatter_id}|${i.date}`;g(h),j(null);try{const{error:u}=await T.from("shift_report_alerts").insert({chatter_id:i.chatter_id,chatter_name:i.chatter_name,date:i.date,shift:i.shift,action:o,resolved_by:r.id});if(u)throw u;if(o==="accepted"){const{data:y}=await T.from("score_event_types").select("id, points").eq("name","Missing Shift Report").eq("is_active",!0).limit(1),b=y==null?void 0:y[0];if(!b){j({key:h,ok:!1,msg:'Score event type "Missing Shift Report" not found. Create it in Chatter Score config first.'}),g(null);return}const w=i.date,z=J(new Date(w)),{error:t}=await T.from("score_events").insert({chatter_id:i.chatter_id,submitted_by:r.id,date:w,event_type_id:b.id,points:b.points,custom_points:null,notes:`Missing shift report for ${i.date}`,week:z});if(t)throw t}f(y=>y.filter(b=>!(b.chatter_id===i.chatter_id&&b.date===i.date))),j({key:h,ok:!0,msg:o==="accepted"?`${i.chatter_name}: -5 points applied`:"Alert dismissed"})}catch(u){const y=u instanceof Error?u.message:"Action failed";j({key:h,ok:!1,msg:y})}finally{g(null)}}return N?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(R,{size:20,className:"animate-spin text-cw"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-text-muted",children:"Showing missing shift reports for the last 7 days"}),e.jsx("button",{onClick:p,className:"text-xs text-cw hover:text-cw/80 font-medium transition-colors",children:"Refresh"})]}),m&&e.jsx("div",{className:`px-4 py-3 rounded-lg text-sm font-medium ${m.ok?"bg-emerald-500/10 text-emerald-400 border border-emerald-500/20":"bg-red-500/10 text-red-400 border border-red-500/20"}`,children:m.msg}),n.length===0?e.jsxs("div",{className:"bg-surface-1 rounded-xl border border-border p-8 text-center",children:[e.jsx(E,{size:32,className:"text-emerald-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-text-muted",children:"No missing shift reports"})]}):e.jsx("div",{className:"space-y-2",children:n.map(i=>{const o=`${i.chatter_id}|${i.date}`,h=_===o,u=new Date(i.date+"T00:00:00").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});return e.jsxs("div",{className:"bg-surface-1 rounded-xl border border-red-500/20 p-4 flex items-center gap-4",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-red-500/15 flex items-center justify-center shrink-0",children:e.jsx(V,{size:18,className:"text-red-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Missing Shift Report"}),e.jsxs("p",{className:"text-xs text-text-muted truncate",children:[i.chatter_name," · ",i.shift," · ",u," · ",i.team]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("button",{onClick:()=>M(i,"dismissed"),disabled:h,className:"px-3 py-1.5 rounded-lg text-xs font-medium bg-surface-2 border border-border text-text-secondary hover:text-text-primary hover:border-zinc-600 disabled:opacity-40 transition-all",children:"Dismiss"}),e.jsxs("button",{onClick:()=>M(i,"accepted"),disabled:h,className:"px-3 py-1.5 rounded-lg text-xs font-medium bg-red-500/15 border border-red-500/30 text-red-400 hover:bg-red-500/25 disabled:opacity-40 transition-all flex items-center gap-1",children:[h?e.jsx(R,{size:12,className:"animate-spin"}):null,"Accept (-5 pts)"]})]})]},o)})})]})}const he=["Mo","Tu","We","Th","Fr","Sa","Su"];function ue({value:x,onChange:r}){const[n,f]=a.useState(!1),N=a.useRef(null),S=new Date(x+"T00:00:00"),[_,g]=a.useState(S.getFullYear()),[m,j]=a.useState(S.getMonth()),p=new Date().toISOString().slice(0,10);a.useEffect(()=>{function d(c){N.current&&!N.current.contains(c.target)&&f(!1)}return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[]);function M(){m===0?(j(11),g(d=>d-1)):j(d=>d-1)}function i(){m===11?(j(0),g(d=>d+1)):j(d=>d+1)}function o(){const d=new Date;g(d.getFullYear()),j(d.getMonth()),r(p),f(!1)}function h(d){const c=new Date(_,m,d);r(c.toISOString().slice(0,10)),f(!1)}const y=(new Date(_,m,1).getDay()+6)%7,b=new Date(_,m+1,0).getDate(),w=new Date(_,m,0).getDate(),z=new Date(_,m).toLocaleDateString("en-US",{month:"long",year:"numeric"}),t=S.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}),v=x===p;return e.jsxs("div",{ref:N,className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>f(!n),className:`w-full flex items-center gap-2.5 bg-surface-2 border rounded-lg px-3 py-2.5 text-sm text-left transition-all ${n?"border-cw ring-1 ring-cw/20":"border-border hover:border-zinc-600"}`,children:[e.jsx(se,{size:16,className:"text-cw shrink-0"}),e.jsx("span",{className:"text-text-primary flex-1",children:t}),v&&e.jsx("span",{className:"text-[10px] font-medium px-1.5 py-0.5 rounded-full bg-cw/15 text-cw border border-cw/20",children:"Today"}),e.jsx(K,{size:14,className:`text-text-muted transition-transform ${n?"rotate-180":""}`})]}),n&&e.jsxs("div",{className:"absolute z-50 mt-1.5 w-full bg-surface-1 border border-border rounded-xl shadow-xl shadow-black/30 p-3 animate-in fade-in slide-in-from-top-1 duration-150",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("button",{type:"button",onClick:M,className:"p-1 rounded-lg hover:bg-surface-2 text-text-muted hover:text-text-primary transition-colors",children:e.jsx(Z,{size:16})}),e.jsx("span",{className:"text-sm font-semibold text-text-primary",children:z}),e.jsx("button",{type:"button",onClick:i,className:"p-1 rounded-lg hover:bg-surface-2 text-text-muted hover:text-text-primary transition-colors",children:e.jsx(te,{size:16})})]}),e.jsx("div",{className:"grid grid-cols-7 mb-1",children:he.map(d=>e.jsx("div",{className:"text-center text-[10px] font-semibold text-text-muted/60 uppercase py-1",children:d},d))}),e.jsxs("div",{className:"grid grid-cols-7",children:[Array.from({length:y},(d,c)=>{const k=w-y+1+c;return e.jsx("div",{className:"text-center py-1.5",children:e.jsx("span",{className:"text-xs text-text-muted/30",children:k})},`prev-${c}`)}),Array.from({length:b},(d,c)=>{const k=c+1,D=`${_}-${String(m+1).padStart(2,"0")}-${String(k).padStart(2,"0")}`,l=D===x,C=D===p;return e.jsx("div",{className:"text-center py-0.5",children:e.jsx("button",{type:"button",onClick:()=>h(k),className:`w-8 h-8 rounded-lg text-xs font-medium transition-all ${l?"bg-cw text-white shadow-sm shadow-cw/30":C?"bg-cw/10 text-cw border border-cw/30 hover:bg-cw/20":"text-text-secondary hover:bg-surface-2 hover:text-text-primary"}`,children:k})},k)})]}),e.jsx("div",{className:"mt-2 pt-2 border-t border-border flex justify-center",children:e.jsx("button",{type:"button",onClick:o,className:"text-xs text-cw hover:text-cw/80 font-medium transition-colors",children:"Go to today"})})]})]})}function q(x){const r=new Date(x),n=r.getDay(),f=r.getDate()-n+(n===0?-6:1);return r.setDate(f),r.toISOString().slice(0,10)}function fe(x,r){try{const n=new Date(x+"T00:00:00");return n.setDate(n.getDate()+r),n.toISOString().slice(0,10)}catch{return null}}export{_e as default};
