const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/exceljs.min-DtsW_xrU.js","assets/index-BP5YFlyp.js","assets/index-Cpn6Z0e0.css"])))=>i.map(i=>d[i]);
import{c as Me,s as rt,_ as es,r as h,j as t,x as ft,l as We,E as ts,C as ss,t as rs,P as ns}from"./index-BP5YFlyp.js";import{L as Te}from"./loader-circle-BC4jqH9m.js";import{F as os}from"./file-spreadsheet-DOqBiMGl.js";import{T as as}from"./trash-2-DXlVcyGl.js";import{C as ls}from"./chevron-right-CosHkskW.js";import{A as ht,a as xt}from"./arrow-up-CEDtaFbc.js";import{L as cs}from"./list-BeSkR2Ae.js";import{T as is}from"./trophy-DPNwtgSU.js";import{A as ds}from"./arrow-up-down-FJl0TFsn.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=Me("ArrowUpNarrowWide",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=Me("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=Me("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=Me("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]),Ue="infloww_history",nt="infloww_hubstaff",gt="infloww_history_ver",bt=4,Re=[{key:"employee",label:"Employees",type:"text"},{key:"duration",label:"Duration",type:"hours",hasAvg:!0},{key:"sales",label:"Sales",type:"currency",hasAvg:!0},{key:"directMessagesSent",label:"DMs Sent",type:"number"},{key:"directPpvsSent",label:"PPVs Sent",type:"number"},{key:"goldenRatio",label:"Golden Ratio",type:"percent",hasAvg:!0},{key:"ppvsUnlocked",label:"PPVs Unlocked",type:"number"},{key:"unlockRate",label:"Unlock Rate",type:"percent"},{key:"fansChatted",label:"Fans Chatted",type:"number",approxReason:"Sum of daily values â€” a fan chatted on multiple days is counted each day. Infloww weekly reports deduplicate unique fans."},{key:"fansWhoSpentMoney",label:"Fans Spent",type:"number",approxReason:"Sum of daily values â€” a fan who spent on multiple days is counted each day. Infloww weekly reports deduplicate unique fans."},{key:"fanCvr",label:"Fan CVR",type:"percent",hasAvg:!0,approxReason:"Derived from Fans Chatted and Fans Spent, both of which may include duplicates across days."},{key:"responseTime",label:"Resp. Time",type:"time",hasAvg:!0,approxReason:"Weighted average of daily response times by messages sent. May differ slightly from Infloww's per-message calculation."},{key:"clockedHours",label:"Clocked Hrs",type:"hours"},{key:"salesPerHour",label:"$/hr",type:"currency",hasAvg:!0,approxReason:"Calculated from total sales Ã· total clocked hours. Minor rounding differences vs Infloww due to hour precision."},{key:"characterCount",label:"Char Count",type:"number"},{key:"messagesSentPerHour",label:"Msg/hr",type:"decimal",hasAvg:!0,approxReason:"Calculated from total DMs sent Ã· total clocked hours. Minor rounding differences vs Infloww due to hour precision."}],fs=["sales","directMessagesSent","directPpvsSent","goldenRatio","ppvsUnlocked","unlockRate","fansChatted","fansWhoSpentMoney","fanCvr","responseTime","clockedHours","salesPerHour","characterCount","messagesSentPerHour"],Ye=["sales","directMessagesSent","directPpvsSent","ppvsUnlocked","fansChatted","fansWhoSpentMoney","characterCount","clockedHours"],Ge=["goldenRatio","unlockRate","fanCvr","responseTime","salesPerHour","messagesSentPerHour"],hs={employee:["employee","employees","name","chatter","model","empleado","nombre"],date:["date","fecha","day","dia","period","periodo"],sales:["sales","revenue","earnings","ingresos","ventas","total sales","net","gross"],directMessagesSent:["direct messages sent","dm sent","mensajes directos","mensajes enviados"],directPpvsSent:["direct ppvs sent","ppvs sent","ppv sent","ppvs directos enviados"],goldenRatio:["golden ratio","ratio dorado","gr"],ppvsUnlocked:["ppvs unlocked","ppv unlocked","ppvs desbloqueados","unlocked ppvs","unlocked"],unlockRate:["unlock rate","tasa de desbloqueo","tasa desbloqueo"],fansChatted:["fans chatted","fans chateados","chatted fans","chatted"],fansWhoSpentMoney:["fans who spent money","fans que gastaron","spending fans","fans who spent","spent money"],fanCvr:["fan cvr","cvr","fan conversion","tasa conversion"],responseTime:["response time","tiempo de respuesta","avg response time","response","resp time"],clockedHours:["clocked hours","horas clockeadas","logged hours","horas registradas"],characterCount:["character count","caracteres","char count","characters","total characters"],messagesSentPerHour:["messages sent per hour","mensajes por hora","msg per hour","messages/hour","msg/hr"],salesPerHour:["sales per hour","ventas por hora","revenue per hour","$/hr"],group:["group","grupo","team","equipo"]},ot={employee:["member","user","employee","name","usuario","miembro","employees"],date:["date","fecha","day","start date"],hours:["hours","time","duration","tracked","time tracked","total time","hours worked","horas","tiempo"]};function yt(e,r){const s=[];let o="",a=!1;for(let c=0;c<e.length;c++){const i=e[c];i==='"'?a=!a:!a&&i===r?(s.push(o.trim()),o=""):o+=i}return s.push(o.trim()),s}function xs(e){const r=e.split(/\r?\n/).filter(c=>c.trim());if(!r.length)return{headers:[],rows:[]};const s=(e.match(/;/g)||[]).length>(e.match(/,/g)||[]).length?";":",",o=yt(r[0],s),a=[];for(let c=1;c<r.length;c++)a.push(yt(r[c],s));return{headers:o,rows:a}}async function Nt(e){const r=/\.csv$/i.test(e.name),s=/\.(xlsx|xls)$/i.test(e.name);return new Promise((o,a)=>{const c=new FileReader;c.onload=async i=>{var d,w;try{if(r)o(xs((d=i.target)==null?void 0:d.result));else if(s){const C=await es(()=>import("./exceljs.min-DtsW_xrU.js").then(x=>x.e),__vite__mapDeps([0,1,2])),N=new C.Workbook;await N.xlsx.load((w=i.target)==null?void 0:w.result);const S=N.worksheets[0],p=[];if(S.eachRow(x=>{p.push(x.values.slice(1).map(F=>String(F??"")))}),p.length===0){o({headers:[],rows:[]});return}o({headers:p[0],rows:p.slice(1)})}else a(new Error("Unsupported file format"))}catch(C){a(C)}},c.onerror=()=>a(new Error("Error reading file")),s?c.readAsArrayBuffer(e):c.readAsText(e,"UTF-8")})}function gs(e){return String(e||"").toLowerCase().replace(/[_\-]+/g," ").replace(/\s+/g," ").trim()}function bs(e,r,s){const o=e.map(gs);for(const a of r){const c=o.findIndex((i,d)=>i===a&&!s.has(d));if(c!==-1)return c}for(const a of r){const c=o.findIndex((i,d)=>(i.includes(a)||a.includes(i))&&!s.has(d));if(c!==-1)return c}return-1}function $e(e,r){const s={},o=new Set;for(const[a,c]of Object.entries(r)){const i=bs(e,c,o);i!==-1&&(s[a]=i,o.add(i))}return s}function St(e){if(e==null||e===""||e==="-")return NaN;const r=String(e).replace(/[$%,]/g,"").replace(/\s/g,"").replace(",",".");return parseFloat(r)}function at(e){if(e==null||e===""||e==="-")return NaN;const r=String(e).trim().replace(/,/g,"."),s=r.match(/^(\d+)h\s*(\d+)\s*min/i);if(s)return parseInt(s[1])+parseInt(s[2])/60;const o=r.match(/^(\d+)h$/i);if(o)return parseInt(o[1]);const a=r.match(/^(\d+)\s*min$/i);if(a)return parseInt(a[1])/60;const c=r.match(/^(\d+):(\d{2})(?::(\d{2}))?$/);if(c)return parseInt(c[1])+parseInt(c[2])/60+(c[3]?parseInt(c[3])/3600:0);const i=parseFloat(r);return isNaN(i)?NaN:i}function Et(e){if(e==null||e===""||e==="-")return NaN;const r=String(e).trim(),s=r.match(/^(\d+)m\s*(\d+)\s*s$/i);if(s)return parseInt(s[1])*60+parseInt(s[2]);const o=r.match(/^(\d+)m$/i);if(o)return parseInt(o[1])*60;const a=r.match(/^(\d+)\s*s$/i);if(a)return parseInt(a[1]);const c=r.match(/^(\d+):(\d{2}):(\d{2})$/);if(c)return parseInt(c[1])*3600+parseInt(c[2])*60+parseInt(c[3]);const i=r.match(/^(\d+):(\d{2})$/);if(i)return parseInt(i[1])*60+parseInt(i[2]);const d=parseFloat(String(e).replace(/,/g,"."));return isNaN(d)?NaN:d}function Tt(e){if(!e)return null;const r=String(e).trim();if(r.match(/^(\d{4})-(\d{2})-(\d{2})/))return r.slice(0,10);const o=r.match(/^(\d{1,2})[/\-](\d{1,2})[/\-](\d{4})/);if(o){const c=parseInt(o[1]),i=parseInt(o[2]),d=o[3];return c>12?`${d}-${String(i).padStart(2,"0")}-${String(c).padStart(2,"0")}`:`${d}-${String(c).padStart(2,"0")}-${String(i).padStart(2,"0")}`}const a=new Date(r);return isNaN(a.getTime())?null:`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`}function qe(e){if(!e)return null;const r=String(e).trim(),s=r.match(/^(\d{4}-\d{2}-\d{2})\s+(\d{2}:\d{2}:\d{2})/);return s?s[1]+"T"+s[2]:Tt(r)}function ys(e){if(!e)return null;const r=String(e).trim(),s=r.split(/\s+-\s+/);if(s.length===2){const a=qe(s[0]),c=qe(s[1]);if(a&&c)return{start:a,end:c}}const o=qe(r);return o?{start:o,end:o}:null}function he(e){return`${e.getUTCFullYear()}-${String(e.getUTCMonth()+1).padStart(2,"0")}-${String(e.getUTCDate()).padStart(2,"0")}`}function be(e,r){return he(new Date(new Date(e+"T00:00:00Z").getTime()+r*864e5))}function wt(e){const r=new Date,s=new Date(Date.UTC(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate())),a=(s.getUTCDay()+6)%7;return new Date(s.getTime()-a*864e5+e*7*864e5)}function ge(e,r,s){if(e==="current"){const o=wt(0),a=new Date(o.getTime()+7*864e5);return{from:he(o),to:he(a)}}if(e==="previous"){const o=wt(-1),a=new Date(o.getTime()+7*864e5);return{from:he(o),to:he(a)}}return e==="custom"&&r&&s?r===s?{from:r,to:be(s,1)}:{from:r,to:s}:null}function Ae(){try{const e=localStorage.getItem(Ue);return e?JSON.parse(e):[]}catch{return[]}}function Ns(e){try{localStorage.setItem(Ue,JSON.stringify(e))}catch(r){r instanceof DOMException&&r.name==="QuotaExceededError"&&alert("Local storage is full. Consider clearing old data.")}}function Ss(e){const r=$e(e.headers,hs),s=r.date,o=r.employee;if(o==null)return 0;const a=new Date().toISOString(),c=[];for(const d of e.rows){const w=(d[o]||"").trim();if(!w)continue;let C=s!=null?ys(d[s]):null;C||(C={start:"unknown",end:"unknown"});const N={};for(const p of fs)r[p]!=null&&(N[p]=d[r[p]]||"");const S=r.group!=null?(d[r.group]||"").trim():"";c.push({periodStart:C.start,periodEnd:C.end,uploadedAt:a,employee:w,group:S,values:N})}const i=Ae();for(const d of c){const w=i.findIndex(C=>C.employee===d.employee&&C.periodStart===d.periodStart&&C.periodEnd===d.periodEnd);w!==-1?d.uploadedAt>=i[w].uploadedAt&&(i[w]=d):i.push(d)}return Ns(i),c.length}function ws(){localStorage.removeItem(Ue),localStorage.removeItem(nt)}function Cs(){const e=Ae();if(!e.length)return null;const r=new Set(e.map(o=>`${o.periodStart}_${o.periodEnd}`)),s=e.map(o=>o.periodStart).filter(o=>o!=="unknown").sort();return{totalRecords:e.length,periodCount:r.size,earliest:s[0]||null,latest:s[s.length-1]||null}}function vs(e){try{localStorage.setItem(nt,JSON.stringify(e))}catch{}}function ks(){try{const e=localStorage.getItem(nt);return e?JSON.parse(e):null}catch{return null}}function Dt(e,r,s){return r<0?e:e.filter(o=>{const a=Tt(o[r]);return a&&a>=s.from&&a<s.to})}function Is(e){const r={employee:e.name,group:e.group||""},s={};for(const a of Ye)s[a]={total:0,count:0};const o={};for(const a of Ge)o[a]=[];for(const{row:a,map:c}of e.inflowwRows){for(const i of Ye){if(c[i]==null)continue;const d=i==="clockedHours"?at(a[c[i]]):St(a[c[i]]);isNaN(d)||(s[i].total+=d,s[i].count++)}for(const i of Ge){if(c[i]==null)continue;const d=i==="responseTime"?Et(a[c[i]]):St(a[c[i]]);isNaN(d)||o[i].push(d)}}r.duration=e.hubstaffHours||NaN;for(const a of Ye)r[a]=s[a].count?s[a].total:NaN;for(const a of Ge)r[a]=o[a].length===1?o[a][0]:NaN;return r}function js(e,r,s,o){const a=ge(e,r,s),c={},i=a?Ae().filter(d=>d.periodEnd>=a.from&&d.periodEnd<a.to):Ae();for(const d of i){const w=d.employee.toLowerCase();c[w]||(c[w]={name:d.employee,group:"",inflowwRows:[],hubstaffHours:0}),d.group&&(c[w].group=d.group);const C=[],N={};let S=0;for(const[p,x]of Object.entries(d.values))C.push(x),N[p]=S++;c[w].inflowwRows.push({row:C,map:N})}if(o){const d=$e(o.headers,ot),w=d.date,C=a&&w!=null?Dt(o.rows,w,a):o.rows;for(const N of C){const S=d.employee!=null?(N[d.employee]||"").trim():"";if(!S)continue;const p=S.toLowerCase();c[p]||(c[p]={name:S,group:"",inflowwRows:[],hubstaffHours:0});const x=at(N[d.hours]);isNaN(x)||(c[p].hubstaffHours+=x)}}return Object.values(c).map(Is)}async function Es(e,r,s,o){const a=ge(e,r,s);let c=rt.from("chatter_daily_stats").select("*").order("date",{ascending:!0});a&&(c=c.gte("date",a.from).lt("date",a.to));const{data:i,error:d}=await c;if(d)throw new Error("Supabase query failed: "+d.message);if(!i||i.length===0)return[];const w=i.reduce((p,x)=>p+(Number(x.sales)||0),0),C=[...new Set(i.map(p=>p.date))].sort();console.log(`[InflowwKPIs] DB query: ${i.length} rows, ${C.length} dates (${C.join(", ")}), total sales: $${w.toFixed(2)}, range: ${a==null?void 0:a.from}..${a==null?void 0:a.to}`);const N=i,S={};for(const p of N){const x=p.employee_name.toLowerCase().trim();S[x]||(S[x]={name:p.employee_name,group:p.team||"",days:[],hubstaffHours:0}),p.team&&(S[x].group=p.team),S[x].days.push(p)}if(o){const p=$e(o.headers,ot),x=p.date,F=a&&x!=null?Dt(o.rows,x,a):o.rows;for(const H of F){const A=p.employee!=null?(H[p.employee]||"").trim():"";if(!A)continue;const L=A.toLowerCase();S[L]||(S[L]={name:A,group:"",days:[],hubstaffHours:0});const $=at(H[p.hours]);isNaN($)||(S[L].hubstaffHours+=$)}}return Object.values(S).map(p=>{const x={employee:p.name,group:p.group};if(p.days.length===0)return x.duration=p.hubstaffHours||NaN,x;x.sales=p.days.reduce((E,D)=>E+(Number(D.sales)||0),0),x.directMessagesSent=p.days.reduce((E,D)=>E+(Number(D.messages_sent)||0),0),x.directPpvsSent=p.days.reduce((E,D)=>E+(Number(D.ppvs_sent)||0),0),x.ppvsUnlocked=p.days.reduce((E,D)=>E+(Number(D.ppvs_unlocked)||0),0),x.fansChatted=p.days.reduce((E,D)=>E+(Number(D.fans_chatted)||0),0),x.fansWhoSpentMoney=p.days.reduce((E,D)=>E+(Number(D.fans_who_spent)||0),0),x.characterCount=p.days.reduce((E,D)=>E+(Number(D.character_count)||0),0),x.clockedHours=p.days.reduce((E,D)=>E+(Number(D.clocked_hours)||0),0);const H=Number(x.directMessagesSent)||0,A=Number(x.directPpvsSent)||0,L=Number(x.ppvsUnlocked)||0,$=Number(x.fansChatted)||0,xe=Number(x.fansWhoSpentMoney)||0,z=Number(x.sales)||0,P=Number(x.clockedHours)||0;x.goldenRatio=H>0?A/H*100:NaN,x.unlockRate=A>0?L/A*100:NaN,x.fanCvr=$>0?xe/$*100:NaN,x.salesPerHour=P>0?z/P:NaN,x.messagesSentPerHour=P>0?H/P:NaN;let X=0,ce=0;for(const E of p.days){const D=Et(E.response_time_clocked),B=Number(E.messages_sent)||0;!isNaN(D)&&D>0&&B>0&&(X+=D*B,ce+=B)}return x.responseTime=ce>0?X/ce:NaN,x.duration=p.hubstaffHours||NaN,x})}async function Ts(){const{data:e}=await rt.from("chatter_daily_stats").select("date").order("date",{ascending:!1});return e?[...new Set(e.map(r=>r.date))]:[]}function Ds(e,r,s){const o=[...e];if(s==="alpha")return o.sort((c,i)=>String(c.employee).localeCompare(String(i.employee))),o;const a=s==="asc"?1:-1;return o.sort((c,i)=>{const d=Number(c[r]),w=Number(i[r]),C=isNaN(d)?-1/0:d,N=isNaN(w)?-1/0:w;return(C-N)*a}),o}function Ze(e,r){const s=Math.pow(10,r);return String(Math.round(e*s)/s)}function Fs(e){if(isNaN(e))return"â€”";const r=Math.floor(e*60),s=Math.floor(r/60),o=r%60;return o>0?`${s}h ${o}m`:`${s}h`}function Rs(e){if(isNaN(e))return"â€”";const r=Math.floor(e),s=Math.floor(r/60),o=r%60;return s===0?`${o}s`:o>0?`${s}m ${o}s`:`${s}m`}function Je(e,r){const s=Number(e);if(e==null||isNaN(s))return"â€”";switch(r){case"currency":return"$"+Ze(s,2);case"number":return Math.round(s).toLocaleString("en-US");case"decimal":return Ze(s,2);case"percent":return Ze(s,2)+"%";case"hours":return Fs(s);case"time":return Rs(s);default:return String(e)}}function As(e){const r={};for(const s of Re){if(!s.hasAvg)continue;const o=e.map(a=>Number(a[s.key])).filter(a=>!isNaN(a));r[s.key]=o.length?o.reduce((a,c)=>a+c,0)/o.length:null}return r}function Ms(e){const r=o=>new Date(o+"T00:00:00Z").toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric",timeZone:"UTC"}),s=be(e.to,-1);return e.from===s?r(e.from):`${r(e.from)} â€” ${r(s)}`}const Ct=[60,40,30,20,15,12,10,6,4,3],Us=[75,50,37,25,19,14,11,8,6,5],vt=["ðŸ¥‡","ðŸ¥ˆ","ðŸ¥‰"],De=12;function $s(e){return[...e].sort((r,s)=>{const o=isNaN(Number(r.sales))?-1/0:Number(r.sales);return(isNaN(Number(s.sales))?-1/0:Number(s.sales))-o})}function Hs(e){return e.reduce((r,s)=>r+(isNaN(Number(s.sales))?0:Number(s.sales)),0)}const Ft="infloww_gsheet_client_id",Rt="infloww_gsheet_id";function st(){return localStorage.getItem(Ft)||""}function Ls(e){localStorage.setItem(Ft,e)}function Os(){const e=localStorage.getItem(Rt);return e?`https://docs.google.com/spreadsheets/d/${e}`:null}function Xe(e){return isNaN(e)?"-":e}function fe(e){return isNaN(e)?"-":Math.round(e)}function Qe(e){return isNaN(e)?"-":e/100}function _s(e){return isNaN(e)||e===0?"-":e/24}function At(e){return isNaN(e)?"-":e/86400}function Mt(e){if(isNaN(e))return"-";const r=Math.round(e*60),s=Math.floor(r/60),o=r%60;return o>0?s+"h "+o+"min":s+"h"}function et(e){return[String(e.employee),_s(Number(e.duration)),Xe(Number(e.sales)),fe(Number(e.directMessagesSent)),fe(Number(e.directPpvsSent)),Qe(Number(e.goldenRatio)),fe(Number(e.ppvsUnlocked)),Qe(Number(e.unlockRate)),fe(Number(e.fansChatted)),fe(Number(e.fansWhoSpentMoney)),Qe(Number(e.fanCvr)),At(Number(e.responseTime)),Mt(Number(e.clockedHours)),Xe(Number(e.salesPerHour)),fe(Number(e.characterCount)),Xe(Number(e.messagesSentPerHour))]}function Ps(e){return e?e.replace(/^team\s+/i,"").trim().toUpperCase():""}async function Fe(e,r,s,o){const c=await fetch("https://sheets.googleapis.com/v4/spreadsheets"+e,{method:r||"GET",headers:{Authorization:"Bearer "+o,"Content-Type":"application/json"},body:s?JSON.stringify(s):void 0});if(!c.ok){const i=await c.text();throw new Error("Sheets API error "+c.status+": "+i)}return c.json()}function y(e){const r=parseInt(e.slice(0,2),16)/255,s=parseInt(e.slice(2,4),16)/255,o=parseInt(e.slice(4,6),16)/255;return{red:r,green:s,blue:o}}const kt="infloww_export_ver",It="infloww_export_date";function zs(e){const r=i=>new Date(i+"T00:00:00Z").toLocaleDateString("en-US",{month:"short",day:"numeric",timeZone:"UTC"});let s="KPIs";if(e){const i=be(e.to,-1);s+=" "+r(e.from)+" - "+r(i)}else s+=" "+new Date().toLocaleDateString("en-US",{month:"short",day:"numeric"});const o=new Date().toLocaleDateString(),a=localStorage.getItem(It);let c=parseInt(localStorage.getItem(kt)||"0",10);return a===o?c++:c=0,localStorage.setItem(It,o),localStorage.setItem(kt,String(c)),c>0&&(s+=" - v"+c),s}const Bs=[160,90,85,100,90,80,85,80,85,100,70,130,85,85,100,100],Vs=[{col:1,fmt:"[h]:mm:ss"},{col:2,fmt:"$#,##0.00"},{col:3,fmt:"#,##0"},{col:4,fmt:"#,##0"},{col:5,fmt:"0.00%"},{col:6,fmt:"#,##0"},{col:7,fmt:"0.00%"},{col:8,fmt:"#,##0"},{col:9,fmt:"#,##0"},{col:10,fmt:"0.00%"},{col:11,fmt:"[h]:mm:ss"},null,{col:13,fmt:"$#,##0.00"},{col:14,fmt:"#,##0"},{col:15,fmt:"0.00"}];async function Ws(e,r,s,o,a,c,i,d){const w=st();if(!w)throw new Error("No Client ID configured");if(typeof google>"u"||!google.accounts)throw new Error("Google Identity Services not loaded. Reload the page.");d("Authenticating...");const C=await new Promise((l,u)=>{google.accounts.oauth2.initTokenClient({client_id:w,scope:"https://www.googleapis.com/auth/spreadsheets",callback:g=>{g.error?u(new Error("Auth error: "+g.error)):l(g.access_token)},error_callback:()=>u(new Error("Authentication failed"))}).requestAccessToken()});if(!e.length)throw new Error("No data to export");d("Preparing data...");function N(l){if(c.size===0)return!isNaN(Number(l.directMessagesSent))&&Number(l.directMessagesSent)>0;const u=String(l.employee).toLowerCase().trim().replace(/\s+/g," ");if(c.has(u))return!0;const f=u.split(" ");for(const g of c){if(g.includes(u)||u.includes(g))return!0;const I=g.split(" ");if(I[0]===f[0]&&I[I.length-1]===f[f.length-1])return!0}return!1}const S=[...e].sort((l,u)=>{const f=N(l),g=N(u);return f!==g?f?-1:1:String(l.employee).localeCompare(String(u.employee))}),p=S.findIndex(l=>!N(l)),x=["DANILYN","HUCKLE","EZEKIEL"],F={};for(const l of x)F[l]=[];const H=[];function A(l){const u=String(l.employee).toLowerCase().trim().replace(/\s+/g," ");if(i.has(u))return i.get(u);const f=u.split(" ");for(const[g,I]of i){if(g.includes(u)||u.includes(g))return I;const b=g.split(" ");if(b[0]===f[0]&&b[b.length-1]===f[f.length-1])return I}if(N(l)){const g=Ps(String(l.group));if(g&&x.includes(g))return g}return null}for(const l of S){const u=A(l);u&&F[u]?F[u].push(l):N(l)||H.push(l)}const L=[...x],$=["Employees","Duration","Sales","Direct messages sent","Direct PPVs sent","Golden ratio","PPVs unlocked","Unlock rate","Fans chatted","Fans who spent money","Fan CVR","Response time (based on clocked hours)","Clocked hours","Sales per hour","Character count","Messages sent per hour"],xe=["By employee","TL BONUSES",...L,"MISCELLANEOUS","HUBSTAFF HOURS"];d("Creating spreadsheet...");const z=ge(s,o,a),X={properties:{title:zs(z)},sheets:xe.map(l=>({properties:{title:l}}))},E=(await Fe("","POST",X,C)).spreadsheetId;localStorage.setItem(Rt,E),d("Writing data...");const D=4,B=D+S.length-1,ye={B:!0,C:!0,F:!0,K:!0,L:!0,N:!0,P:!0},q=[];q.push($);const Ne=["AVERAGE"];for(let l=1;l<$.length;l++){const u=String.fromCharCode(65+l);Ne.push(ye[u]?"=AVERAGE("+u+D+":"+u+B+")":"")}q.push(Ne);const He=["SCORE POINTS","","","","","=IF(F2>=4%,1,0)","","=IF(H2>=45%,1,0)","","","=IF(K2>=10%,3,IF(K2>=9%,2,IF(K2>=8%,1,0)))","2","","1","",""];q.push(He);for(const l of S)q.push(et(l));const V=[];V.push({range:"'By employee'!A1",values:q});const W=[];let ie=1;for(const l of L){const u=F[l].filter(M=>N(M)),f=u.filter(M=>!isNaN(Number(M.salesPerHour))),g=f.length?f.reduce((M,te)=>M+Number(te.salesPerHour),0)/f.length:0,I=u.filter(M=>!isNaN(Number(M.fanCvr))&&Number(M.fanCvr)>0),b=I.length?I.reduce((M,te)=>M+Number(te.fanCvr),0)/I.length/100:0,k=u.filter(M=>!isNaN(Number(M.responseTime))&&Number(M.responseTime)>0),Y=k.length?k.reduce((M,te)=>M+Number(te.responseTime),0)/k.length:0,J=k.length?At(Y):"-";W.push([l,"",""]),W.push(["METRICS","CURRENT","BONUS"]),W.push(["Team Avg. $/hr",Math.round(g*100)/100,0]),W.push(["Fan CVR",b,0]),W.push(["Avg. Reply Time",J,0]),W.push(["TOTAL:","","=SUM(D"+(ie+1)+":D"+(ie+3)+")"]),W.push([]),ie+=7}V.push({range:"'TL BONUSES'!B2",values:W});const Se={};for(const l of L){const u=[...F[l]].sort((b,k)=>{const Y=N(b),J=N(k);return Y!==J?Y?-1:1:(isNaN(Number(k.sales))?-1/0:Number(k.sales))-(isNaN(Number(b.sales))?-1/0:Number(b.sales))});F[l]=u,Se[l]=u.findIndex(b=>!N(b));const f=[];f.push($);for(const b of u)f.push(et(b));const g=u.length+1,I=[];for(let b=0;b<$.length;b++){const k=String.fromCharCode(65+b);k==="K"||k==="N"||k==="P"?I.push("=AVERAGE("+k+"2:"+k+g+")"):I.push("")}f.push(I),V.push({range:"'"+l+"'!A1",values:f})}const ne=[];ne.push($);const de=[...H].sort((l,u)=>(isNaN(Number(u.sales))?-1/0:Number(u.sales))-(isNaN(Number(l.sales))?-1/0:Number(l.sales)));for(const l of de)ne.push(et(l));if(de.length===0&&ne.push(["(No unverified employees)"]),V.push({range:"'MISCELLANEOUS'!A1",values:ne}),r){const l=$e(r.headers,ot),u=[["Organization","Time Zone","Member","TOTAL HOURS","Activity","Spent total","Currency"]],f=l.date,g=ge(s,o,a),I=g&&f!=null?r.rows.filter(b=>{const k=b[f]?String(b[f]).trim().slice(0,10):null;return k&&k>=g.from&&k<g.to}):r.rows;for(const b of I){const k=l.employee!=null?(b[l.employee]||"").trim():"";k&&u.push(["Chatting Wizard ENG","UTC",k,Mt(Ks(b[l.hours])),b[4]||"",b[5]||"",b[6]||"USD"])}V.push({range:"'HUBSTAFF HOURS'!A1",values:u})}else V.push({range:"'HUBSTAFF HOURS'!A1",values:[["Organization","Time Zone","Member","TOTAL HOURS","Activity","Spent total","Currency"],["(No Hubstaff data loaded)"]]});await Fe("/"+E+"/values:batchUpdate","POST",{valueInputOption:"USER_ENTERED",data:V},C),d("Applying formatting...");const we=await Fe("/"+E+"?fields=sheets.properties","GET",void 0,C),Q={};for(const l of we.sheets)Q[l.properties.title]=l.properties.sheetId;const U=[],oe={red:1,green:1,blue:1},Le={red:0,green:0,blue:0},R={fontFamily:"Montserrat",fontSize:10};function T(l,u,f,g,I,b){const k=Object.keys(b).map(Y=>"userEnteredFormat."+Y).join(",");U.push({repeatCell:{range:{sheetId:l,startRowIndex:u,endRowIndex:f,startColumnIndex:g,endColumnIndex:I},cell:{userEnteredFormat:b},fields:k}})}function ae(l,u){for(const f of Vs){if(!f)continue;const g=f.fmt.includes("$")?"CURRENCY":f.fmt.includes("%")?"PERCENT":f.fmt.includes(":")?"TIME":"NUMBER";T(l,1,u,f.col,f.col+1,{numberFormat:{type:g,pattern:f.fmt}})}}function Ce(l,u){for(let f=0;f<u.length;f++)U.push({updateDimensionProperties:{range:{sheetId:l,dimension:"COLUMNS",startIndex:f,endIndex:f+1},properties:{pixelSize:u[f]},fields:"pixelSize"}})}function ee(l,u,f,g,I,b,k){T(l,0,b,0,k,{textFormat:{...R,foregroundColor:Le},horizontalAlignment:"CENTER",verticalAlignment:"MIDDLE",wrapStrategy:"CLIP"}),T(l,u,u+1,0,k,{backgroundColor:y("F1C232"),textFormat:{...R,bold:!0,foregroundColor:y("5B0F00"),fontSize:9},horizontalAlignment:"CENTER",wrapStrategy:"WRAP"}),f>=0&&(T(l,f,f+1,0,1,{backgroundColor:y("FF9900"),textFormat:{...R,bold:!0,foregroundColor:oe}}),T(l,f,f+1,1,k,{backgroundColor:y("FFFF00"),textFormat:{...R,bold:!0}})),g>=0&&(T(l,g,g+1,0,1,{backgroundColor:y("1155CC"),textFormat:{...R,bold:!0,foregroundColor:oe}}),T(l,g,g+1,1,k,{backgroundColor:y("00FFFF"),textFormat:{...R,bold:!0}})),T(l,I,b,0,1,{textFormat:{...R,bold:!1},horizontalAlignment:"LEFT"}),T(l,I,b,1,2,{backgroundColor:y("EFEFEF"),textFormat:{...R,bold:!0,foregroundColor:y("B45F06")}});const Y=[10,13,15];for(const J of Y)T(l,u,u+1,J,J+1,{backgroundColor:y("00FFFF"),textFormat:{...R,bold:!0,foregroundColor:y("5B0F00")}});T(l,I,b,2,3,{backgroundColor:y("D9EAD3")}),U.push({updateBorders:{range:{sheetId:l,startRowIndex:u,endRowIndex:b,startColumnIndex:0,endColumnIndex:k},top:{style:"SOLID",width:1,color:y("999999")},bottom:{style:"SOLID",width:1,color:y("999999")},left:{style:"SOLID",width:1,color:y("999999")},right:{style:"SOLID",width:1,color:y("999999")},innerHorizontal:{style:"SOLID",width:1,color:y("D9D9D9")},innerVertical:{style:"SOLID",width:1,color:y("D9D9D9")}}}),Ce(l,Bs),U.push({updateDimensionProperties:{range:{sheetId:l,dimension:"ROWS",startIndex:u,endIndex:u+1},properties:{pixelSize:50},fields:"pixelSize"}}),U.push({updateDimensionProperties:{range:{sheetId:l,dimension:"ROWS",startIndex:I,endIndex:b},properties:{pixelSize:24},fields:"pixelSize"}})}const le=Q["By employee"];if(le!=null){const l=3+S.length;if(ae(le,l),ee(le,0,1,2,3,l,16),p>=0){const u=3+p;T(le,u,l,0,16,{backgroundColor:y("F4CCCC"),textFormat:{...R,foregroundColor:y("990000")}})}}for(const l of L){const u=Q[l];if(u==null)continue;const f=F[l].length,g=1+f+1;ae(u,g),ee(u,0,-1,-1,1,1+f,16),T(u,1+f,1+f+1,10,16,{backgroundColor:y("FFFF00"),textFormat:{...R,bold:!0}});const I=Se[l];if(I>=0){const b=1+I;T(u,b,1+f,0,16,{backgroundColor:y("F4CCCC"),textFormat:{...R,foregroundColor:y("990000")}})}}const Z=Q.MISCELLANEOUS;if(Z!=null&&de.length>0){const l=1+de.length;ae(Z,l),ee(Z,0,-1,-1,1,l,16),T(Z,1,l,0,16,{backgroundColor:y("F4CCCC"),textFormat:{...R,foregroundColor:y("990000")}})}const O=Q["TL BONUSES"];if(O!=null){let l=1;for(let u=0;u<L.length;u++)T(O,l,l+1,1,4,{backgroundColor:y("D9D2E9"),textFormat:{...R,bold:!0,foregroundColor:y("20124D")}}),T(O,l+1,l+2,1,4,{backgroundColor:y("8E7CC3"),textFormat:{...R,bold:!0,foregroundColor:oe}}),U.push({repeatCell:{range:{sheetId:O,startRowIndex:l+2,endRowIndex:l+3,startColumnIndex:2,endColumnIndex:3},cell:{userEnteredFormat:{numberFormat:{type:"CURRENCY",pattern:"$#,##0.00"}}},fields:"userEnteredFormat.numberFormat"}}),U.push({repeatCell:{range:{sheetId:O,startRowIndex:l+3,endRowIndex:l+4,startColumnIndex:2,endColumnIndex:3},cell:{userEnteredFormat:{numberFormat:{type:"PERCENT",pattern:"0.00%"}}},fields:"userEnteredFormat.numberFormat"}}),U.push({repeatCell:{range:{sheetId:O,startRowIndex:l+4,endRowIndex:l+5,startColumnIndex:2,endColumnIndex:3},cell:{userEnteredFormat:{numberFormat:{type:"TIME",pattern:"mm:ss"}}},fields:"userEnteredFormat.numberFormat"}}),T(O,l+5,l+6,1,4,{backgroundColor:y("FFE599"),textFormat:{...R,bold:!0}}),U.push({updateBorders:{range:{sheetId:O,startRowIndex:l,endRowIndex:l+6,startColumnIndex:1,endColumnIndex:4},top:{style:"SOLID",width:1,color:y("999999")},bottom:{style:"SOLID",width:1,color:y("999999")},left:{style:"SOLID",width:1,color:y("999999")},right:{style:"SOLID",width:1,color:y("999999")},innerHorizontal:{style:"SOLID",width:1,color:y("D9D9D9")},innerVertical:{style:"SOLID",width:1,color:y("D9D9D9")}}}),l+=7;U.push({autoResizeDimensions:{dimensions:{sheetId:O,dimension:"COLUMNS",startIndex:0,endIndex:5}}})}const K=Q["HUBSTAFF HOURS"];return K!=null&&(T(K,0,1,0,7,{backgroundColor:y("F1C232"),textFormat:{...R,bold:!0,foregroundColor:y("5B0F00")},horizontalAlignment:"CENTER"}),U.push({updateBorders:{range:{sheetId:K,startRowIndex:0,endRowIndex:1,startColumnIndex:0,endColumnIndex:7},bottom:{style:"SOLID",width:2,color:y("B45F06")}}}),U.push({autoResizeDimensions:{dimensions:{sheetId:K,dimension:"COLUMNS",startIndex:0,endIndex:7}}})),U.length>0&&await Fe("/"+E+":batchUpdate","POST",{requests:U},C),"https://docs.google.com/spreadsheets/d/"+E}function Ks(e){if(e==null||e===""||e==="-")return NaN;const r=String(e).trim().replace(/,/g,"."),s=r.match(/^(\d+)h\s*(\d+)\s*min/i);if(s)return parseInt(s[1])+parseInt(s[2])/60;const o=r.match(/^(\d+):(\d{2})(?::(\d{2}))?$/);if(o)return parseInt(o[1])+parseInt(o[2])/60+(o[3]?parseInt(o[3])/3600:0);const a=parseFloat(r);return isNaN(a)?NaN:a}function jt(e,r,s){const o=new Date(Date.UTC(e,r,1)),a=new Date(Date.UTC(e,r+1,0)).getUTCDate(),c=(o.getUTCDay()+6)%7,i=o.toLocaleDateString("en-US",{month:"long",year:"numeric",timeZone:"UTC"}),d=new Date,w=he(new Date(Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()))),C=[];for(let N=1;N<=a;N++){const S=e+"-"+String(r+1).padStart(2,"0")+"-"+String(N).padStart(2,"0");let p=!1,x=!1,F=!1,H=!1;if(s){const A=be(s.to,-1);s.from===A&&S===s.from?H=!0:S===s.from?x=!0:S===A?F=!0:S>s.from&&S<A&&(p=!0)}C.push({date:S,day:N,isToday:S===w,inRange:p,isStart:x,isEnd:F,isSingle:H})}return{title:i,days:C,blanks:c}}function Ys(){parseInt(localStorage.getItem(gt)||"0")<bt&&(localStorage.removeItem(Ue),localStorage.setItem(gt,String(bt)))}const Gs=[{id:"current",label:"Current Week"},{id:"previous",label:"Previous Week"},{id:"custom",label:"Custom"},{id:"all",label:"All Data"}];function tt({reason:e,className:r}){const[s,o]=h.useState(null),a=h.useRef(null),c=d=>{a.current&&clearTimeout(a.current),o({x:d.clientX,y:d.clientY})},i=()=>{a.current=setTimeout(()=>o(null),100)};return t.jsxs(t.Fragment,{children:[t.jsx("span",{className:`cursor-help text-amber-400/70 font-bold ${r??"text-[10px]"}`,onMouseEnter:c,onMouseMove:c,onMouseLeave:i,onClick:d=>d.stopPropagation(),children:"~"}),s&&ns.createPortal(t.jsx("div",{className:"fixed z-[9999] w-56 px-2.5 py-2 rounded-lg bg-[#1a1a1a] border border-[#333] text-[11px] text-[#aaa] leading-tight shadow-xl pointer-events-none",style:{left:s.x+8,top:s.y-8,transform:"translateY(-100%)"},children:e}),document.body)]})}function nr(){const[e,r]=h.useState("hub"),[s,o]=h.useState([]),[a,c]=h.useState(!1),[i,d]=h.useState(null),[w,C]=h.useState(null),[N,S]=h.useState([]),[p,x]=h.useState("current"),[F,H]=h.useState(null),[A,L]=h.useState(null),[$,xe]=h.useState("sales"),[z,P]=h.useState("desc"),[X,ce]=h.useState(!1),[E,D]=h.useState(!0),[B,ye]=h.useState(!1),[q,Ne]=h.useState(!1),[He,V]=h.useState(!1),[W,ie]=h.useState(!1),[Se,ne]=h.useState("Upload CSV / Excel"),[de,we]=h.useState("Upload CSV / Excel"),[Q,U]=h.useState(!1),[oe,Le]=h.useState(0),[R,T]=h.useState(!1),[ae,Ce]=h.useState(()=>new Date().getUTCFullYear()),[ee,le]=h.useState(()=>{const n=new Date;return n.getUTCMonth()-1<0?11:n.getUTCMonth()-1}),[Z,O]=h.useState(0),[K,ve]=h.useState(null),l=h.useRef(null),[u,f]=h.useState(!1),[g,I]=h.useState(""),[b,k]=h.useState(null),[Y,J]=h.useState(""),[M,te]=h.useState(!1),[se,Ut]=h.useState(new Set),[$t,Ht]=h.useState(new Map),[Lt,Ot]=h.useState(!1),[_t,Pt]=h.useState(!1),Oe=h.useRef(null),_e=h.useRef(null);h.useEffect(()=>{Ys();const n=ks();n&&C(n),I(st()),k(Os()),(async()=>{const{data:m,error:j}=await rt.from("chatters").select("full_name, team_name").eq("status","Active").eq("airtable_role","Chatter");if(j||!m||m.length===0){Pt(!0);return}const v=new Set,_=new Map;for(const pe of m){const Ee=pe.full_name.toLowerCase().trim().replace(/\s+/g," ");v.add(Ee);const pt=(pe.team_name||"").replace(/^team\s+/i,"").trim().toUpperCase();pt&&_.set(Ee,pt)}Ut(v),Ht(_),Ot(!0)})()},[]),h.useEffect(()=>{function n(m){R&&l.current&&!l.current.contains(m.target)&&T(!1)}return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[R]);const ke=h.useCallback(()=>Le(n=>n+1),[]);h.useEffect(()=>{if(e!=="hub")return;let n=!1;return o([]),c(!0),d(null),Es(p,F,A,w).then(m=>{n||(o(m),m.length===0?Ts().then(j=>{n||S(j)}):S([]))}).catch(m=>{n||d(m instanceof Error?m.message:"Load failed")}).finally(()=>{n||c(!1)}),()=>{n=!0}},[e,p,F,A,w,oe]);async function zt(n){var j;const m=(j=n.target.files)==null?void 0:j[0];if(m){V(!0);try{const v=await Nt(m),_=Ss(v);ne(`${m.name.slice(0,20)}${m.name.length>20?"...":""} (${_} rows)`),ke()}catch(v){alert(v instanceof Error?v.message:"Upload failed")}finally{V(!1),Oe.current&&(Oe.current.value="")}}}async function Bt(n){var j;const m=(j=n.target.files)==null?void 0:j[0];if(m){ie(!0);try{const v=await Nt(m);C(v),vs(v),we(`${m.name.slice(0,20)}${m.name.length>20?"...":""}`),ke()}catch(v){alert(v instanceof Error?v.message:"Upload failed")}finally{ie(!1),_e.current&&(_e.current.value="")}}}function Vt(){ws(),C(null),ne("Upload CSV / Excel"),we("Upload CSV / Excel"),U(!1),ke()}function Wt(n){n==="employee"?P("alpha"):$===n?P(m=>m==="desc"?"asc":"desc"):(xe(n),P("desc"))}function Kt(n){x(n),n==="custom"?(T(!0),O(0),ve(null)):T(!1)}function lt(n){if(p!=="custom"&&x("custom"),Z===0)ve(n),O(1);else{let m=K,j=n;if(m>j){const v=m;m=j,j=v}H(m),L(j),O(0),ve(null),T(!1),ke()}}function Yt(){le(n=>n===0?(Ce(m=>m-1),11):n-1)}function Gt(){le(n=>n===11?(Ce(m=>m+1),0):n+1)}function qt(){g.trim()&&(Ls(g.trim()),f(!1))}async function Zt(){if(!st()){f(!0);return}te(!0);try{const m=await Ws(Ie,w,p,F,A,se,$t,J);k(m),window.open(m,"_blank")}catch(m){alert(m instanceof Error?m.message:"Export failed")}finally{te(!1),J("")}}const ct=h.useMemo(()=>js(p,F,A,w),[p,F,A,w,oe]),Ie=h.useMemo(()=>e==="hub"?s:ct,[e,s,ct]),re=h.useMemo(()=>X?Ie.filter(n=>!isNaN(Number(n.directMessagesSent))&&Number(n.directMessagesSent)>0):Ie,[Ie,X]),it=h.useCallback(n=>{if(se.size===0)return!1;const m=n.toLowerCase().trim().replace(/\s+/g," ");if(se.has(m))return!0;for(const j of se){if(j.includes(m)||m.includes(j))return!0;const v=j.split(" "),_=m.split(" ");if(v[0]===_[0]&&v[v.length-1]===_[_.length-1])return!0}return!1},[se]),ue=h.useCallback(n=>se.size===0?!0:it(String(n.employee)),[se,it]),je=h.useMemo(()=>[...Ds(re,$,z)].sort((m,j)=>{const v=ue(m),_=ue(j);return v===_?0:v?-1:1}),[re,$,z,ue]),dt=h.useMemo(()=>re.filter(n=>ue(n)),[re,ue]),ut=h.useMemo(()=>As(dt),[dt]),G=h.useMemo(()=>Cs(),[oe]),Pe=h.useMemo(()=>ge(p,F,A),[p,F,A]),ze=e==="hub"?s.length>0:G&&G.totalRecords>0||w,me=h.useMemo(()=>$s(re),[re]),Jt=h.useMemo(()=>Hs(re),[re]),mt=Z===1&&K?{from:K,to:be(K,1)}:Pe,Be=jt(ae,ee,mt),Xt=ee===11?0:ee+1,Qt=ee===11?ae+1:ae,Ve=jt(Qt,Xt,mt);return t.jsxs("div",{className:"space-y-5",children:[t.jsxs("div",{children:[t.jsxs("h1",{className:"text-xl font-bold text-text-primary flex items-center gap-2",children:[t.jsx(ft,{size:22,className:"text-cw"}),"Infloww KPIs"]}),t.jsx("p",{className:"text-sm text-text-muted mt-1",children:e==="hub"?"Using daily data uploaded to the Hub":"Upload Infloww + Hubstaff files manually"})]}),t.jsxs("div",{className:"flex items-center gap-1 bg-surface-1 border border-border rounded-xl p-1 w-fit",children:[t.jsxs("button",{onClick:()=>r("hub"),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors ${e==="hub"?"bg-cw text-white":"text-text-muted hover:text-text-primary"}`,children:[t.jsx(Ke,{size:12}),"Hub Data"]}),t.jsxs("button",{onClick:()=>r("csv"),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors ${e==="csv"?"bg-cw text-white":"text-text-muted hover:text-text-primary"}`,children:[t.jsx(We,{size:12}),"Manual CSV"]})]}),_t&&t.jsxs("div",{className:"bg-red-950/40 border border-red-800/50 rounded-xl px-4 py-3 flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-red-300",children:"Could not load the active chatters list from Supabase. Data may be inaccurate."}),t.jsx("button",{onClick:()=>window.location.reload(),className:"px-3 py-1.5 rounded-lg text-xs font-medium bg-red-800/50 text-red-200 hover:bg-red-800/70 transition-colors",children:"Reload page"})]}),e==="hub"&&t.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl px-4 py-2.5 space-y-1.5",children:[t.jsx("div",{className:"flex items-center gap-2",children:a?t.jsxs(t.Fragment,{children:[t.jsx(Te,{size:13,className:"animate-spin text-cw"}),t.jsx("span",{className:"text-xs text-text-muted",children:"Loading data from Hub..."})]}):i?t.jsx(t.Fragment,{children:t.jsxs("span",{className:"text-xs text-red-400",children:["Error: ",i]})}):t.jsxs(t.Fragment,{children:[t.jsx(Ke,{size:13,className:"text-cw"}),t.jsxs("span",{className:"text-xs text-text-muted",children:[s.length," employees loaded from Hub",Lt?` Â· ${se.size} active chatters verified`:""]})]})}),!a&&!i&&s.length===0&&N.length>0&&t.jsxs("div",{className:"text-xs text-amber-400/80",children:["Data exists for: ",N.slice(0,10).join(", "),N.length>10?` (+${N.length-10} more)`:"",'. Try selecting a matching period or "All Data".']}),!a&&!i&&s.length===0&&N.length===0&&t.jsx("div",{className:"text-xs text-red-400/80",children:"No data found in the database. Upload Employee Reports via the Upload Center first."})]}),e==="csv"&&t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[t.jsxs("label",{className:"bg-surface-1 border border-border rounded-xl p-4 cursor-pointer hover:border-cw/30 transition-colors",children:[t.jsx("input",{ref:Oe,type:"file",accept:".csv,.xlsx,.xls",onChange:zt,className:"hidden"}),t.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-text-muted/60 mb-1.5",children:"1. Infloww (Marketing Analytics)"}),t.jsxs("div",{className:"flex items-center gap-2",children:[He?t.jsx(Te,{size:14,className:"animate-spin text-cw"}):t.jsx(We,{size:14,className:"text-cw"}),t.jsx("span",{className:"text-sm text-text-primary font-medium truncate",children:Se})]})]}),t.jsxs("label",{className:"bg-surface-1 border border-border rounded-xl p-4 cursor-pointer hover:border-cw/30 transition-colors",children:[t.jsx("input",{ref:_e,type:"file",accept:".csv,.xlsx,.xls",onChange:Bt,className:"hidden"}),t.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-text-muted/60 mb-1.5",children:"2. Hubstaff (Timesheets)"}),t.jsxs("div",{className:"flex items-center gap-2",children:[W?t.jsx(Te,{size:14,className:"animate-spin text-cw"}):t.jsx(We,{size:14,className:"text-cw"}),t.jsx("span",{className:"text-sm text-text-primary font-medium truncate",children:de})]})]})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsxs("button",{onClick:Zt,disabled:M||!ze,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium bg-emerald-900/40 text-emerald-300 border border-emerald-700/40 hover:bg-emerald-900/60 disabled:opacity-40 transition-colors",children:[M?t.jsx(Te,{size:12,className:"animate-spin"}):t.jsx(os,{size:12}),M?Y||"Exporting...":"Export to Google Sheets"]}),t.jsx("button",{onClick:()=>f(!u),className:"p-1.5 rounded-lg text-text-muted hover:text-text-primary border border-border hover:border-border transition-colors",title:"Configure Client ID",children:t.jsx(ps,{size:13})}),b&&t.jsxs("a",{href:b,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-xs text-emerald-400 hover:text-emerald-300 transition-colors",children:[t.jsx(ts,{size:11}),"Open Sheet"]})]}),u&&t.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl p-4",children:[t.jsxs("p",{className:"text-xs text-text-muted mb-2",children:["To export you need a ",t.jsx("strong",{children:"Google OAuth2 Client ID"}),". Create one in"," ",t.jsx("a",{href:"https://console.cloud.google.com/apis/credentials",target:"_blank",rel:"noopener noreferrer",className:"text-cw hover:underline",children:"Google Cloud Console"})," ","(enable the Google Sheets API first)."]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:g,onChange:n=>I(n.target.value),placeholder:"Your Client ID (e.g. 123456.apps.googleusercontent.com)",className:"flex-1 bg-surface-2 border border-border rounded-lg px-3 py-2 text-xs text-text-primary placeholder:text-text-muted/50"}),t.jsx("button",{onClick:qt,className:"px-3 py-2 rounded-lg text-xs font-medium bg-cw text-white hover:bg-cw/80 transition-colors",children:"Save"})]})]}),e==="csv"&&G&&t.jsxs("div",{className:"flex items-center justify-between bg-surface-1 border border-border rounded-xl px-4 py-2.5",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ke,{size:13,className:"text-text-muted"}),t.jsxs("span",{className:"text-xs text-text-muted",children:[G.totalRecords," records Â· ",G.periodCount," period",G.periodCount!==1?"s":"",G.earliest&&G.latest&&t.jsxs(t.Fragment,{children:[" Â· ",new Date(G.earliest+"T00:00:00Z").toLocaleDateString("en-US",{month:"short",day:"numeric",timeZone:"UTC"})," â€” ",new Date(G.latest+"T00:00:00Z").toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",timeZone:"UTC"})]})]})]}),Q?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-xs text-red-400",children:"Clear all data?"}),t.jsx("button",{onClick:Vt,className:"text-xs text-red-400 font-medium hover:text-red-300",children:"Yes"}),t.jsx("button",{onClick:()=>U(!1),className:"text-xs text-text-muted hover:text-text-primary",children:"Cancel"})]}):t.jsxs("button",{onClick:()=>U(!0),className:"flex items-center gap-1 text-xs text-text-muted hover:text-red-400 transition-colors",children:[t.jsx(as,{size:11}),"Clear"]})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[t.jsx("div",{className:"flex gap-1 bg-surface-1 rounded-lg p-0.5 border border-border",children:Gs.map(n=>t.jsx("button",{onClick:()=>Kt(n.id),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-all ${p===n.id?"bg-cw text-white":"text-text-muted hover:text-text-primary"}`,children:n.label},n.id))}),t.jsxs("div",{className:"relative",ref:l,children:[t.jsx("button",{onClick:()=>T(!R),className:`p-1.5 rounded-lg border transition-colors ${R?"bg-cw text-white border-cw":"text-text-muted border-border hover:text-text-primary"}`,title:"Calendar",children:t.jsx(ss,{size:14})}),R&&t.jsxs("div",{className:"absolute top-full left-0 z-30 mt-2 bg-surface-1 border border-border rounded-xl p-3 shadow-xl shadow-black/30",style:{width:"540px"},children:[Z===1&&t.jsxs("p",{className:"text-center text-xs text-cw font-medium mb-2",children:["Start: ",new Date(K+"T00:00:00Z").toLocaleDateString("en-US",{month:"short",day:"numeric",timeZone:"UTC"})," Â· Select end date"]}),Z===0&&p==="custom"&&t.jsx("p",{className:"text-center text-xs text-cw font-medium mb-2",children:"Select start date"}),t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("button",{onClick:Yt,className:"mt-6 p-1 rounded border border-border text-text-muted hover:text-text-primary hover:bg-surface-2 transition-colors flex-shrink-0",children:t.jsx(rs,{size:14})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-center text-xs font-semibold text-text-primary capitalize mb-1",children:Be.title}),t.jsxs("div",{className:"grid grid-cols-7 gap-0",children:[["Mo","Tu","We","Th","Fr","Sa","Su"].map(n=>t.jsx("div",{className:"text-center text-[10px] text-text-muted font-medium py-1",children:n},n)),Array.from({length:Be.blanks}).map((n,m)=>t.jsx("div",{className:"h-7"},`b${m}`)),Be.days.map(n=>t.jsx("button",{onClick:()=>lt(n.date),className:`h-7 flex items-center justify-center text-[11px] transition-colors rounded-sm ${n.isSingle?"bg-cw text-white font-bold":n.isStart?"bg-cw text-white rounded-l-full":n.isEnd?"bg-cw text-white rounded-r-full":n.inRange?"bg-cw/15 text-text-primary":"text-text-secondary hover:bg-surface-2"} ${n.isToday&&!n.isSingle&&!n.isStart&&!n.isEnd?"ring-1 ring-cw/50 ring-inset":""}`,children:n.day},n.date))]})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-center text-xs font-semibold text-text-primary capitalize mb-1",children:Ve.title}),t.jsxs("div",{className:"grid grid-cols-7 gap-0",children:[["Mo","Tu","We","Th","Fr","Sa","Su"].map(n=>t.jsx("div",{className:"text-center text-[10px] text-text-muted font-medium py-1",children:n},n)),Array.from({length:Ve.blanks}).map((n,m)=>t.jsx("div",{className:"h-7"},`b${m}`)),Ve.days.map(n=>t.jsx("button",{onClick:()=>lt(n.date),className:`h-7 flex items-center justify-center text-[11px] transition-colors rounded-sm ${n.isSingle?"bg-cw text-white font-bold":n.isStart?"bg-cw text-white rounded-l-full":n.isEnd?"bg-cw text-white rounded-r-full":n.inRange?"bg-cw/15 text-text-primary":"text-text-secondary hover:bg-surface-2"} ${n.isToday&&!n.isSingle&&!n.isStart&&!n.isEnd?"ring-1 ring-cw/50 ring-inset":""}`,children:n.day},n.date))]})]}),t.jsx("button",{onClick:Gt,className:"mt-6 p-1 rounded border border-border text-text-muted hover:text-text-primary hover:bg-surface-2 transition-colors flex-shrink-0",children:t.jsx(ls,{size:14})})]})]})]}),Pe&&t.jsx("span",{className:"text-xs text-cw font-medium",children:Ms(Pe)})]}),ze&&t.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[t.jsxs("div",{className:"flex gap-1 bg-surface-1 rounded-lg p-0.5 border border-border",children:[t.jsx("button",{onClick:()=>P("desc"),className:`p-1.5 rounded-md transition-all ${z==="desc"?"bg-cw text-white":"text-text-muted hover:text-text-primary"}`,title:"Highest first",children:t.jsx(ht,{size:13})}),t.jsx("button",{onClick:()=>P("asc"),className:`p-1.5 rounded-md transition-all ${z==="asc"?"bg-cw text-white":"text-text-muted hover:text-text-primary"}`,title:"Lowest first",children:t.jsx(xt,{size:13})}),t.jsx("button",{onClick:()=>P("alpha"),className:`p-1.5 rounded-md transition-all ${z==="alpha"?"bg-cw text-white":"text-text-muted hover:text-text-primary"}`,title:"A-Z",children:t.jsx(us,{size:13})})]}),t.jsxs("div",{className:"flex gap-1 bg-surface-1 rounded-lg p-0.5 border border-border",children:[t.jsx("button",{onClick:()=>ye(!1),className:`p-1.5 rounded-md transition-all ${B?"text-text-muted hover:text-text-primary":"bg-cw text-white"}`,title:"Full table",children:t.jsx(cs,{size:13})}),t.jsx("button",{onClick:()=>ye(!0),className:`p-1.5 rounded-md transition-all ${B?"bg-cw text-white":"text-text-muted hover:text-text-primary"}`,title:"Compact ranking",children:t.jsx(is,{size:13})})]}),t.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:X,onChange:n=>ce(n.target.checked),className:"accent-cw w-3.5 h-3.5"}),t.jsx("span",{className:"text-xs text-text-muted",children:"Hide inactive"})]}),!B&&t.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:E,onChange:n=>D(n.target.checked),className:"accent-cw w-3.5 h-3.5"}),t.jsx("span",{className:"text-xs text-text-muted",children:"Show averages"})]})]}),ze?je.length===0&&!B?t.jsxs("div",{className:"bg-surface-1 border border-dashed border-border rounded-xl p-10 text-center",children:[t.jsx(ms,{size:32,className:"text-text-muted mx-auto mb-2"}),t.jsx("p",{className:"text-sm text-text-muted",children:"No data for this period. Try a different range or upload more files."})]}):B?t.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl overflow-hidden max-w-xl mx-auto",children:[t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-xs",children:[t.jsxs("thead",{children:[t.jsx("tr",{children:t.jsxs("th",{colSpan:5,className:"px-3 py-2 text-center text-sm font-bold border-b-2 border-cw/20",children:["TOTAL SALES"," ",t.jsxs("span",{className:"text-base inline-block border-b-2 border-emerald-400 pb-px",style:{background:"linear-gradient(90deg, #166534, #4ade80, #bbf7d0)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:["$",Math.round(Jt*100)/100]})]})}),t.jsxs("tr",{className:"border-b border-border",children:[t.jsx("th",{className:"px-2 py-1.5 text-center font-semibold text-text-muted w-12",children:"Rank"}),t.jsx("th",{className:"px-2 py-1.5 text-center font-semibold text-text-muted",children:"Top Chatters"}),t.jsx("th",{className:"px-2 py-1.5 text-center font-semibold text-text-muted",children:"Sales"}),t.jsx("th",{className:"px-2 py-1.5 text-center font-semibold text-emerald-400",children:"$$ BONUS $$"}),t.jsx("th",{className:"px-2 py-1.5 text-center font-semibold text-amber-400",children:"JACKPOT +$50k total sales BONUS $$"})]})]}),t.jsx("tbody",{children:me.slice(0,q?void 0:De).map((n,m)=>{const j=m<Ct.length,v=String(n.employee||"").split(" ")[0];return t.jsxs("tr",{className:"border-b border-border last:border-b-0 hover:bg-surface-2/50 transition-colors",children:[t.jsxs("td",{className:"px-2 py-1 text-center font-bold text-text-muted text-xs",children:[m+1,m<vt.length?" "+vt[m]:""]}),t.jsx("td",{className:"px-2 py-1 text-center font-semibold text-text-primary",children:v}),t.jsx("td",{className:"px-2 py-1 text-center text-emerald-400 font-semibold",children:Je(n.sales,"currency")}),t.jsx("td",{className:`px-2 py-1 text-center font-bold ${j?"text-emerald-400":"text-text-muted/40 italic"}`,children:j?`$${Ct[m].toFixed(2)}`:"Keep pushing"}),t.jsx("td",{className:`px-2 py-1 text-center font-bold ${j?"text-amber-400":"text-text-muted/40 italic"}`,children:j?`$${Us[m].toFixed(2)}`:"Keep pushing"})]},m)})})]})}),me.length>De&&t.jsx("button",{onClick:()=>Ne(!q),className:"w-full py-1.5 text-xs text-text-muted hover:text-text-primary hover:bg-surface-2/50 border-t border-border transition-colors",children:q?`Hide ${me.length-De} more`:`Show ${me.length-De} more`}),t.jsxs("div",{className:"px-3 py-1.5 border-t border-border text-[10px] text-text-muted",children:[me.length," employee",me.length!==1?"s":""," ranked"]})]}):t.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl overflow-hidden",children:[t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-xs",children:[t.jsxs("thead",{children:[E&&t.jsx("tr",{className:"border-b-2 border-cw/20",children:Re.map(n=>{const m=n.hasAvg&&ut[n.key]!=null?Je(ut[n.key],n.type):null,j=!!n.approxReason&&m&&m!=="â€”";return t.jsx("th",{className:"px-3 py-2 text-left font-semibold bg-surface-2/50",children:n.key==="employee"?t.jsx("span",{className:"text-cw uppercase text-[10px] tracking-wider",children:"Average"}):m?t.jsxs("span",{className:n.type==="currency"?"text-emerald-400":"text-text-primary",children:[j&&t.jsx(tt,{reason:n.approxReason,className:"text-[9px] text-amber-400/40 mr-0.5"}),m]}):null},`avg-${n.key}`)})}),t.jsx("tr",{className:"border-b border-border",children:Re.map(n=>{const m=$===n.key&&z!=="alpha";return t.jsx("th",{onClick:()=>Wt(n.key),className:`px-3 py-2.5 text-left font-semibold cursor-pointer select-none whitespace-nowrap transition-colors hover:text-text-primary ${m?"text-cw":"text-text-muted"}`,children:t.jsxs("span",{className:"flex items-center gap-1",children:[n.approxReason&&t.jsx(tt,{reason:n.approxReason}),n.label,m&&(z==="desc"?t.jsx(ht,{size:10}):t.jsx(xt,{size:10})),!m&&n.key!=="employee"&&t.jsx(ds,{size:9,className:"opacity-30"})]})},n.key)})})]}),t.jsx("tbody",{children:je.map((n,m)=>{const j=ue(n);return t.jsx("tr",{className:`border-b border-border last:border-b-0 transition-colors hover:bg-surface-2/50 ${j?"":"opacity-30"}`,children:Re.map(v=>{const _=n[v.key],pe=v.type==="text"?String(_||""):Je(_,v.type),Ee=!!v.approxReason&&pe!=="â€”";return t.jsx("td",{className:`px-3 py-2 whitespace-nowrap ${v.key==="employee"?"font-medium text-text-primary":v.type==="currency"?"text-emerald-400 font-semibold":"text-text-secondary"}`,children:Ee?t.jsxs(t.Fragment,{children:[t.jsx(tt,{reason:v.approxReason,className:"text-[9px] text-amber-400/40 mr-0.5"}),pe]}):pe},v.key)})},m)})})]})}),t.jsxs("div",{className:"px-4 py-2 border-t border-border text-[10px] text-text-muted",children:[je.length," employee",je.length!==1?"s":""," shown"]})]}):t.jsxs("div",{className:"bg-surface-1 border border-dashed border-border rounded-xl p-10 text-center",children:[t.jsx(ft,{size:40,className:"text-text-muted mx-auto mb-3 opacity-50"}),t.jsx("h2",{className:"text-base font-semibold text-text-primary mb-1",children:"No data yet"}),t.jsxs("p",{className:"text-sm text-text-muted max-w-md mx-auto",children:["Upload the ",t.jsx("strong",{children:"Infloww CSV"})," and the ",t.jsx("strong",{children:"Hubstaff CSV"})," to see employee performance stats."]})]})]})}export{nr as default};
