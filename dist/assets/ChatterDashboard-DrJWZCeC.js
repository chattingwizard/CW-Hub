import{u as Z,r as l,s as n,j as e,C as ee,v as M,e as se,U as te,y as ae}from"./index-CYnCRFTw.js";import{g as re,a as le,c as B,b as R,d as ce,e as H,f as F,h as I}from"./scoreUtils-_9d8pvRV.js";import{M as de}from"./ModelAvatar-6PxnQmVc.js";import{C as ne}from"./circle-alert-CgAouJ1b.js";import{C as U}from"./clock-BuNhfYeB.js";import{C as ie}from"./circle-check-big-BnELrjZw.js";import{T as oe}from"./trending-up-z9uvJiNv.js";import{T as xe}from"./trending-down-B84inAc5.js";function we(){var P;const{profile:a}=Z(),[h,b]=l.useState(null),[w,p]=l.useState([]),[f,C]=l.useState([]),[c,x]=l.useState([]),[i,d]=l.useState(!0),[g,W]=l.useState(null),[T,L]=l.useState([]),[m,v]=l.useState(null),[_,j]=l.useState([]),[N,Y]=l.useState(null),y=re(new Date),k=le(y),S=(()=>{const t=new Date,s=t.getDay(),r=t.getDate()-s+(s===0?-6:1);return t.setDate(r),t.toISOString().split("T")[0]})(),E=l.useCallback(async()=>{if(!a)return;d(!0);const{data:t}=await n.from("chatters").select("*").eq("profile_id",a.id).single();if(!t){d(!1);return}const s=t;b(s);const r=new Date(S+"T00:00:00");r.setDate(r.getDate()+6);const o=r.toISOString().split("T")[0],[u,D,A]=await Promise.all([n.from("schedules").select("*").eq("chatter_id",s.id).eq("week_start",S),s.team_name?n.from("models").select("*").contains("team_names",[s.team_name]):Promise.resolve({data:[]}),n.from("chatter_hours").select("*").eq("chatter_id",s.id).gte("date",S).lte("date",o)]);p(u.data??[]),C(D.data??[]),x(A.data??[]);const[G,J,Q,V,X]=await Promise.all([n.from("score_config").select("*").eq("id",1).single(),n.from("score_events").select("*, event_type:score_event_types(*)").eq("chatter_id",s.id).eq("week",y),n.from("score_weekly_reports").select("*").eq("chatter_id",s.id).eq("week",y).maybeSingle(),n.from("score_events").select("*, event_type:score_event_types(*)").eq("chatter_id",s.id).eq("week",k),n.from("score_weekly_reports").select("*").eq("chatter_id",s.id).eq("week",k).maybeSingle()]);W(G.data),L(J.data??[]),v(Q.data??null),j(V.data??[]),Y(X.data??null),d(!1)},[a,S,y,k]);l.useEffect(()=>{E()},[E]);const z=c.reduce((t,s)=>t+(s.hours_worked||0),0),K=c.filter(t=>t.hours_worked>=1).length,q=new Date().getDay()===0?6:new Date().getDay()-1,$=w.find(t=>t.day_of_week===q),O=((P=a==null?void 0:a.full_name)==null?void 0:P.split(" ")[0])||"there";return i?e.jsx("div",{className:"p-6 flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"flex items-center gap-2 text-text-secondary",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-cw/30 border-t-cw rounded-full animate-spin"}),"Loading your dashboard..."]})}):h?e.jsxs("div",{className:"p-4 lg:p-6 max-w-5xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-extrabold text-text-primary",children:["Hey ",O,"!"]}),e.jsxs("p",{className:"text-text-secondary text-sm mt-1",children:[new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"}),h.team_name&&e.jsxs("span",{className:"text-cw",children:[" Â· ",h.team_name]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 lg:gap-4 mb-6",children:[e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm text-text-secondary",children:"Hours This Week"}),e.jsx("div",{className:"w-8 h-8 rounded-lg bg-cw/10 flex items-center justify-center",children:e.jsx(U,{size:16,className:"text-cw"})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("p",{className:"text-3xl font-bold text-white",children:[z.toFixed(1),e.jsx("span",{className:"text-lg text-text-muted",children:"h"})]}),e.jsxs("div",{className:"relative w-14 h-14",children:[e.jsxs("svg",{className:"w-14 h-14 -rotate-90",viewBox:"0 0 36 36",children:[e.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"#252525",strokeWidth:"3"}),e.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"#1d9bf0",strokeWidth:"3",strokeDasharray:`${Math.min(z/40*100,100)}, 100`})]}),e.jsxs("span",{className:"absolute inset-0 flex items-center justify-center text-[10px] text-text-secondary font-medium",children:[Math.round(z/40*100),"%"]})]})]})]}),e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm text-text-secondary",children:"Days Worked"}),e.jsx("div",{className:"w-8 h-8 rounded-lg bg-success/10 flex items-center justify-center",children:e.jsx(ee,{size:16,className:"text-success"})})]}),e.jsxs("p",{className:"text-3xl font-bold text-white mb-3",children:[K,e.jsx("span",{className:"text-lg text-text-muted",children:"/7"})]}),e.jsx("div",{className:"flex gap-1.5",children:Array.from({length:7},(t,s)=>{const r=c.some(u=>{const D=new Date(u.date+"T00:00:00");return(D.getDay()===0?6:D.getDay()-1)===s&&u.hours_worked>=1}),o=s===q;return e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-[9px] font-medium ${r?"bg-cw text-white":o?"bg-surface-3 border border-cw/50 text-cw":"bg-surface-3 text-text-muted"}`,title:M(s,"long"),children:r?e.jsx(ie,{size:12}):M(s).charAt(0)},s)})})]}),e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm text-text-secondary",children:"Today's Shift"}),e.jsx("div",{className:"w-8 h-8 rounded-lg bg-cw/10 flex items-center justify-center",children:e.jsx(U,{size:16,className:"text-cw"})})]}),$?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xl font-bold text-white",children:se[$.shift]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-success animate-pulse"}),e.jsx("span",{className:"text-xs text-success",children:"Scheduled"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xl font-bold text-text-muted",children:"Day Off"}),e.jsx("p",{className:"text-xs text-text-muted mt-2",children:"No shift scheduled for today"})]})]})]}),g&&e.jsx(me,{config:g,events:T,weeklyReport:m,lastWeekEvents:_,lastWeekReport:N,currentWeekKey:y,lastWeekKey:k}),e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl p-5 mb-6",children:[e.jsx("h2",{className:"text-sm font-semibold text-white mb-4",children:"Your Schedule This Week"}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:Array.from({length:7},(t,s)=>{const r=w.find(u=>u.day_of_week===s),o=s===q;return e.jsxs("div",{className:`rounded-lg p-3 text-center transition-colors ${r?o?"bg-cw/20 border-2 border-cw/50":"bg-cw/10 border border-cw/30":o?"bg-surface-2 border-2 border-border":"bg-surface-2 border border-border"}`,children:[e.jsx("p",{className:`text-xs font-medium mb-1 ${r?"text-cw":o?"text-white":"text-text-muted"}`,children:M(s)}),e.jsx("p",{className:`text-[11px] ${r?"text-white":"text-text-muted"}`,children:r?r.shift:"OFF"})]},s)})})]}),e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(te,{size:16,className:"text-cw"}),e.jsx("h2",{className:"text-sm font-semibold text-white",children:"Your Team's Models"}),e.jsxs("span",{className:"text-xs text-text-muted",children:["(",f.filter(t=>t.status==="Live").length," live)"]})]}),f.length===0?e.jsx("p",{className:"text-sm text-text-muted py-4 text-center",children:"No models assigned to your team yet."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:f.filter(t=>t.status==="Live").map(t=>e.jsxs("div",{className:"bg-surface-2 border border-border rounded-lg p-4 hover:border-cw/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(de,{name:t.name,pictureUrl:t.profile_picture_url,size:"md"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-white truncate",children:t.name}),e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-success/15 text-success",children:"Live"})]})]}),t.niche.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:t.niche.slice(0,2).map(s=>e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-surface-3 text-text-muted",children:s},s))})]},t.id))})]})]}):e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl p-8 text-center max-w-lg mx-auto mt-12",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-warning/15 flex items-center justify-center mx-auto mb-4",children:e.jsx(ne,{size:28,className:"text-warning"})}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Account Not Linked"}),e.jsx("p",{className:"text-text-secondary text-sm leading-relaxed",children:"Your Hub account hasn't been linked to a chatter profile yet. Please contact your Team Leader or Rycel to link your account."}),e.jsxs("div",{className:"mt-6 bg-surface-2 rounded-lg p-4 text-left",children:[e.jsx("p",{className:"text-xs text-text-muted mb-1",children:"Your account email:"}),e.jsx("p",{className:"text-sm text-white",children:a==null?void 0:a.email}),e.jsx("p",{className:"text-xs text-text-muted mt-2 mb-1",children:"Your name:"}),e.jsx("p",{className:"text-sm text-white",children:(a==null?void 0:a.full_name)||"Not set"})]})]})})}function me({config:a,events:h,weeklyReport:b,lastWeekEvents:w,lastWeekReport:p,currentWeekKey:f,lastWeekKey:C}){const c=h.reduce((j,N)=>j+N.points,0),x=(b==null?void 0:b.weekly_points)??0,i=a.base_score+c+x,d=B(i,a);R(i,a);const g=H(d),W=ce(i,a),T=w.reduce((j,N)=>j+N.points,0),L=(p==null?void 0:p.weekly_points)??0,m=a.base_score+T+L,v=R(m,a),_=H(B(m,a));return e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl p-5 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ae,{size:16,className:"text-amber-400"}),e.jsx("h2",{className:"text-sm font-semibold text-white",children:"My Score"}),e.jsx("span",{className:"text-[10px] text-text-muted ml-auto",children:F(f)})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-surface-2 rounded-xl border border-border p-4",children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-text-muted mb-2",children:"This Week"}),e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("span",{className:`text-4xl font-extrabold ${I(i,a)}`,children:i}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-bold border ${g.colorClass}`,children:g.label})]}),e.jsx("div",{className:"h-2 bg-surface-3 rounded-full overflow-hidden mb-3",children:e.jsx("div",{className:`h-full rounded-full transition-all ${d==="warning"?"bg-red-500":d==="no_bonus"?"bg-zinc-500":d==="bonus_5"?"bg-cyan-400":d==="bonus_10"?"bg-blue-400":"bg-emerald-400"}`,style:{width:`${W}%`}})}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-muted",children:"Base"}),e.jsx("span",{className:"text-text-primary",children:a.base_score})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-muted",children:"Events"}),e.jsxs("span",{className:c>0?"text-emerald-400":c<0?"text-red-400":"text-text-muted",children:[c>0?"+":"",c]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-muted",children:"Weekly Report"}),e.jsxs("span",{className:x>0?"text-emerald-400":"text-text-muted",children:[x>0?"+":"",x]})]})]})]}),e.jsxs("div",{className:"bg-surface-2 rounded-xl border border-border p-4",children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-text-muted mb-2",children:"Last Week"}),e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("span",{className:`text-4xl font-extrabold ${I(m,a)}`,children:m}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-bold border ${_.colorClass}`,children:_.label})]}),v>0?e.jsxs("div",{className:"flex items-center gap-2 bg-emerald-500/10 rounded-lg px-3 py-2 mt-2",children:[e.jsx(oe,{size:14,className:"text-emerald-400"}),e.jsxs("span",{className:"text-sm font-bold text-emerald-400",children:["$",v," Bonus"]})]}):e.jsxs("div",{className:"flex items-center gap-2 bg-zinc-500/10 rounded-lg px-3 py-2 mt-2",children:[e.jsx(xe,{size:14,className:"text-zinc-400"}),e.jsx("span",{className:"text-sm font-medium text-zinc-400",children:"No bonus earned"})]}),e.jsx("p",{className:"text-[10px] text-text-muted mt-2",children:F(C)})]})]})]})}export{we as default};
