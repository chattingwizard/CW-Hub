import{c as K,r as n,s as C,j as e,f as h,U as B,m as G}from"./index-CYnCRFTw.js";import{D as W}from"./dollar-sign-A9eCgXbG.js";import{T as J}from"./target-NWcYlJ0-.js";import{T as Q}from"./trending-up-z9uvJiNv.js";import{S as X}from"./search-Bbo2uRBQ.js";import{a as Y,C as Z}from"./chevron-up-CMAuF40Q.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=K("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]),k=4,$={"Team Danilyn":{bg:"bg-blue-500/15",text:"text-blue-400",border:"border-blue-500/30"},"Team Huckle":{bg:"bg-orange-500/15",text:"text-orange-400",border:"border-orange-500/30"},"Team Ezekiel":{bg:"bg-purple-500/15",text:"text-purple-400",border:"border-purple-500/30"}};function _(a,l){switch(a){case"fan_cvr":return l>=12?"text-success":l>=8?"text-warning":"text-danger";case"golden_ratio":return l>=4?"text-success":l>=2.5?"text-warning":"text-danger";case"unlock_rate":return l>=40?"text-success":l>=25?"text-warning":"text-danger";case"sales_per_hour":return l>=80?"text-success":l>=50?"text-warning":"text-danger";case"messages_per_hour":return l>=100?"text-success":l>=60?"text-warning":"text-danger";default:return"text-white"}}function ce(){const[a,l]=n.useState([]),[x,m]=n.useState(!0),[b,N]=n.useState([]),[g,T]=n.useState(""),[w,A]=n.useState(""),[y,R]=n.useState("all"),[o,P]=n.useState("sales"),[d,F]=n.useState("desc"),[U,E]=n.useState(null),[S,I]=n.useState(new Map);n.useEffect(()=>{(async()=>{const{data:t}=await C.from("chatters").select("full_name, team_name").eq("status","Active").eq("airtable_role","Chatter");if(t){const s=new Map;for(const r of t){const i=r.full_name.toLowerCase().trim().replace(/\s+/g," ");s.set(i,r.team_name??"")}I(s)}})()},[]);const M=n.useCallback(async()=>{const{data:t}=await C.from("chatter_daily_stats").select("date").order("date",{ascending:!1});if(t){const s=[...new Set(t.map(r=>r.date))];N(s),s.length>0&&!g&&T(s[0])}},[g]),D=n.useCallback(async()=>{if(!g||S.size===0)return;m(!0);const{data:t,error:s}=await C.from("chatter_daily_stats").select("*").eq("date",g).order("sales",{ascending:!1});if(!s&&t){const i=t.map(c=>{const O=c.employee_name.toLowerCase().trim().replace(/\s+/g," "),V=S.get(O);return V===void 0?null:{...c,team:V||c.team}}).filter(c=>c!==null);l(i)}m(!1)},[g,S]);n.useEffect(()=>{M()},[M]),n.useEffect(()=>{D()},[D]);const q=n.useMemo(()=>{const t=new Set(a.map(s=>s.team).filter(Boolean));return["all",...Array.from(t).sort()]},[a]),H=n.useMemo(()=>{let t=a;if(y!=="all"&&(t=t.filter(s=>s.team===y)),w){const s=w.toLowerCase();t=t.filter(r=>r.employee_name.toLowerCase().includes(s)||(r.creators||"").toLowerCase().includes(s))}return t=t.filter(s=>s.clocked_hours>=k),t=[...t].sort((s,r)=>{let i=0,c=0;return o==="employee_name"?(i=s.employee_name.toLowerCase(),c=r.employee_name.toLowerCase(),d==="asc"?i.localeCompare(c):c.localeCompare(i)):(o==="response_time_clocked"?(i=L(s.response_time_clocked),c=L(r.response_time_clocked)):(i=s[o]??0,c=r[o]??0),d==="asc"?i-c:c-i)}),t},[a,y,w,o,d]),z=n.useMemo(()=>{const t={};for(const s of a.filter(r=>r.clocked_hours>=k))s.team&&(t[s.team]||(t[s.team]={sales:0,chatters:0,fans:0,hours:0,salesHrValues:[]}),t[s.team].sales+=s.sales,t[s.team].chatters+=1,t[s.team].fans+=s.fans_chatted,t[s.team].hours+=s.clocked_hours,s.sales_per_hour>0&&t[s.team].salesHrValues.push(s.sales_per_hour));return Object.entries(t).map(([s,r])=>({team:s,sales:r.sales,chatters:r.chatters,fans:r.fans,hours:r.hours,avgSalesHr:r.salesHrValues.length?r.salesHrValues.reduce((i,c)=>i+c,0)/r.salesHrValues.length:0})).sort((s,r)=>r.sales-s.sales)},[a]),j=n.useMemo(()=>{const t=a.filter(s=>s.clocked_hours>=k);return{totalSales:t.reduce((s,r)=>s+r.sales,0),totalChatters:t.length,totalFans:t.reduce((s,r)=>s+r.fans_chatted,0),avgCVR:t.length>0?t.reduce((s,r)=>s+r.fan_cvr,0)/t.length:0,avgSalesHr:t.length>0?t.reduce((s,r)=>s+r.sales_per_hour,0)/t.length:0}},[a]),p=t=>{o===t?F(d==="asc"?"desc":"asc"):(P(t),F("desc"))};return e.jsxs("div",{className:"min-h-screen bg-surface-0 p-4 lg:p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-extrabold text-text-primary",children:"Chatter Performance"}),e.jsx("p",{className:"text-sm text-text-secondary mt-0.5",children:"Daily KPIs from Inflow Employee Reports"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("select",{value:g,onChange:t=>T(t.target.value),className:"bg-surface-2 border border-border text-white text-sm rounded-lg px-3 py-2 focus:border-cw focus:outline-none",children:b.map(t=>e.jsx("option",{value:t,children:new Date(t+"T00:00:00").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})},t))})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3 mb-6",children:[e.jsx(v,{icon:W,label:"Total Sales",value:h(j.totalSales),color:"text-success"}),e.jsx(v,{icon:B,label:"Active Chatters",value:String(j.totalChatters),color:"text-cw"}),e.jsx(v,{icon:G,label:"Total Fans",value:String(j.totalFans),color:"text-blue-400"}),e.jsx(v,{icon:J,label:"Avg CVR",value:`${j.avgCVR.toFixed(1)}%`,color:j.avgCVR>=10?"text-success":"text-warning"}),e.jsx(v,{icon:Q,label:"Avg $/hr",value:h(j.avgSalesHr),color:j.avgSalesHr>=70?"text-success":"text-warning"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 mb-6",children:z.map(t=>{const s=$[t.team]??{bg:"bg-surface-2",text:"text-white",border:"border-border"};return e.jsxs("div",{className:`${s.bg} border ${s.border} rounded-xl p-4`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:`text-sm font-semibold ${s.text}`,children:t.team}),e.jsxs("span",{className:"text-xs text-text-muted",children:[t.chatters," chatters"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold text-white",children:h(t.sales)}),e.jsxs("p",{className:"text-xs text-text-secondary",children:[t.fans," fans chatted"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`text-sm font-medium ${t.avgSalesHr>=70?"text-success":"text-warning"}`,children:[h(t.avgSalesHr),"/hr"]}),e.jsxs("p",{className:"text-xs text-text-muted",children:[t.hours.toFixed(0),"h total"]})]})]})]},t.team)})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-xs",children:[e.jsx(X,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),e.jsx("input",{type:"text",placeholder:"Search chatter or model...",value:w,onChange:t=>A(t.target.value),className:"w-full bg-surface-2 border border-border text-white text-sm rounded-lg pl-9 pr-3 py-2 focus:border-cw focus:outline-none"})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:q.map(t=>{const s=y===t,r=t!=="all"?$[t]:null;return e.jsx("button",{onClick:()=>R(t),className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${s?r?`${r.bg} ${r.text} ${r.border}`:"bg-cw/15 text-cw border-cw/30":"bg-surface-2 text-text-secondary border-border hover:border-text-muted"}`,children:t==="all"?"All Teams":t.replace("Team ","")},t)})}),e.jsxs("span",{className:"text-xs text-text-muted self-center ml-auto",children:[H.length," chatters"]})]}),x?e.jsx("div",{className:"flex items-center justify-center h-40",children:e.jsx("div",{className:"text-text-secondary text-sm",children:"Loading..."})}):e.jsx("div",{className:"bg-surface-1 rounded-xl border border-border overflow-x-auto",children:e.jsxs("table",{className:"w-full min-w-[900px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx(f,{field:"employee_name",label:"Chatter",onSort:p,current:o,dir:d,className:"w-[200px]"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs text-text-muted font-medium",children:"Team"}),e.jsx(f,{field:"sales",label:"Sales",onSort:p,current:o,dir:d}),e.jsx(f,{field:"fan_cvr",label:"CVR",onSort:p,current:o,dir:d}),e.jsx(f,{field:"golden_ratio",label:"G.Ratio",onSort:p,current:o,dir:d}),e.jsx(f,{field:"unlock_rate",label:"Unlock%",onSort:p,current:o,dir:d}),e.jsx(f,{field:"sales_per_hour",label:"$/hr",onSort:p,current:o,dir:d}),e.jsx(f,{field:"messages_per_hour",label:"Msg/hr",onSort:p,current:o,dir:d}),e.jsx(f,{field:"fans_chatted",label:"Fans",onSort:p,current:o,dir:d}),e.jsx(f,{field:"clocked_hours",label:"Hours",onSort:p,current:o,dir:d}),e.jsx(f,{field:"response_time_clocked",label:"Reply",onSort:p,current:o,dir:d})]})}),e.jsx("tbody",{className:"divide-y divide-border/50",children:H.map((t,s)=>{const r=U===t.employee_name;return e.jsx(te,{stat:t,rank:s+1,isExpanded:r,onToggle:()=>E(r?null:t.employee_name)},`${t.date}-${t.employee_name}`)})})]})})]})}function v({icon:a,label:l,value:x,color:m}){return e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(a,{size:14,className:m}),e.jsx("span",{className:"text-xs text-text-muted",children:l})]}),e.jsx("p",{className:`text-lg font-bold ${m}`,children:x})]})}function f({field:a,label:l,onSort:x,current:m,dir:b,className:N=""}){const g=m===a;return e.jsx("th",{onClick:()=>x(a),className:`px-3 py-3 text-left text-xs font-medium cursor-pointer hover:text-white transition-colors select-none ${g?"text-cw":"text-text-muted"} ${N}`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[l,g?b==="desc"?e.jsx(Y,{size:12}):e.jsx(Z,{size:12}):e.jsx(ee,{size:10,className:"opacity-40"})]})})}function te({stat:a,rank:l,isExpanded:x,onToggle:m}){const b=$[a.team]??{bg:"bg-surface-2",text:"text-text-muted",border:"border-border"};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{onClick:m,className:"hover:bg-surface-2/50 cursor-pointer transition-colors",children:[e.jsx("td",{className:"px-3 py-2.5",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-text-muted w-5 text-right",children:l}),e.jsx("div",{children:e.jsx("p",{className:"text-sm text-white font-medium",children:a.employee_name})})]})}),e.jsx("td",{className:"px-3 py-2.5",children:e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${b.bg} ${b.text} border ${b.border}`,children:a.team?a.team.replace("Team ",""):"-"})}),e.jsx("td",{className:"px-3 py-2.5 text-sm font-medium text-white",children:h(a.sales)}),e.jsxs("td",{className:`px-3 py-2.5 text-sm font-medium ${_("fan_cvr",a.fan_cvr)}`,children:[a.fan_cvr.toFixed(1),"%"]}),e.jsxs("td",{className:`px-3 py-2.5 text-sm font-medium ${_("golden_ratio",a.golden_ratio)}`,children:[a.golden_ratio.toFixed(1),"%"]}),e.jsxs("td",{className:`px-3 py-2.5 text-sm font-medium ${_("unlock_rate",a.unlock_rate)}`,children:[a.unlock_rate.toFixed(0),"%"]}),e.jsx("td",{className:`px-3 py-2.5 text-sm font-medium ${_("sales_per_hour",a.sales_per_hour)}`,children:h(a.sales_per_hour)}),e.jsx("td",{className:`px-3 py-2.5 text-sm font-medium ${_("messages_per_hour",a.messages_per_hour)}`,children:Math.round(a.messages_per_hour)}),e.jsx("td",{className:"px-3 py-2.5 text-sm text-text-secondary",children:a.fans_chatted}),e.jsxs("td",{className:"px-3 py-2.5 text-sm text-text-secondary",children:[a.clocked_hours.toFixed(1),"h"]}),e.jsx("td",{className:"px-3 py-2.5 text-sm text-text-secondary",children:a.response_time_clocked||"-"})]}),x&&e.jsx("tr",{className:"bg-surface-2/30",children:e.jsx("td",{colSpan:11,className:"px-6 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[e.jsx(u,{label:"PPV Sales",value:h(a.ppv_sales)}),e.jsx(u,{label:"Tips",value:h(a.tips)}),e.jsx(u,{label:"DM Sales",value:h(a.dm_sales)}),e.jsx(u,{label:"PPVs Sent",value:String(a.ppvs_sent)}),e.jsx(u,{label:"PPVs Unlocked",value:String(a.ppvs_unlocked)}),e.jsx(u,{label:"Messages Sent",value:String(a.messages_sent)}),e.jsx(u,{label:"Fans Who Spent",value:`${a.fans_who_spent} of ${a.fans_chatted}`}),e.jsx(u,{label:"Avg $/Spender",value:h(a.avg_earnings_per_spender)}),e.jsx(u,{label:"Fans/hr",value:a.fans_per_hour.toFixed(1)}),e.jsx(u,{label:"Characters",value:a.character_count.toLocaleString()}),e.jsx(u,{label:"Mass Msg $",value:h(a.mass_msg_sales)}),e.jsx(u,{label:"Models",value:a.creators||"-",wide:!0})]})})})]})}function u({label:a,value:l,wide:x}){return e.jsxs("div",{className:x?"col-span-1 sm:col-span-2 md:col-span-3 lg:col-span-4":"",children:[e.jsx("p",{className:"text-[11px] text-text-muted mb-0.5",children:a}),e.jsx("p",{className:"text-sm text-white",children:l})]})}function L(a){if(!a||a==="-")return 999999;let l=0;const x=a.match(/(\d+)m/),m=a.match(/(\d+)s/);return x&&(l+=parseInt(x[1])*60),m&&(l+=parseInt(m[1])),l||999999}export{ce as default};
