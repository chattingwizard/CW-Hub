import{r as i,s as p,j as t,z as E}from"./index-CA8Xytnn.js";import{S as D}from"./search-Br0IWICO.js";import{C as w}from"./check-Cvh4XwCA.js";import{X as N}from"./x-B1RhxLkA.js";const d=["owner","admin","chatter_manager","team_leader","script_manager","va","personal_assistant","chatter","recruit"],M={owner:"OWN",admin:"ADM",chatter_manager:"CHM",team_leader:"TL",script_manager:"SM",va:"VA",personal_assistant:"PA",chatter:"CHT",recruit:"REC"},y={owner:"bg-cw",admin:"bg-purple-500",chatter_manager:"bg-blue-500",team_leader:"bg-orange-500",script_manager:"bg-pink-500",va:"bg-indigo-500",personal_assistant:"bg-teal-500",chatter:"bg-green-500",recruit:"bg-yellow-500"},v={company:"Company",role_overview:"Role Overviews",workflow:"Workflows",training:"Training",policy:"Policies",guide:"Guides"};function P(){const[x,m]=i.useState([]),[_,C]=i.useState(!0),[u,S]=i.useState(""),[h,L]=i.useState("all"),[f,o]=i.useState(null),b=i.useCallback(async()=>{const{data:e}=await p.from("documents").select("id, title, category, target_roles, icon, is_published").order("category").order("title");e&&m(e),C(!1)},[]);i.useEffect(()=>{b()},[b]);const g=i.useMemo(()=>{let e=x;if(h!=="all"&&(e=e.filter(s=>s.category===h)),u){const s=u.toLowerCase();e=e.filter(r=>r.title.toLowerCase().includes(s))}return e},[x,h,u]),k=i.useMemo(()=>{const e=new Set(x.map(s=>s.category));return["all",...Array.from(e).sort()]},[x]);async function R(e,s){const r=x.find(l=>l.id===e);if(!r)return;o(e);const a=r.target_roles||[];let n;a.length===0?n=d.filter(l=>l!==s):a.includes(s)?(n=a.filter(l=>l!==s),n.length===0&&(n=[])):(n=[...a,s],n.length===d.length&&(n=[])),await p.from("documents").update({target_roles:n}).eq("id",e),m(l=>l.map(c=>c.id===e?{...c,target_roles:n}:c)),o(null)}function A(e){o(e),p.from("documents").update({target_roles:[]}).eq("id",e).then(()=>{m(s=>s.map(r=>r.id===e?{...r,target_roles:[]}:r)),o(null)})}function O(e,s){o(e),p.from("documents").update({target_roles:s}).eq("id",e).then(()=>{m(r=>r.map(a=>a.id===e?{...a,target_roles:s}:a)),o(null)})}function z(e,s){return!e.target_roles||e.target_roles.length===0?!0:e.target_roles.includes(s)}return _?t.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:t.jsx("div",{className:"w-4 h-4 border-2 border-cw/30 border-t-cw rounded-full animate-spin"})}):t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{children:[t.jsxs("h1",{className:"text-xl font-extrabold text-white flex items-center gap-2",children:[t.jsx(E,{size:20,className:"text-cw"})," Document Permissions"]}),t.jsx("p",{className:"text-sm text-text-secondary mt-0.5",children:"Control which roles can see each document. Empty = visible to everyone."})]})}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"relative flex-1 max-w-xs",children:[t.jsx(D,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),t.jsx("input",{value:u,onChange:e=>S(e.target.value),placeholder:"Search documents...",className:"w-full bg-surface-2 border border-border rounded-lg pl-9 pr-3 py-2 text-sm text-white placeholder:text-text-muted outline-none focus:border-cw/50"})]}),t.jsxs("select",{value:h,onChange:e=>L(e.target.value),className:"bg-surface-2 border border-border rounded-lg px-3 py-2 text-xs text-white outline-none",children:[t.jsx("option",{value:"all",children:"All Categories"}),k.filter(e=>e!=="all").map(e=>t.jsx("option",{value:e,children:v[e]||e},e))]})]}),t.jsxs("div",{className:"flex items-center gap-4 text-xs text-text-muted",children:[t.jsxs("span",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"w-5 h-5 rounded bg-cw/20 border border-cw/40 flex items-center justify-center",children:t.jsx(w,{size:10,className:"text-cw"})}),"Can view"]}),t.jsxs("span",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"w-5 h-5 rounded bg-surface-2 border border-border flex items-center justify-center",children:t.jsx(N,{size:10,className:"text-text-muted/30"})}),"No access"]}),t.jsxs("span",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"px-1.5 py-0.5 bg-green-500/15 text-green-400 rounded text-xs",children:"ALL"}),"Visible to everyone"]})]}),t.jsx("div",{className:"overflow-x-auto border border-border rounded-xl",children:t.jsxs("table",{className:"w-full text-sm",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-surface-2",children:[t.jsx("th",{className:"text-left text-xs font-semibold text-text-muted px-4 py-3 min-w-[280px] sticky left-0 bg-surface-2 z-10",children:"Document"}),d.map(e=>t.jsx("th",{className:"text-center px-1 py-3 min-w-[50px]",children:t.jsx("div",{className:`inline-flex items-center justify-center w-8 h-8 rounded-lg ${y[e]}/20`,children:t.jsx("span",{className:`text-xs font-bold ${y[e].replace("bg-","text-")}`,children:M[e]})})},e)),t.jsx("th",{className:"text-center px-3 py-3 min-w-[60px]",children:t.jsx("span",{className:"text-xs text-text-muted",children:"Quick"})})]})}),t.jsx("tbody",{children:g.map((e,s)=>{var l;const r=!e.target_roles||e.target_roles.length===0,a=s>0?(l=g[s-1])==null?void 0:l.category:null;return[e.category!==a&&t.jsx("tr",{children:t.jsx("td",{colSpan:d.length+2,className:"bg-surface-1 px-4 py-2",children:t.jsx("span",{className:"text-xs font-bold text-cw uppercase tracking-wider",children:v[e.category]||e.category})})},`cat-${e.category}`),t.jsxs("tr",{className:`border-b border-border/30 hover:bg-surface-2/50 transition-colors ${f===e.id?"opacity-60":""}`,children:[t.jsx("td",{className:"px-4 py-2.5 sticky left-0 bg-surface-1 z-10",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-base",children:e.icon}),t.jsx("span",{className:"text-xs font-medium text-white truncate max-w-[220px]",title:e.title,children:e.title}),r&&t.jsx("span",{className:"px-1.5 py-0.5 bg-green-500/15 text-green-400 rounded text-xs shrink-0",children:"ALL"})]})}),d.map(c=>{const j=z(e,c);return t.jsx("td",{className:"text-center px-1 py-2.5",children:t.jsx("button",{onClick:()=>R(e.id,c),disabled:f===e.id,className:`w-7 h-7 rounded-md border transition-all ${j?"bg-cw/15 border-cw/40 hover:bg-cw/25":"bg-surface-2 border-border/50 hover:border-border"}`,children:j?t.jsx(w,{size:12,className:"text-cw mx-auto"}):t.jsx(N,{size:10,className:"text-text-muted/20 mx-auto"})})},c)}),t.jsx("td",{className:"text-center px-3 py-2.5",children:r?t.jsx("button",{onClick:()=>O(e.id,["owner"]),className:"text-xs text-text-muted hover:text-yellow-400 transition-colors",title:"Restrict to owner only",children:"üîí"}):t.jsx("button",{onClick:()=>A(e.id),className:"text-xs text-text-muted hover:text-green-400 transition-colors",title:"Make visible to all",children:"üåç"})})]},e.id)]})})]})}),g.length===0&&t.jsx("div",{className:"text-center py-12 text-text-muted",children:t.jsx("p",{className:"text-sm",children:"No documents match your search"})})]})}export{P as default};
