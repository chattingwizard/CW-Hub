import{c as de,u as Z,r as a,s as _,j as e,y as ue,t as he,T as be,H as fe}from"./index-CA8Xytnn.js";import{g as oe,i as ge,w as je,e as ce,d as ye,f as ie,h as J,b as Ne,c as ve,a as _e,j as we}from"./scoreUtils-_9d8pvRV.js";import{P as V}from"./plus-SHQmX2wS.js";import{C as xe}from"./clock-D7zdhlm9.js";import{T as Q,P as ke}from"./trash-2-DGQNzRo3.js";import{C as Se}from"./check-Cvh4XwCA.js";import{X as me}from"./x-B1RhxLkA.js";import{S as Ce}from"./save-Dg1p4q3x.js";import{T as Te}from"./trending-up-DzPvdVSv.js";import{T as $e}from"./trending-down-CbLCgBVi.js";import{M as Ee}from"./minus-jQmmtfBl.js";import{C as ze}from"./chevron-right-DnX9SIfG.js";import{D as Pe}from"./dollar-sign-CGtoqXjG.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=de("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=de("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);function Be({weekKey:n,eventTypes:x,chatters:p}){const{profile:b}=Z(),[f,u]=a.useState(""),[w,l]=a.useState(new Date().toISOString().slice(0,10)),[o,g]=a.useState(null),[j,y]=a.useState(0),[d,h]=a.useState(""),[I,z]=a.useState(!1),[P,v]=a.useState([]),[q,k]=a.useState(!0),O=x.filter(s=>s.category==="positive"&&s.is_active),A=x.filter(s=>s.category==="negative"&&s.is_active),B=x.find(s=>s.category==="custom"&&s.is_active),S=o?o.category==="custom"?j:o.points:0;a.useEffect(()=>{C()},[n]);async function C(){k(!0);const{data:s}=await _.from("score_events").select("*, chatter:chatters(*), event_type:score_event_types(*)").eq("week",n).order("created_at",{ascending:!1}).limit(20);v(s||[]),k(!1)}async function R(){if(!(!f||!o||!b)){z(!0);try{const s=o.category==="custom"?j:o.points,N=oe(new Date(w)),{error:$}=await _.from("score_events").insert({chatter_id:f,submitted_by:b.id,date:w,event_type_id:o.id,points:s,custom_points:o.category==="custom"?j:null,notes:d||null,week:N});if($)throw $;u(""),g(null),y(0),h(""),C()}catch(s){console.error("Error logging event:",s)}finally{z(!1)}}}async function L(s){const{error:N}=await _.from("score_events").delete().eq("id",s);N||C()}return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-surface-1 rounded-xl border border-border p-5",children:[e.jsx("h3",{className:"text-sm font-semibold text-text-primary mb-4",children:"Log Score Event"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block",children:"Chatter"}),e.jsxs("select",{value:f,onChange:s=>u(s.target.value),className:"w-full bg-surface-2 border border-border rounded-lg px-3 py-2 text-sm text-text-primary",children:[e.jsx("option",{value:"",children:"Select chatter..."}),p.map(s=>e.jsxs("option",{value:s.id,children:[s.full_name," ",s.team_name?`(${s.team_name})`:""]},s.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block",children:"Date"}),e.jsx("input",{type:"date",value:w,onChange:s=>l(s.target.value),className:"w-full bg-surface-2 border border-border rounded-lg px-3 py-2 text-sm text-text-primary"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block",children:"Event Type"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-emerald-400/70 mb-1.5",children:"Positive"}),e.jsx("div",{className:"space-y-1",children:O.map(s=>e.jsxs("button",{onClick:()=>g(s),className:`w-full text-left px-3 py-2 rounded-lg text-xs font-medium transition-all border ${(o==null?void 0:o.id)===s.id?"bg-emerald-500/15 text-emerald-400 border-emerald-500/30":"bg-surface-2 text-text-secondary border-border hover:border-emerald-500/20"}`,children:[e.jsx("span",{children:s.name}),e.jsxs("span",{className:"float-right text-emerald-400",children:["+",s.points]})]},s.id))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-red-400/70 mb-1.5",children:"Negative"}),e.jsx("div",{className:"space-y-1",children:A.map(s=>e.jsxs("button",{onClick:()=>g(s),className:`w-full text-left px-3 py-2 rounded-lg text-xs font-medium transition-all border ${(o==null?void 0:o.id)===s.id?"bg-red-500/15 text-red-400 border-red-500/30":"bg-surface-2 text-text-secondary border-border hover:border-red-500/20"}`,children:[e.jsx("span",{children:s.name}),e.jsx("span",{className:"float-right text-red-400",children:s.points})]},s.id))})]})]}),B&&e.jsx("button",{onClick:()=>g(B),className:`w-full mt-2 text-left px-3 py-2 rounded-lg text-xs font-medium transition-all border ${(o==null?void 0:o.id)===B.id?"bg-cw/15 text-cw border-cw/30":"bg-surface-2 text-text-secondary border-border hover:border-cw/20"}`,children:"Others (Custom Points)"})]}),(o==null?void 0:o.category)==="custom"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block",children:"Custom Points"}),e.jsx("input",{type:"number",value:j,onChange:s=>y(parseInt(s.target.value)||0),className:"w-full bg-surface-2 border border-border rounded-lg px-3 py-2 text-sm text-text-primary",placeholder:"Enter points (negative or positive)"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block",children:"Notes (optional)"}),e.jsx("textarea",{value:d,onChange:s=>h(s.target.value),rows:2,className:"w-full bg-surface-2 border border-border rounded-lg px-3 py-2 text-sm text-text-primary resize-none",placeholder:"Add context..."})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-text-muted",children:"Points: "}),e.jsxs("span",{className:`font-bold ${S>0?"text-emerald-400":S<0?"text-red-400":"text-text-secondary"}`,children:[S>0?"+":"",S]})]}),e.jsxs("button",{onClick:R,disabled:!f||!o||I,className:"flex items-center gap-1.5 px-4 py-2 rounded-lg bg-cw text-white text-sm font-medium hover:bg-cw/90 disabled:opacity-40 disabled:cursor-not-allowed transition-all",children:[e.jsx(V,{size:14}),I?"Logging...":"Log Event"]})]})]}),e.jsxs("div",{className:"bg-surface-1 rounded-xl border border-border p-5",children:[e.jsxs("h3",{className:"text-sm font-semibold text-text-primary mb-4 flex items-center gap-2",children:[e.jsx(xe,{size:14,className:"text-text-muted"}),"Recent Events This Week"]}),q?e.jsx("div",{className:"text-sm text-text-muted text-center py-8",children:"Loading..."}):P.length===0?e.jsx("div",{className:"text-sm text-text-muted text-center py-8",children:"No events logged this week"}):e.jsx("div",{className:"space-y-2 max-h-[500px] overflow-y-auto",children:P.map(s=>{var N,$;return e.jsxs("div",{className:"flex items-center gap-3 px-3 py-2.5 rounded-lg bg-surface-2 border border-border",children:[e.jsxs("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center text-xs font-bold shrink-0 ${s.points>0?"bg-emerald-500/15 text-emerald-400":s.points<0?"bg-red-500/15 text-red-400":"bg-zinc-500/15 text-zinc-400"}`,children:[s.points>0?"+":"",s.points]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-text-primary truncate",children:((N=s.chatter)==null?void 0:N.full_name)??"Unknown"}),e.jsxs("p",{className:"text-[10px] text-text-muted truncate",children:[(($=s.event_type)==null?void 0:$.name)??"Event"," · ",s.date,s.notes?` · ${s.notes}`:""]})]}),e.jsx("button",{onClick:()=>L(s.id),className:"p-1 rounded hover:bg-red-500/10 text-text-muted hover:text-red-400 transition-colors shrink-0",title:"Delete",children:e.jsx(Q,{size:13})})]},s.id)})})]})]})}const Le=["Team Huckle","Team Danilyn","Team Ezekiel"],De={"Team Huckle":"border-orange-500/30","Team Danilyn":"border-blue-500/30","Team Ezekiel":"border-purple-500/30"},Ie=["00:00-00:59","01:00-01:29","01:30-01:59","02:00-02:59","03:00-03:29","03:30-03:59","04:00+"];function Re({weekKey:n,chatters:x,config:p,onDataChange:b}){const{profile:f}=Z(),[u,w]=a.useState([]),[l,o]=a.useState(!0),[g,j]=a.useState(!1),[y,d]=a.useState(null),[h,I]=a.useState(null),[z,P]=a.useState(""),[v,q]=a.useState(!1),[k,O]=a.useState(!1),[A,B]=a.useState(""),[S,C]=a.useState(!1);a.useEffect(()=>{R()},[n]);async function R(){o(!0);const{data:c}=await _.from("score_weekly_reports").select("*").eq("week",n);w(c||[]),o(!1)}function L(c,i){d(c),I(i||null),P((i==null?void 0:i.reply_time_bucket)||""),q((i==null?void 0:i.no_shift_incidence)||!1),O((i==null?void 0:i.all_reports_sent)||!1),B((i==null?void 0:i.notes)||""),j(!0)}function s(){j(!1),d(null),I(null)}const N=ge({reply_time_bucket:z,no_shift_incidence:v,all_reports_sent:k},p);async function $(){if(!(!y||!f)){C(!0);try{const i=je(n).toISOString().slice(0,10),E={chatter_id:y.id,submitted_by:f.id,week_start:i,week:n,reply_time_bucket:z||null,no_shift_incidence:v,all_reports_sent:k,weekly_points:N,notes:A||null};h?await _.from("score_weekly_reports").update(E).eq("id",h.id):await _.from("score_weekly_reports").insert(E),s(),R(),b()}catch(c){console.error("Error submitting weekly report:",c)}finally{C(!1)}}}return l?e.jsx("div",{className:"text-sm text-text-muted text-center py-12",children:"Loading weekly reports..."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Le.map(c=>{const i=x.filter(W=>W.team_name===c),E=De[c]||"border-border";return e.jsxs("div",{className:`bg-surface-1 rounded-xl border-2 ${E} p-4`,children:[e.jsxs("h3",{className:"text-sm font-semibold text-text-primary mb-3",children:[c,e.jsxs("span",{className:"text-text-muted font-normal ml-1.5 text-xs",children:["(",i.length,")"]})]}),i.length===0?e.jsx("p",{className:"text-xs text-text-muted py-4 text-center",children:"No chatters"}):e.jsx("div",{className:"space-y-1.5",children:i.map(W=>{const r=u.find(t=>t.chatter_id===W.id),T=!!r;return e.jsxs("div",{className:"flex items-center gap-2.5 px-3 py-2 rounded-lg bg-surface-2 border border-border",children:[e.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center shrink-0 ${T?"bg-emerald-500/20":"bg-zinc-500/20"}`,children:T?e.jsx(Se,{size:11,className:"text-emerald-400"}):e.jsx(xe,{size:11,className:"text-zinc-500"})}),e.jsx("span",{className:"text-xs text-text-primary flex-1 truncate",children:W.full_name}),T&&e.jsxs("span",{className:"text-[10px] font-bold text-emerald-400",children:["+",r.weekly_points]}),e.jsx("button",{onClick:()=>L(W,r),className:`text-[10px] px-2 py-1 rounded-md font-medium transition-all ${T?"bg-surface-3 text-text-muted hover:text-cw":"bg-cw/10 text-cw hover:bg-cw/20"}`,children:T?e.jsx(ke,{size:11}):"Submit"})]},W.id)})})]},c)})}),g&&y&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:s}),e.jsxs("div",{className:"relative bg-surface-1 border border-border rounded-xl w-full max-w-md mx-4 p-5 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-text-primary",children:[h?"Edit":"Submit"," Weekly Report"]}),e.jsx("p",{className:"text-xs text-text-muted",children:y.full_name})]}),e.jsx("button",{onClick:s,className:"p-1.5 rounded-lg hover:bg-surface-2 text-text-muted",children:e.jsx(me,{size:16})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs text-text-muted mb-2 block",children:"Average Reply Time"}),e.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:Ie.map(c=>{var E;const i=((E=p.reply_time_points)==null?void 0:E[c])??0;return e.jsxs("button",{onClick:()=>P(c),className:`px-3 py-2 rounded-lg text-xs font-medium border transition-all ${z===c?i>=0?"bg-emerald-500/15 text-emerald-400 border-emerald-500/30":"bg-red-500/15 text-red-400 border-red-500/30":"bg-surface-2 text-text-secondary border-border hover:border-text-muted/30"}`,children:[e.jsx("span",{children:c}),e.jsxs("span",{className:`ml-1.5 ${i>=0?"text-emerald-400":"text-red-400"}`,children:[i>0?"+":"",i]})]},c)})})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("label",{className:"flex items-center gap-2.5 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:v,onChange:c=>q(c.target.checked),className:"w-4 h-4 rounded border-border bg-surface-2 text-cw accent-cw"}),e.jsx("span",{className:"text-xs text-text-primary",children:"No shift incidence"}),e.jsxs("span",{className:"text-xs text-emerald-400 ml-auto",children:["+",p.no_shift_incidence_pts]})]}),e.jsxs("label",{className:"flex items-center gap-2.5 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:c=>O(c.target.checked),className:"w-4 h-4 rounded border-border bg-surface-2 text-cw accent-cw"}),e.jsx("span",{className:"text-xs text-text-primary",children:"All reports sent on time"}),e.jsxs("span",{className:"text-xs text-emerald-400 ml-auto",children:["+",p.all_reports_sent_pts]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block",children:"Notes (optional)"}),e.jsx("textarea",{value:A,onChange:c=>B(c.target.value),rows:2,className:"w-full bg-surface-2 border border-border rounded-lg px-3 py-2 text-sm text-text-primary resize-none"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-border",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-text-muted",children:"Weekly Bonus: "}),e.jsxs("span",{className:`font-bold ${N>0?"text-emerald-400":"text-text-secondary"}`,children:["+",N," pts"]})]}),e.jsx("button",{onClick:$,disabled:S,className:"px-4 py-2 rounded-lg bg-cw text-white text-sm font-medium hover:bg-cw/90 disabled:opacity-40 transition-all",children:S?"Saving...":h?"Update":"Submit"})]})]})]})]})}const We=[{key:"00:00-00:59",label:"< 1 min"},{key:"01:00-01:29",label:"1:00 – 1:29"},{key:"01:30-01:59",label:"1:30 – 1:59"},{key:"02:00-02:59",label:"2:00 – 2:59"},{key:"03:00-03:29",label:"3:00 – 3:29"},{key:"03:30-03:59",label:"3:30 – 3:59"},{key:"04:00+",label:"4:00+"}];function Me({config:n,eventTypes:x,onSave:p}){const{profile:b}=Z(),[f,u]=a.useState(!1),[w,l]=a.useState([]),[o,g]=a.useState({}),[j,y]=a.useState(n.no_shift_incidence_pts),[d,h]=a.useState(n.all_reports_sent_pts),[I,z]=a.useState(n.base_score),[P,v]=a.useState(n.tier_20_threshold),[q,k]=a.useState(n.tier_10_threshold),[O,A]=a.useState(n.tier_5_threshold),[B,S]=a.useState(n.warning_threshold),[C,R]=a.useState(n.tier_20_amount),[L,s]=a.useState(n.tier_10_amount),[N,$]=a.useState(n.tier_5_amount);a.useEffect(()=>{l(x.map(t=>({...t}))),g({...n.reply_time_points||{}}),y(n.no_shift_incidence_pts),h(n.all_reports_sent_pts),z(n.base_score),v(n.tier_20_threshold),k(n.tier_10_threshold),A(n.tier_5_threshold),S(n.warning_threshold),R(n.tier_20_amount),s(n.tier_10_amount),$(n.tier_5_amount)},[n,x]);function c(t,m,D){l(M=>M.map(H=>H.id===t?{...H,[m]:D}:H))}function i(t){l(m=>m.map(D=>D.id===t?{...D,_deleted:!D._deleted,is_active:!!D._deleted}:D))}function E(t){l(m=>[...m,{id:`new-${Date.now()}`,name:"",points:t==="positive"?5:-5,category:t,is_active:!0,sort_order:m.length,created_at:new Date().toISOString(),_new:!0}])}async function W(){if(b){u(!0);try{await _.from("score_config").update({base_score:I,reply_time_points:o,no_shift_incidence_pts:j,all_reports_sent_pts:d,tier_20_threshold:P,tier_10_threshold:q,tier_5_threshold:O,warning_threshold:B,tier_20_amount:C,tier_10_amount:L,tier_5_amount:N,updated_by:b.id,updated_at:new Date().toISOString()}).eq("id",1);for(const t of w)t._new&&t.name?await _.from("score_event_types").insert({name:t.name,points:t.points,category:t.category,is_active:t.is_active,sort_order:t.sort_order}):t._new||await _.from("score_event_types").update({name:t.name,points:t.points,is_active:t.is_active,sort_order:t.sort_order}).eq("id",t.id);p()}catch(t){console.error("Error saving config:",t)}finally{u(!1)}}}const r=w.filter(t=>t.category==="positive"),T=w.filter(t=>t.category==="negative");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-surface-1 rounded-xl border border-border p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-xs font-bold uppercase tracking-wider text-emerald-400",children:"Positive Events"}),e.jsxs("button",{onClick:()=>E("positive"),className:"text-[10px] px-2 py-1 rounded-md bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500/20 transition-colors",children:[e.jsx(V,{size:10,className:"inline mr-0.5"})," Add"]})]}),e.jsx("div",{className:"space-y-1.5",children:r.map(t=>e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg border border-border ${t._deleted?"opacity-40 bg-surface-2 line-through":"bg-surface-2"}`,children:[e.jsx("input",{value:t.name,onChange:m=>c(t.id,"name",m.target.value),className:"flex-1 bg-transparent text-xs text-text-primary outline-none",placeholder:"Event name..."}),e.jsx("input",{type:"number",value:t.points,onChange:m=>c(t.id,"points",parseInt(m.target.value)||0),className:"w-14 bg-surface-3 border border-border rounded px-2 py-1 text-xs text-emerald-400 text-center"}),e.jsx("button",{onClick:()=>i(t.id),className:"p-1 hover:bg-red-500/10 rounded text-text-muted hover:text-red-400 transition-colors",children:t._deleted?e.jsx(le,{size:12}):e.jsx(Q,{size:12})})]},t.id))})]}),e.jsxs("div",{className:"bg-surface-1 rounded-xl border border-border p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-xs font-bold uppercase tracking-wider text-red-400",children:"Negative Events"}),e.jsxs("button",{onClick:()=>E("negative"),className:"text-[10px] px-2 py-1 rounded-md bg-red-500/10 text-red-400 hover:bg-red-500/20 transition-colors",children:[e.jsx(V,{size:10,className:"inline mr-0.5"})," Add"]})]}),e.jsx("div",{className:"space-y-1.5",children:T.map(t=>e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg border border-border ${t._deleted?"opacity-40 bg-surface-2 line-through":"bg-surface-2"}`,children:[e.jsx("input",{value:t.name,onChange:m=>c(t.id,"name",m.target.value),className:"flex-1 bg-transparent text-xs text-text-primary outline-none",placeholder:"Event name..."}),e.jsx("input",{type:"number",value:t.points,onChange:m=>c(t.id,"points",parseInt(m.target.value)||0),className:"w-14 bg-surface-3 border border-border rounded px-2 py-1 text-xs text-red-400 text-center"}),e.jsx("button",{onClick:()=>i(t.id),className:"p-1 hover:bg-red-500/10 rounded text-text-muted hover:text-red-400 transition-colors",children:t._deleted?e.jsx(le,{size:12}):e.jsx(Q,{size:12})})]},t.id))})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-surface-1 rounded-xl border border-border p-4",children:[e.jsx("h4",{className:"text-xs font-bold uppercase tracking-wider text-text-muted mb-3",children:"Base Score"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"number",value:I,onChange:t=>z(parseInt(t.target.value)||100),className:"w-24 bg-surface-2 border border-border rounded-lg px-3 py-2 text-sm text-text-primary text-center"}),e.jsx("span",{className:"text-xs text-text-muted",children:"points per week (resets Monday)"})]})]}),e.jsxs("div",{className:"bg-surface-1 rounded-xl border border-border p-4",children:[e.jsx("h4",{className:"text-xs font-bold uppercase tracking-wider text-text-muted mb-3",children:"Reply Time Points"}),e.jsx("div",{className:"space-y-1.5",children:We.map(({key:t,label:m})=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-surface-2",children:[e.jsx("span",{className:"text-xs text-text-secondary flex-1",children:m}),e.jsx("input",{type:"number",value:o[t]??0,onChange:D=>g(M=>({...M,[t]:parseInt(D.target.value)||0})),className:"w-16 bg-surface-3 border border-border rounded px-2 py-1 text-xs text-center text-text-primary"})]},t))})]}),e.jsxs("div",{className:"bg-surface-1 rounded-xl border border-border p-4",children:[e.jsx("h4",{className:"text-xs font-bold uppercase tracking-wider text-text-muted mb-3",children:"Weekly Checkbox Bonuses"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-text-secondary flex-1",children:"No shift incidence"}),e.jsx("input",{type:"number",value:j,onChange:t=>y(parseInt(t.target.value)||0),className:"w-16 bg-surface-2 border border-border rounded px-2 py-1 text-xs text-center text-text-primary"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-text-secondary flex-1",children:"All reports sent"}),e.jsx("input",{type:"number",value:d,onChange:t=>h(parseInt(t.target.value)||0),className:"w-16 bg-surface-2 border border-border rounded px-2 py-1 text-xs text-center text-text-primary"})]})]})]}),e.jsxs("div",{className:"bg-surface-1 rounded-xl border border-border p-4",children:[e.jsx("h4",{className:"text-xs font-bold uppercase tracking-wider text-text-muted mb-3",children:"Bonus Tiers"}),e.jsxs("div",{className:"space-y-2",children:[[{label:"$20 Bonus",threshold:P,setThreshold:v,amount:C,setAmount:R,color:"text-emerald-400"},{label:"$10 Bonus",threshold:q,setThreshold:k,amount:L,setAmount:s,color:"text-blue-400"},{label:"$5 Bonus",threshold:O,setThreshold:A,amount:N,setAmount:$,color:"text-cyan-400"}].map(t=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-surface-2",children:[e.jsx("span",{className:`text-xs font-medium w-20 ${t.color}`,children:t.label}),e.jsx("span",{className:"text-[10px] text-text-muted",children:"≥"}),e.jsx("input",{type:"number",value:t.threshold,onChange:m=>t.setThreshold(parseInt(m.target.value)||0),className:"w-16 bg-surface-3 border border-border rounded px-2 py-1 text-xs text-center text-text-primary"}),e.jsx("span",{className:"text-[10px] text-text-muted",children:"pts"}),e.jsx("span",{className:"text-[10px] text-text-muted ml-auto",children:"$"}),e.jsx("input",{type:"number",value:t.amount,onChange:m=>t.setAmount(parseFloat(m.target.value)||0),className:"w-14 bg-surface-3 border border-border rounded px-2 py-1 text-xs text-center text-text-primary"})]},t.label)),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-surface-2",children:[e.jsx("span",{className:"text-xs font-medium w-20 text-red-400",children:"Warning"}),e.jsx("span",{className:"text-[10px] text-text-muted",children:"<"}),e.jsx("input",{type:"number",value:B,onChange:t=>S(parseInt(t.target.value)||0),className:"w-16 bg-surface-3 border border-border rounded px-2 py-1 text-xs text-center text-text-primary"}),e.jsx("span",{className:"text-[10px] text-text-muted",children:"pts"})]})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:W,disabled:f,className:"flex items-center gap-2 px-5 py-2.5 rounded-lg bg-cw text-white text-sm font-medium hover:bg-cw/90 disabled:opacity-40 transition-all",children:[e.jsx(Ce,{size:14}),f?"Saving...":"Save Configuration"]})})]})}function qe({chatterId:n,weekKey:x,config:p,scores:b,events:f,onClose:u,onLogEvent:w}){const l=b.find(d=>d.chatter_id===n);if(!l)return null;const o=ce(l.status),g=ye(l.total,p),j=f.filter(d=>d.chatter_id===n).sort((d,h)=>new Date(h.created_at).getTime()-new Date(d.created_at).getTime()),y=[{label:"$5",threshold:p.tier_5_threshold,color:"bg-cyan-400"},{label:"$10",threshold:p.tier_10_threshold,color:"bg-blue-400"},{label:"$20",threshold:p.tier_20_threshold,color:"bg-emerald-400"}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50",onClick:u}),e.jsxs("div",{className:"fixed top-0 right-0 h-full w-full max-w-[420px] bg-surface-1 border-l border-border z-50 flex flex-col animate-slide-in-right shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-cw/15 flex items-center justify-center ring-1 ring-cw/20",children:e.jsx("span",{className:"text-cw text-sm font-bold",children:l.chatter_name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-text-primary",children:l.chatter_name}),e.jsxs("p",{className:"text-[10px] text-text-muted",children:[l.team_name??"No team"," · ",ie(x)]})]})]}),e.jsx("button",{onClick:u,className:"p-1.5 rounded-lg hover:bg-surface-2 text-text-muted",children:e.jsx(me,{size:16})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-5",children:[e.jsxs("div",{className:"text-center py-3",children:[e.jsx("div",{className:`text-5xl font-extrabold ${J(l.total,p)}`,children:l.total}),e.jsx("div",{className:"mt-1.5",children:e.jsx("span",{className:`text-[10px] px-2.5 py-1 rounded-full font-bold border ${o.colorClass}`,children:o.label})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative h-3 bg-surface-3 rounded-full overflow-hidden",children:[e.jsx("div",{className:`absolute left-0 top-0 h-full rounded-full transition-all ${l.status==="warning"?"bg-red-500":l.status==="no_bonus"?"bg-zinc-500":l.status==="bonus_5"?"bg-cyan-400":l.status==="bonus_10"?"bg-blue-400":"bg-emerald-400"}`,style:{width:`${g}%`}}),y.map(d=>{const h=d.threshold/(p.tier_20_threshold+10)*100;return e.jsx("div",{className:"absolute top-0 h-full w-px bg-white/20",style:{left:`${h}%`}},d.label)})]}),e.jsxs("div",{className:"flex justify-between text-[9px] text-text-muted",children:[e.jsx("span",{children:"0"}),y.map(d=>e.jsxs("span",{children:[d.threshold," (",d.label,")"]},d.label))]})]}),e.jsxs("div",{className:"bg-surface-2 rounded-xl border border-border p-3 space-y-2",children:[e.jsx("h4",{className:"text-[10px] font-bold uppercase tracking-wider text-text-muted",children:"Breakdown"}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-text-secondary",children:"Base Score"}),e.jsx("span",{className:"font-medium text-text-primary",children:l.base_score})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-text-secondary",children:"Event Points"}),e.jsxs("span",{className:`font-medium ${l.event_points>0?"text-emerald-400":l.event_points<0?"text-red-400":"text-text-muted"}`,children:[l.event_points>0?"+":"",l.event_points]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-text-secondary",children:"Weekly Report"}),e.jsxs("span",{className:`font-medium ${l.weekly_report_points>0?"text-emerald-400":"text-text-muted"}`,children:[l.weekly_report_points>0?"+":"",l.weekly_report_points]})]}),e.jsxs("div",{className:"border-t border-border pt-2 flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-semibold text-text-primary",children:"Total"}),e.jsx("span",{className:`font-bold ${J(l.total,p)}`,children:l.total})]})]}),l.weekly_report&&e.jsxs("div",{className:"bg-surface-2 rounded-xl border border-border p-3",children:[e.jsx("h4",{className:"text-[10px] font-bold uppercase tracking-wider text-text-muted mb-2",children:"Weekly Report"}),e.jsxs("div",{className:"space-y-1.5 text-xs",children:[l.weekly_report.reply_time_bucket&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-secondary",children:"Reply Time"}),e.jsx("span",{className:"text-text-primary font-medium",children:l.weekly_report.reply_time_bucket})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-secondary",children:"No Shift Incidence"}),e.jsx("span",{className:l.weekly_report.no_shift_incidence?"text-emerald-400":"text-text-muted",children:l.weekly_report.no_shift_incidence?"Yes":"No"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-secondary",children:"All Reports Sent"}),e.jsx("span",{className:l.weekly_report.all_reports_sent?"text-emerald-400":"text-text-muted",children:l.weekly_report.all_reports_sent?"Yes":"No"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-[10px] font-bold uppercase tracking-wider text-text-muted mb-2",children:"Event History"}),j.length===0?e.jsx("p",{className:"text-xs text-text-muted py-3 text-center",children:"No events this week"}):e.jsx("div",{className:"space-y-1.5",children:j.map(d=>{var h;return e.jsxs("div",{className:"flex items-center gap-2.5 px-3 py-2 rounded-lg bg-surface-2 border border-border",children:[e.jsx("div",{className:`w-6 h-6 rounded flex items-center justify-center shrink-0 ${d.points>0?"bg-emerald-500/15":d.points<0?"bg-red-500/15":"bg-zinc-500/15"}`,children:d.points>0?e.jsx(Te,{size:11,className:"text-emerald-400"}):d.points<0?e.jsx($e,{size:11,className:"text-red-400"}):e.jsx(Ee,{size:11,className:"text-zinc-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[11px] font-medium text-text-primary truncate",children:((h=d.event_type)==null?void 0:h.name)??"Event"}),e.jsxs("p",{className:"text-[9px] text-text-muted",children:[d.date,d.notes?` · ${d.notes}`:""]})]}),e.jsxs("span",{className:`text-xs font-bold shrink-0 ${d.points>0?"text-emerald-400":d.points<0?"text-red-400":"text-text-muted"}`,children:[d.points>0?"+":"",d.points]})]},d.id)})})]})]}),e.jsx("div",{className:"border-t border-border p-4 shrink-0 flex gap-2",children:e.jsxs("button",{onClick:w,className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-2.5 rounded-lg bg-cw text-white text-xs font-medium hover:bg-cw/90 transition-all",children:[e.jsx(V,{size:13}),"Add Event"]})})]})]})}function tt(){const{profile:n}=Z(),[x,p]=a.useState(()=>oe(new Date)),[b,f]=a.useState("leaderboard"),[u,w]=a.useState(null),[l,o]=a.useState([]),[g,j]=a.useState([]),[y,d]=a.useState([]),[h,I]=a.useState([]),[z,P]=a.useState(!0),[v,q]=a.useState([]),[k,O]=a.useState("all"),[A,B]=a.useState("all"),[S,C]=a.useState(null),R=(n==null?void 0:n.role)==="owner"||(n==null?void 0:n.role)==="admin",L=a.useCallback(async()=>{P(!0);const[r,T,t,m,D]=await Promise.all([_.from("score_config").select("*").eq("id",1).single(),_.from("score_event_types").select("*").order("sort_order"),_.from("chatters").select("*").eq("status","Active").eq("airtable_role","Chatter").order("full_name"),_.from("score_events").select("*, event_type:score_event_types(*)").eq("week",x),_.from("score_weekly_reports").select("*").eq("week",x)]),M=r.data,H=T.data||[],ee=t.data||[],te=m.data||[],se=D.data||[];if(w(M),o(H),j(ee),d(te),I(se),M){const re=ee.map(F=>{const Y=te.filter(U=>U.chatter_id===F.id),ae=Y.reduce((U,pe)=>U+pe.points,0),K=se.find(U=>U.chatter_id===F.id)||null,ne=(K==null?void 0:K.weekly_points)??0,G=M.base_score+ae+ne;return{chatter_id:F.id,chatter_name:F.full_name,team_name:F.team_name,base_score:M.base_score,event_points:ae,weekly_report_points:ne,total:G,status:ve(G,M),bonus_amount:Ne(G,M),events:Y,weekly_report:K}});re.sort((F,Y)=>Y.total-F.total),q(re)}P(!1)},[x]);a.useEffect(()=>{L()},[L]);const s=v.filter(r=>!(k!=="all"&&r.team_name!==k||A!=="all"&&r.status!==A)),N=v.filter(r=>r.bonus_amount>0).length,$=v.filter(r=>r.status==="warning").length,c=g.length-h.length,i=v.reduce((r,T)=>r+T.bonus_amount,0),E=[...new Set(g.map(r=>r.team_name).filter(Boolean))],W=[{id:"leaderboard",label:"Leaderboard"},{id:"log-event",label:"Log Event"},{id:"weekly-reports",label:"Weekly Reports"},{id:"config",label:"Score Config",adminOnly:!0}];return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-xl bg-amber-500/15 flex items-center justify-center",children:e.jsx(ue,{size:18,className:"text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-text-primary",children:"Chatter Score"}),e.jsx("p",{className:"text-xs text-text-muted",children:"Track performance points & weekly bonuses"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-surface-1 border border-border rounded-lg px-1 py-1",children:[e.jsx("button",{onClick:()=>p(_e(x)),className:"p-1.5 rounded-md hover:bg-surface-2 text-text-muted hover:text-text-primary transition-colors",children:e.jsx(he,{size:14})}),e.jsx("span",{className:"text-xs font-medium text-text-primary px-2 min-w-[200px] text-center",children:ie(x)}),e.jsx("button",{onClick:()=>p(we(x)),className:"p-1.5 rounded-md hover:bg-surface-2 text-text-muted hover:text-text-primary transition-colors",children:e.jsx(ze,{size:14})})]}),e.jsxs("button",{onClick:()=>{f("log-event")},className:"flex items-center gap-1.5 px-3 py-2 rounded-lg bg-cw text-white text-xs font-medium hover:bg-cw/90 transition-all",children:[e.jsx(V,{size:13}),"Log Event"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx(X,{icon:e.jsx(Ae,{size:15}),label:"Bonus Earners",value:N,color:"text-emerald-400",bg:"bg-emerald-500/10"}),e.jsx(X,{icon:e.jsx(be,{size:15}),label:"Warnings",value:$,color:"text-red-400",bg:"bg-red-500/10"}),e.jsx(X,{icon:e.jsx(fe,{size:15}),label:"Pending Reports",value:c,color:"text-amber-400",bg:"bg-amber-500/10"}),e.jsx(X,{icon:e.jsx(Pe,{size:15}),label:"Total Bonuses",value:`$${i}`,color:"text-cw",bg:"bg-cw/10"})]}),e.jsx("div",{className:"border-b border-border",children:e.jsx("div",{className:"flex gap-0.5",children:W.filter(r=>!r.adminOnly||R).map(r=>e.jsx("button",{onClick:()=>f(r.id),className:`px-4 py-2.5 text-xs font-medium transition-all border-b-2 ${b===r.id?"border-cw text-cw":"border-transparent text-text-muted hover:text-text-primary"}`,children:r.label},r.id))})}),z?e.jsx("div",{className:"text-sm text-text-muted text-center py-16",children:"Loading score data..."}):e.jsxs(e.Fragment,{children:[b==="leaderboard"&&u&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("select",{value:k,onChange:r=>O(r.target.value),className:"bg-surface-1 border border-border rounded-lg px-3 py-1.5 text-xs text-text-primary",children:[e.jsx("option",{value:"all",children:"All Teams"}),E.map(r=>e.jsx("option",{value:r,children:r},r))]}),e.jsxs("select",{value:A,onChange:r=>B(r.target.value),className:"bg-surface-1 border border-border rounded-lg px-3 py-1.5 text-xs text-text-primary",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"bonus_20",children:"$20 Bonus"}),e.jsx("option",{value:"bonus_10",children:"$10 Bonus"}),e.jsx("option",{value:"bonus_5",children:"$5 Bonus"}),e.jsx("option",{value:"no_bonus",children:"No Bonus"}),e.jsx("option",{value:"warning",children:"Warning"})]})]}),e.jsx("div",{className:"bg-surface-1 rounded-xl border border-border overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("th",{className:"text-left text-[10px] font-bold uppercase tracking-wider text-text-muted px-4 py-3 w-10",children:"#"}),e.jsx("th",{className:"text-left text-[10px] font-bold uppercase tracking-wider text-text-muted px-4 py-3",children:"Name"}),e.jsx("th",{className:"text-left text-[10px] font-bold uppercase tracking-wider text-text-muted px-4 py-3",children:"Team"}),e.jsx("th",{className:"text-right text-[10px] font-bold uppercase tracking-wider text-text-muted px-4 py-3",children:"Events"}),e.jsx("th",{className:"text-right text-[10px] font-bold uppercase tracking-wider text-text-muted px-4 py-3",children:"Weekly"}),e.jsx("th",{className:"text-right text-[10px] font-bold uppercase tracking-wider text-text-muted px-4 py-3",children:"Total"}),e.jsx("th",{className:"text-center text-[10px] font-bold uppercase tracking-wider text-text-muted px-4 py-3",children:"Status"}),e.jsx("th",{className:"text-right text-[10px] font-bold uppercase tracking-wider text-text-muted px-4 py-3",children:"Bonus"}),e.jsx("th",{className:"px-4 py-3 w-16"})]})}),e.jsxs("tbody",{children:[s.map((r,T)=>{const t=ce(r.status);return e.jsxs("tr",{className:"border-b border-border/50 hover:bg-surface-2/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-2.5 text-xs text-text-muted font-medium",children:T+1}),e.jsx("td",{className:"px-4 py-2.5 text-xs font-medium text-text-primary",children:r.chatter_name}),e.jsx("td",{className:"px-4 py-2.5",children:r.team_name&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-surface-3 text-text-muted font-medium",children:r.team_name.replace("Team ","")})}),e.jsxs("td",{className:`px-4 py-2.5 text-xs text-right font-medium ${r.event_points>0?"text-emerald-400":r.event_points<0?"text-red-400":"text-text-muted"}`,children:[r.event_points>0?"+":"",r.event_points]}),e.jsxs("td",{className:`px-4 py-2.5 text-xs text-right font-medium ${r.weekly_report_points>0?"text-emerald-400":"text-text-muted"}`,children:[r.weekly_report_points>0?"+":"",r.weekly_report_points]}),e.jsx("td",{className:`px-4 py-2.5 text-sm text-right font-bold ${J(r.total,u)}`,children:r.total}),e.jsx("td",{className:"px-4 py-2.5 text-center",children:e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-bold border ${t.colorClass}`,children:t.label})}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-right font-bold text-text-primary",children:r.bonus_amount>0?`$${r.bonus_amount}`:"—"}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("button",{onClick:()=>C(r.chatter_id),className:"text-[10px] px-2.5 py-1 rounded-md bg-surface-3 text-text-muted hover:text-cw hover:bg-cw/10 font-medium transition-all",children:"View"})})]},r.chatter_id)}),s.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-4 py-8 text-center text-sm text-text-muted",children:"No chatters match the selected filters"})})]})]})})})]}),b==="log-event"&&e.jsx(Be,{weekKey:x,eventTypes:l,chatters:g}),b==="weekly-reports"&&u&&e.jsx(Re,{weekKey:x,chatters:g,config:u,onDataChange:L}),b==="config"&&R&&u&&e.jsx(Me,{config:u,eventTypes:l,onSave:L})]}),S&&u&&e.jsx(qe,{chatterId:S,weekKey:x,config:u,scores:v,events:y,onClose:()=>C(null),onLogEvent:()=>{C(null),f("log-event")}})]})}function X({icon:n,label:x,value:p,color:b,bg:f}){return e.jsxs("div",{className:"bg-surface-1 rounded-xl border border-border p-4 flex items-center gap-3",children:[e.jsx("div",{className:`w-9 h-9 rounded-lg ${f} flex items-center justify-center ${b}`,children:n}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wider font-bold",children:x}),e.jsx("p",{className:`text-xl font-bold ${b}`,children:p})]})]})}export{tt as default};
