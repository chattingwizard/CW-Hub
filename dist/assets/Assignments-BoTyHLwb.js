import{u as Z,r as d,s as x,j as e,A as ee,C as te,U as se,h as ae}from"./index-CA8Xytnn.js";import{M as B}from"./ModelAvatar-C78ZsIZU.js";import{u as re,T as le,W as ne,P as F,a as de}from"./useTrafficData-C-yBA9A2.js";import{S as D}from"./search-Br0IWICO.js";import{C as R}from"./chevron-right-DnX9SIfG.js";import{M as ce}from"./monitor-BOL6YG8U.js";import{X as ie}from"./x-B1RhxLkA.js";import{P as xe}from"./plus-SHQmX2wS.js";import"./trending-up-DzPvdVSv.js";import"./trending-down-CbLCgBVi.js";import"./minus-jQmmtfBl.js";function we(){const{profile:b}=Z(),[j,W]=d.useState([]),[o,q]=d.useState([]),[c,N]=d.useState([]),[O,U]=d.useState([]),[r,h]=d.useState(null),[u,E]=d.useState(""),[v,V]=d.useState(""),[w,I]=d.useState("all"),[X,C]=d.useState(!0),[T,p]=d.useState(!1),{teamTraffic:f,getModelTraffic:g}=re(),G=()=>{const t=new Date,s=t.getDay(),a=t.getDate()-s+(s===0?-6:1);return t.setDate(a),t.toISOString().split("T")[0]},M=d.useCallback(async()=>{C(!0);const[t,s,a,l]=await Promise.all([x.from("models").select("*").order("name"),x.from("chatters").select("*").eq("status","Active").eq("airtable_role","Chatter").order("full_name"),x.from("model_chatter_assignments").select("*").eq("active",!0),x.from("schedules").select("*").eq("week_start",G())]),n=t.data??[],i=s.data??[];W(n),q(i),N(a.data??[]),U(l.data??[]),!r&&i.length>0&&h(i[0]),C(!1)},[]);d.useEffect(()=>{M()},[M]);const m=r?c.filter(t=>t.chatter_id===r.id).map(t=>({assignment:t,model:j.find(s=>s.id===t.model_id)})).filter(t=>t.model):[],y=r?j.filter(t=>t.status==="Live").filter(t=>!c.some(s=>s.model_id===t.id&&s.chatter_id===r.id)).filter(t=>!u||t.name.toLowerCase().includes(u.toLowerCase())):[],A=o.filter(t=>!(w!=="all"&&t.team_name!==w||v&&!t.full_name.toLowerCase().includes(v.toLowerCase()))),z=[...new Set(o.map(t=>t.team_name).filter(Boolean))],H=z.reduce((t,s)=>(t[s]=A.filter(a=>a.team_name===s),t),{}),P=A.filter(t=>!t.team_name),_=r?O.filter(t=>t.chatter_id===r.id):[],k=t=>c.filter(s=>s.chatter_id===t).length,$=t=>c.filter(s=>s.chatter_id===t).reduce((s,a)=>{const l=g(a.model_id);return s+((l==null?void 0:l.workload_pct)??0)},0),L=t=>c.filter(s=>s.model_id===t).length,J=async t=>{if(!r)return;p(!0);const{data:s,error:a}=await x.from("model_chatter_assignments").insert({model_id:t,chatter_id:r.id,assigned_by:b==null?void 0:b.id}).select().single();!a&&s&&N(l=>[...l,s]),p(!1)},K=async t=>{p(!0),await x.from("model_chatter_assignments").delete().eq("id",t),N(s=>s.filter(a=>a.id!==t)),p(!1)},S=t=>t?ae[t]??"":"",Q=["M","T","W","T","F","S","S"];return e.jsxs("div",{className:"p-4 lg:p-6 h-[calc(100vh-56px)] lg:h-screen flex flex-col",children:[e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-4 gap-3 shrink-0",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-extrabold text-text-primary",children:"Assignments"}),e.jsxs("p",{className:"text-sm text-text-secondary",children:[o.length," chatters · ",j.filter(t=>t.status==="Live").length," live models · ",c.length," assignments"]})]})}),f.length>0&&e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl p-4 mb-4 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ee,{size:14,className:"text-cw"}),e.jsx("h3",{className:"text-xs font-semibold text-white uppercase tracking-wider",children:"Team Workload Balance"}),(()=>{const t=f.map(n=>n.workload_per_chatter).filter(n=>n>0);if(t.length<2)return null;const s=Math.max(...t),a=Math.min(...t),l=a>0?s/a:0;return l>3?e.jsxs("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-danger/15 text-danger ml-2",children:["Critical imbalance (",l.toFixed(1),"x)"]}):l>2?e.jsxs("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-warning/15 text-warning ml-2",children:["Imbalance (",l.toFixed(1),"x)"]}):e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-success/15 text-success ml-2",children:"Balanced"})})(),e.jsxs("span",{className:"text-[9px] text-text-muted ml-auto",children:["weighted: ",e.jsx("span",{className:"text-emerald-400",children:"F"}),"=1.0x ",e.jsx("span",{className:"text-purple-400",children:"M"}),"=0.7x ",e.jsx("span",{className:"text-amber-400",children:"P"}),"=0.4x"]})]}),e.jsx("div",{className:"space-y-3",children:f.map(t=>e.jsx(le,{team:t,maxWorkloadPct:f[0].total_workload_pct},t.team_name))})]}),e.jsxs("div",{className:"flex gap-4 flex-1 min-h-0",children:[e.jsxs("div",{className:"w-72 shrink-0 flex-col bg-surface-1 border border-border rounded-xl overflow-hidden hidden lg:flex",children:[e.jsxs("div",{className:"p-3 border-b border-border space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(D,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),e.jsx("input",{type:"text",value:v,onChange:t=>V(t.target.value),placeholder:"Search chatters...",className:"w-full bg-surface-2 border border-border rounded-lg pl-8 pr-3 py-2 text-sm text-white placeholder-text-muted focus:outline-none focus:border-cw"})]}),e.jsxs("select",{value:w,onChange:t=>I(t.target.value),className:"w-full bg-surface-2 border border-border rounded-lg px-3 py-1.5 text-xs text-white focus:border-cw focus:outline-none",children:[e.jsx("option",{value:"all",children:"All Teams"}),z.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:X?e.jsx("div",{className:"p-4 text-center text-text-muted text-sm",children:"Loading..."}):e.jsxs(e.Fragment,{children:[Object.entries(H).map(([t,s])=>s.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"px-3 py-2 bg-surface-2/50 border-b border-border",children:e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wider text-text-muted",children:t})}),s.map(a=>{const l=k(a.id),n=$(a.id),i=(r==null?void 0:r.id)===a.id,Y=n>=110?"text-danger":n>=85?"text-success":n>=60?"text-warning":"text-text-muted";return e.jsxs("button",{onClick:()=>h(a),className:`w-full flex items-center gap-3 px-3 py-2.5 text-left transition-colors border-l-2 ${i?"bg-cw/10 border-l-cw":"border-l-transparent hover:bg-surface-2"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-xs font-medium shrink-0 ${S(a.team_name)||"bg-surface-3 text-text-secondary"}`,children:a.full_name.charAt(0)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-white truncate",children:a.full_name}),e.jsxs("p",{className:"text-[10px] text-text-muted",children:[l," model",l!==1?"s":""]})]}),e.jsx("span",{className:`text-[11px] font-bold shrink-0 ${Y}`,title:`${n}% workload capacity`,children:n>0?`${n}%`:"—"}),i&&e.jsx(R,{size:14,className:"text-cw shrink-0"})]},a.id)})]},t)),P.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"px-3 py-2 bg-surface-2/50 border-b border-border",children:e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wider text-text-muted",children:"No Team"})}),P.map(t=>{const s=k(t.id),a=$(t.id),l=(r==null?void 0:r.id)===t.id,n=a>=110?"text-danger":a>=85?"text-success":a>=60?"text-warning":"text-text-muted";return e.jsxs("button",{onClick:()=>h(t),className:`w-full flex items-center gap-3 px-3 py-2.5 text-left transition-colors border-l-2 ${l?"bg-cw/10 border-l-cw":"border-l-transparent hover:bg-surface-2"}`,children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-surface-3 flex items-center justify-center text-xs font-medium text-text-secondary shrink-0",children:t.full_name.charAt(0)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-white truncate",children:t.full_name}),e.jsxs("p",{className:"text-[10px] text-text-muted",children:[s," models"]})]}),e.jsx("span",{className:`text-[11px] font-bold shrink-0 ${n}`,children:a>0?`${a}%`:"—"}),l&&e.jsx(R,{size:14,className:"text-cw shrink-0"})]},t.id)})]})]})})]}),r?e.jsxs("div",{className:"flex-1 flex flex-col min-h-0 gap-4",children:[e.jsx("div",{className:"lg:hidden",children:e.jsx("select",{value:r.id,onChange:t=>{const s=o.find(a=>a.id===t.target.value);s&&h(s)},className:"w-full bg-surface-1 border border-border rounded-xl px-4 py-3 text-white text-sm focus:border-cw focus:outline-none",children:o.map(t=>e.jsxs("option",{value:t.id,children:[t.full_name," — ",k(t.id)," models ",t.team_name?`(${t.team_name})`:""]},t.id))})}),e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl p-5 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-14 h-14 rounded-xl flex items-center justify-center text-lg font-bold shrink-0 ${S(r.team_name)||"bg-cw/15 text-cw"}`,children:r.full_name.charAt(0)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:r.full_name}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 flex-wrap",children:[r.team_name&&e.jsx("span",{className:`text-xs px-2.5 py-0.5 rounded-full border ${S(r.team_name)}`,children:r.team_name}),r.airtable_role&&e.jsx("span",{className:"text-xs text-text-muted",children:r.airtable_role})]})]}),e.jsxs("div",{className:"hidden lg:flex items-center gap-5",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold text-cw",children:m.length}),e.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wider",children:"Models"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold text-white",children:_.length}),e.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wider",children:"Shifts/wk"})]}),(()=>{const t=m.reduce((s,{model:a})=>{const l=g(a.id);return s+((l==null?void 0:l.workload_pct)??0)},0);return e.jsxs("div",{className:"text-center pl-4 border-l border-border",children:[e.jsx(ne,{pct:t}),e.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wider mt-1",children:"Capacity"})]})})()]})]}),_.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(te,{size:12,className:"text-text-muted"}),e.jsx("span",{className:"text-[10px] text-text-muted uppercase tracking-wider",children:"This week's schedule"})]}),e.jsx("div",{className:"flex gap-1.5",children:Q.map((t,s)=>{const a=_.find(l=>l.day_of_week===s);return e.jsxs("div",{className:`flex-1 rounded-lg py-1.5 text-center text-[10px] ${a?"bg-cw/15 text-cw border border-cw/30":"bg-surface-2 text-text-muted border border-border"}`,title:a?a.shift:"Off",children:[e.jsx("div",{className:"font-medium",children:t}),a&&e.jsx("div",{className:"text-[8px] mt-0.5 opacity-70",children:a.shift.split("-")[0]})]},s)})})]})]}),e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl p-5 shrink-0",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{size:14,className:"text-cw"}),e.jsxs("h3",{className:"text-sm font-semibold text-white",children:["Assigned Models (",m.length,")"]})]})}),m.length===0?e.jsx("p",{className:"text-sm text-text-muted py-3 text-center",children:"No models assigned. Add from below."}):e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map(({assignment:t,model:s})=>{const a=g(s.id);return e.jsxs("div",{className:"group flex items-center gap-2.5 px-3 py-2 rounded-xl bg-surface-2 border border-border hover:border-cw/30 transition-colors",children:[e.jsx(B,{name:s.name,pictureUrl:s.profile_picture_url,size:"sm"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("p",{className:"text-sm text-white font-medium",children:s.name}),e.jsx(F,{pageType:s.page_type,size:"sm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-[9px] text-text-muted",children:[L(s.id)," chatters"]}),a&&e.jsxs("span",{className:"text-[9px] text-text-muted",children:[Math.round(a.new_fans_avg)," fans/d"]})]})]}),e.jsx(de,{traffic:a,size:"sm",showTrend:!0,showType:!1}),e.jsx("button",{onClick:()=>K(t.id),disabled:T,className:"ml-1 p-1 rounded-lg opacity-0 group-hover:opacity-100 hover:bg-danger/15 text-text-muted hover:text-danger transition-all disabled:opacity-30",children:e.jsx(ie,{size:14})})]},t.id)})})]}),e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl flex-1 min-h-0 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-border shrink-0",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-white shrink-0",children:"Add Models"}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx(D,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),e.jsx("input",{type:"text",value:u,onChange:t=>E(t.target.value),placeholder:"Search live models...",className:"w-full bg-surface-2 border border-border rounded-lg pl-8 pr-3 py-2 text-sm text-white placeholder-text-muted focus:outline-none focus:border-cw"})]}),e.jsxs("span",{className:"text-xs text-text-muted shrink-0",children:[y.length," available"]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-2",children:[y.map(t=>{const s=g(t.id);return e.jsxs("button",{onClick:()=>J(t.id),disabled:T,className:"flex items-center gap-3 px-3 py-2.5 rounded-xl bg-surface-2 border border-border hover:border-cw/40 hover:bg-cw/5 text-left transition-all group disabled:opacity-50",children:[e.jsx(B,{name:t.name,pictureUrl:t.profile_picture_url,size:"md"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("p",{className:"text-sm text-white truncate",children:t.name}),e.jsx(F,{pageType:t.page_type,size:"sm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-[9px] text-text-muted",children:[L(t.id)," chatters"]}),s&&e.jsxs("span",{className:"text-[9px] text-text-muted",children:[Math.round(s.new_fans_avg)," fans/d"]})]})]}),e.jsx(xe,{size:16,className:"text-cw opacity-0 group-hover:opacity-100 shrink-0"})]},t.id)}),y.length===0&&e.jsx("p",{className:"col-span-full text-sm text-text-muted py-6 text-center",children:u?"No models match your search.":"All live models are assigned."})]})})]})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(se,{size:40,className:"text-text-muted mx-auto mb-3"}),e.jsx("p",{className:"text-text-muted",children:"Select a chatter to manage assignments"})]})})]})]})}export{we as default};
