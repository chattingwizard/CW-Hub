import{c as E,u as W,r,s as y,j as e,M as K,a as T,i as V,b as Y,S as P,g as G,d as J,T as B,U as I,f as Q,C as Z,e as ee,h as te,A as se}from"./index-5iJEKlj_.js";import{M as ae}from"./ModelAvatar-fBwECrXT.js";import{u as re,T as ne,M as le,P as ie}from"./useTrafficData-D6cOhIJd.js";import{X as F}from"./x-BzIecsSZ.js";import{C as ce,a as de}from"./chevron-up-lb0d5pIS.js";import{P as oe}from"./plus-DGXwaWtN.js";import{L as xe}from"./loader-circle-D1kkN-CN.js";import{C as O}from"./chevron-right-DYQd25PV.js";import{M as me}from"./monitor-BzajU0_T.js";import{T as M}from"./trending-up-D8RIYaxq.js";import{C as he}from"./clock-D_kyYxhL.js";import{R as ge,B as pe,X as ue,T as fe,a as be}from"./BarChart-DfAVmvff.js";import"./trending-down-DuzWBKUD.js";import"./minus-BhOD4fh2.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=E("Pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=E("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),U={urgent:{bg:"bg-danger/[0.06]",border:"border-danger/30",icon:"text-danger",label:"Urgent"},important:{bg:"bg-warning/[0.06]",border:"border-warning/30",icon:"text-warning",label:"Important"},normal:{bg:"bg-surface-1",border:"border-border",icon:"text-text-muted",label:"Normal"}};function ve(){const{profile:h}=W(),[u,w]=r.useState([]),[i,b]=r.useState(new Set),[c,j]=r.useState(!0),x=r.useCallback(async()=>{if(!h)return;const{data:a}=await y.from("announcements").select("*, author:profiles!announcements_author_id_fkey(full_name)").order("pinned",{ascending:!1}).order("created_at",{ascending:!1}).limit(10);if(a){const l=a.filter(p=>p.target_roles.length===0||p.target_roles.includes(h.role));w(l)}},[h]);r.useEffect(()=>{x()},[x]);const N=u.filter(a=>!i.has(a.id));if(N.length===0)return null;const v=N.filter(a=>a.pinned),g=N.filter(a=>!a.pinned),d=c?[...v,...g]:v.slice(0,1);return e.jsxs("div",{className:"mb-4 space-y-2",children:[d.map(a=>{var p;const l=U[a.priority]||U.normal;return e.jsx("div",{className:T("border rounded-xl px-4 py-3",l.bg,l.border),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(K,{size:16,className:T("shrink-0 mt-0.5",l.icon)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-text-primary",children:a.title}),a.pinned&&e.jsx(je,{size:10,className:"text-text-muted"}),a.priority!=="normal"&&e.jsx("span",{className:T("text-[9px] px-1.5 py-0.5 rounded-full font-bold",l.bg,l.icon),children:l.label})]}),e.jsx("p",{className:"text-xs text-text-secondary mt-0.5",children:a.message}),e.jsxs("p",{className:"text-[10px] text-text-muted mt-1",children:[(p=a.author)==null?void 0:p.full_name," · ",new Date(a.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})]})]}),!a.pinned&&e.jsx("button",{onClick:()=>b(o=>new Set([...o,a.id])),className:"p-1 rounded-lg hover:bg-surface-2 text-text-muted shrink-0",children:e.jsx(F,{size:14})})]})},a.id)}),g.length>0&&e.jsxs("button",{onClick:()=>j(!c),className:"text-[11px] text-text-muted hover:text-text-secondary flex items-center gap-1 ml-1",children:[c?e.jsx(ce,{size:12}):e.jsx(de,{size:12}),c?"Show less":`${g.length} more announcement${g.length>1?"s":""}`]})]})}function ye({onPost:h}){const{profile:u}=W(),[w,i]=r.useState(!1),[b,c]=r.useState(""),[j,x]=r.useState(""),[N,v]=r.useState("normal"),[g,d]=r.useState(!1),[a,l]=r.useState(!1);if(!u||!V(u.role))return null;const p=async()=>{!b.trim()||!j.trim()||(l(!0),await y.from("announcements").insert({title:b.trim(),message:j.trim(),author_id:u.id,priority:N,pinned:g,target_roles:[]}),c(""),x(""),v("normal"),d(!1),i(!1),l(!1),h==null||h())};return w?e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-bold text-text-primary",children:"New Announcement"}),e.jsx("button",{onClick:()=>i(!1),className:"text-text-muted hover:text-text-primary",children:e.jsx(F,{size:16})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",placeholder:"Title",value:b,onChange:o=>c(o.target.value),className:"w-full px-3 py-2 bg-surface-2 border border-border rounded-lg text-sm text-text-primary placeholder:text-text-muted focus:outline-none focus:border-cw/50"}),e.jsx("textarea",{placeholder:"Message...",value:j,onChange:o=>x(o.target.value),rows:2,className:"w-full px-3 py-2 bg-surface-2 border border-border rounded-lg text-sm text-text-primary placeholder:text-text-muted focus:outline-none focus:border-cw/50 resize-none"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("select",{value:N,onChange:o=>v(o.target.value),className:"bg-surface-2 border border-border rounded-lg px-2 py-1.5 text-xs text-text-primary focus:outline-none focus:border-cw/50",children:[e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"important",children:"Important"}),e.jsx("option",{value:"urgent",children:"Urgent"})]}),e.jsxs("label",{className:"flex items-center gap-1.5 text-xs text-text-secondary cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:o=>d(o.target.checked),className:"rounded border-border text-cw focus:ring-cw/20"}),"Pin"]}),e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:p,disabled:a||!b.trim()||!j.trim(),className:"flex items-center gap-1.5 px-4 py-1.5 bg-cw text-white text-xs font-bold rounded-lg hover:bg-cw-dark disabled:opacity-40 transition-colors",children:[a?e.jsx(xe,{size:12,className:"animate-spin"}):e.jsx(Ne,{size:12}),"Post"]})]})]})]}):e.jsxs("button",{onClick:()=>i(!0),className:"flex items-center gap-2 text-xs text-text-muted hover:text-cw transition-colors",children:[e.jsx(oe,{size:14})," Post Announcement"]})}function Be(){var $;const h=Y(),[u,w]=r.useState([]),[i,b]=r.useState([]),[c,j]=r.useState([]),[x,N]=r.useState([]),[v,g]=r.useState(!0),{modelTraffic:d,teamTraffic:a}=re(),l=r.useMemo(()=>{const t=new Date,s=t.getDay(),n=t.getDate()-s+(s===0?-6:1);return t.setDate(n),t.toISOString().split("T")[0]},[]),p=r.useCallback(async()=>{g(!0);try{const[t,s,n,m]=await Promise.all([y.from("models").select("*"),y.from("chatters").select("*").eq("status","Active").eq("airtable_role","Chatter"),y.from("model_chatter_assignments").select("*").eq("active",!0),y.from("schedules").select("*").eq("week_start",l)]);w(t.data??[]),b(s.data??[]),j(n.data??[]),N(m.data??[])}catch(t){console.error("Overview fetch error:",t)}finally{g(!1)}},[l]);r.useEffect(()=>{p()},[p]);const o=u.filter(t=>t.status==="Live"),A=i.length,L=d.filter(t=>t.model_status==="Live").reduce((t,s)=>t+s.earnings_per_day,0),D=[...new Set(i.map(t=>t.team_name).filter(Boolean))],H=D.map(t=>{const s=i.filter(f=>f.team_name===t),n=new Set(s.map(f=>f.id)),m=c.filter(f=>n.has(f.chatter_id)),k=new Set(m.map(f=>f.model_id)),X=x.filter(f=>n.has(f.chatter_id));return{team:t,members:s.length,models:k.size,shifts:X.length}});P.map(t=>{const s=Array.from({length:7},(n,m)=>x.filter(k=>k.day_of_week===m&&k.shift===t).length);return{shift:t,counts:s,total:s.reduce((n,m)=>n+m,0)}});const C=i.filter(t=>!c.some(s=>s.chatter_id===t.id)),z=i.filter(t=>!x.some(s=>s.chatter_id===t.id)),_=o.filter(t=>!c.some(s=>s.model_id===t.id)),S=[];_.length>0&&S.push({type:"danger",message:`${_.length} live model${_.length>1?"s":""} with no chatters assigned`,action:"Fix",path:"/assignments"}),z.length>0&&S.push({type:"warning",message:`${z.length} chatter${z.length>1?"s":""} with no schedule this week`,action:"Fix",path:"/schedules"}),C.length>0&&S.push({type:"warning",message:`${C.length} chatter${C.length>1?"s":""} not assigned to any model`,action:"Fix",path:"/assignments"});const R=new Date().getDay()===0?6:new Date().getDay()-1,q=P.map(t=>({shift:t,count:x.filter(s=>s.day_of_week===R&&s.shift===t).length,chatters:x.filter(s=>s.day_of_week===R&&s.shift===t).map(s=>{var n;return(n=i.find(m=>m.id===s.chatter_id))==null?void 0:n.full_name}).filter(Boolean)}));return v?e.jsx("div",{className:"p-6 flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"flex items-center gap-2 text-text-secondary",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-cw/30 border-t-cw rounded-full animate-spin"}),"Loading overview..."]})}):e.jsxs("div",{className:"p-4 lg:p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-extrabold text-text-primary",children:"Overview"}),e.jsxs("p",{className:"text-sm text-text-secondary mt-1",children:[new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"}),e.jsx("span",{className:"text-text-muted ml-2",children:"·"}),e.jsxs("span",{className:"text-cw ml-2 font-semibold",children:[(($=G(J()))==null?void 0:$.tl)||"Night"," shift active"]})]})]}),e.jsx(ve,{}),e.jsx(ye,{}),S.length>0&&e.jsx("div",{className:"space-y-2 mb-6",children:S.map((t,s)=>e.jsxs("div",{className:`flex items-center justify-between px-4 py-3 rounded-lg border ${t.type==="danger"?"bg-danger/10 border-danger/30":"bg-warning/10 border-warning/30"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{size:16,className:t.type==="danger"?"text-danger":"text-warning"}),e.jsx("span",{className:`text-sm ${t.type==="danger"?"text-danger":"text-warning"}`,children:t.message})]}),e.jsxs("button",{onClick:()=>h(t.path),className:`text-xs font-medium px-3 py-1 rounded-lg ${t.type==="danger"?"bg-danger/20 text-danger hover:bg-danger/30":"bg-warning/20 text-warning hover:bg-warning/30"}`,children:[t.action," ",e.jsx(O,{size:12,className:"inline -mt-0.5"})]})]},s))}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 mb-6",children:[e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-text-secondary",children:"Live Models"}),e.jsx("div",{className:"w-8 h-8 rounded-lg bg-cw/10 flex items-center justify-center",children:e.jsx(me,{size:16,className:"text-cw"})})]}),e.jsx("p",{className:"text-2xl font-bold text-white",children:o.length}),e.jsxs("p",{className:"text-[10px] text-text-muted mt-1",children:[u.length," total (",u.filter(t=>t.status==="On Hold").length," on hold)"]})]}),e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-text-secondary",children:"Active Chatters"}),e.jsx("div",{className:"w-8 h-8 rounded-lg bg-success/10 flex items-center justify-center",children:e.jsx(I,{size:16,className:"text-success"})})]}),e.jsx("p",{className:"text-2xl font-bold text-white",children:A}),e.jsxs("p",{className:"text-[10px] text-text-muted mt-1",children:[D.length," teams"]})]}),e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-text-secondary",children:"Revenue / day"}),e.jsx("div",{className:"w-8 h-8 rounded-lg bg-cw/10 flex items-center justify-center",children:e.jsx(M,{size:16,className:"text-cw"})})]}),e.jsx("p",{className:"text-2xl font-bold text-white",children:L>0?Q(L):"—"}),e.jsxs("p",{className:"text-[10px] text-text-muted mt-1",children:[d.filter(t=>t.earnings_per_day>0).length," models reporting"]})]}),e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-text-secondary",children:"Total Assignments"}),e.jsx("div",{className:"w-8 h-8 rounded-lg bg-warning/10 flex items-center justify-center",children:e.jsx(Z,{size:16,className:"text-warning"})})]}),e.jsx("p",{className:"text-2xl font-bold text-white",children:c.length}),e.jsx("p",{className:"text-[10px] text-text-muted mt-1",children:"chatter-model pairs"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(he,{size:16,className:"text-cw"}),e.jsx("h2",{className:"text-sm font-semibold text-white",children:"Today's Coverage"})]}),e.jsx("div",{className:"space-y-3",children:q.map(({shift:t,count:s,chatters:n})=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs text-text-secondary",children:ee[t]}),e.jsxs("span",{className:"text-sm font-semibold text-white",children:[s," chatters"]})]}),e.jsx("div",{className:"w-full bg-surface-2 rounded-full h-2 mb-1",children:e.jsx("div",{className:"h-2 rounded-full bg-cw transition-all",style:{width:`${Math.min(s/Math.max(A*.4,1)*100,100)}%`}})}),n.length>0&&e.jsx("p",{className:"text-[10px] text-text-muted truncate",children:n.join(", ")})]},t))})]}),e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(I,{size:16,className:"text-cw"}),e.jsx("h2",{className:"text-sm font-semibold text-white",children:"Team Breakdown"})]}),e.jsx("div",{className:"space-y-3",children:H.map(({team:t,members:s,models:n,shifts:m})=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center text-xs font-bold shrink-0 ${te[t]??"bg-surface-3 text-text-secondary"}`,children:t.replace("Team ","").charAt(0)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-white font-medium",children:t}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5",children:[e.jsxs("span",{className:"text-[10px] text-text-muted",children:[s," chatters"]}),e.jsxs("span",{className:"text-[10px] text-text-muted",children:[n," models"]}),e.jsxs("span",{className:"text-[10px] text-text-muted",children:[m," shifts/wk"]})]})]})]},t))})]})]}),d.length>0&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(se,{size:16,className:"text-cw"}),e.jsx("h2",{className:"text-sm font-semibold text-white",children:"Team Workload"})]}),e.jsxs("p",{className:"text-[10px] text-text-muted mb-4",children:["Weighted by account type: ",e.jsx("span",{className:"text-emerald-400",children:"Free"}),"=1.0x ",e.jsx("span",{className:"text-purple-400",children:"Mix"}),"=0.7x ",e.jsx("span",{className:"text-amber-400",children:"Paid"}),"=0.4x"]}),a.length>0?e.jsx("div",{className:"space-y-3",children:a.map(t=>e.jsx(ne,{team:t,maxWorkloadPct:a[0].total_workload_pct},t.team_name))}):e.jsx("p",{className:"text-sm text-text-muted text-center py-4",children:"No traffic data yet"})]}),e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(M,{size:16,className:"text-orange-400"}),e.jsx("h2",{className:"text-sm font-semibold text-white",children:"Highest Workload Models"})]}),e.jsx("div",{className:"space-y-0.5",children:d.slice(0,10).map((t,s)=>e.jsx(le,{traffic:t,rank:s+1},t.model_id))})]})]}),d.some(t=>t.earnings_per_day>0)&&e.jsxs("div",{className:"bg-surface-1 border border-border rounded-xl p-5 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(M,{size:16,className:"text-cw"}),e.jsx("h2",{className:"text-sm font-semibold text-white",children:"Top Revenue / day"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx("div",{className:"h-[200px] sm:h-[250px]",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(pe,{data:d.filter(t=>t.earnings_per_day>0).slice(0,8).map(t=>({name:t.model_name.slice(0,10),revenue:Math.round(t.earnings_per_day)})),margin:{top:5,right:5,bottom:5,left:5},children:[e.jsx(ue,{dataKey:"name",tick:{fill:"#888",fontSize:9},axisLine:!1,tickLine:!1}),e.jsx(fe,{contentStyle:{background:"#1a1a1a",border:"1px solid #2a2a2a",borderRadius:8,fontSize:12},formatter:t=>[`$${t.toLocaleString()}/day`,"Revenue"],cursor:{fill:"rgba(29, 155, 240, 0.08)"}}),e.jsx(be,{dataKey:"revenue",fill:"#1d9bf0",radius:[3,3,0,0]})]})})}),e.jsx("div",{className:"space-y-2",children:d.filter(t=>t.earnings_per_day>0).sort((t,s)=>s.earnings_per_day-t.earnings_per_day).slice(0,5).map((t,s)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-[10px] text-text-muted w-4 text-right",children:s+1}),e.jsx(ie,{pageType:t.page_type,size:"sm"}),e.jsx("span",{className:"text-sm text-white flex-1 truncate",children:t.model_name}),e.jsxs("span",{className:"text-sm text-cw font-semibold",children:["$",Math.round(t.earnings_per_day).toLocaleString(),"/d"]})]},t.model_id))})]})]}),_.length>0&&e.jsxs("div",{className:"bg-surface-1 border border-danger/30 rounded-xl p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(B,{size:16,className:"text-danger"}),e.jsx("h2",{className:"text-sm font-semibold text-danger",children:"Live Models Without Chatters"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:_.map(t=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-danger/10 border border-danger/20",children:[e.jsx(ae,{name:t.name,pictureUrl:t.profile_picture_url,size:"xs"}),e.jsx("span",{className:"text-xs text-danger",children:t.name})]},t.id))}),e.jsxs("button",{onClick:()=>h("/assignments"),className:"mt-3 text-xs text-cw hover:text-cw-light",children:["Go to Assignments ",e.jsx(O,{size:12,className:"inline -mt-0.5"})]})]})]})}export{Be as default};
